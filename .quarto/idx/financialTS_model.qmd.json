{"title":"Financial Time Series Models","markdown":{"yaml":{"title":"Financial Time Series Models","format":{"html":{"code-fold":true,"toc":true,"toc-depth":3,"embed-resources":true}}},"headingText":"Theoretical Framework","containsRefs":false,"markdown":"\n\n\n## Overview\n\nHaving established the relationship between NBA performance and betting markets, we now shift our focus to the financial behavior of sports betting stocks themselves. In this chapter, these firms are treated as an independent financial ecosystem shaped by sports events, regulatory changes, and broader market forces. Financial returns exhibit volatility clustering, where periods of high or low volatility tend to persist. Because ARIMA models assume constant variance, they are not well suited for data with this property. GARCH models address this limitation by explicitly capturing time-varying volatility. The key insight is that while returns may be unpredictable due to market efficiency, volatility often follows predictable patterns that are essential for risk management, options pricing, and portfolio optimization.\n\n---\n\n```{r setup, warning=FALSE, message=FALSE}\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(forecast)\nlibrary(astsa)\nlibrary(xts)\nlibrary(tseries)\nlibrary(fpp2)\nlibrary(fma)\nlibrary(lubridate)\nlibrary(TSstudio)\nlibrary(quantmod)\nlibrary(tidyquant)\nlibrary(plotly)\nlibrary(imputeTS)\nlibrary(dplyr)\nlibrary(reshape2)\nlibrary(gridExtra)\nlibrary(zoo)\nlibrary(kableExtra)\nlibrary(vars)\nlibrary(patchwork)\nlibrary(moments)\nlibrary(fGarch)\n\ntheme_set(theme_minimal(base_size = 12))\n```\n\n```{r load-data, warning=FALSE, message=FALSE}\n# Load all stock data\ndkng <- read_csv(\"data/financial/DKNG_daily.csv\", show_col_types = FALSE)\ncolnames(dkng) <- gsub(\"Adj Close\", \"Adj_Close\", colnames(dkng))\ndkng <- dkng %>%\n    mutate(Date = as.Date(Date)) %>%\n    arrange(Date)\n\npenn <- read_csv(\"data/financial/PENN_daily.csv\", show_col_types = FALSE)\ncolnames(penn) <- gsub(\"Adj Close\", \"Adj_Close\", colnames(penn))\npenn <- penn %>%\n    mutate(Date = as.Date(Date)) %>%\n    arrange(Date)\n\nczr <- read_csv(\"data/financial/CZR_daily.csv\", show_col_types = FALSE)\ncolnames(czr) <- gsub(\"Adj\\\\.Close\", \"Adj_Close\", colnames(czr))\n\nif (\"Adj_Close\" %in% colnames(czr)) {\n    czr$Adj_Close <- as.numeric(czr$Adj_Close)\n}\nczr <- czr %>%\n    mutate(Date = as.Date(Date)) %>%\n    arrange(Date)\n\nmgm <- read_csv(\"data/financial/MGM_daily.csv\", show_col_types = FALSE)\ncolnames(mgm) <- gsub(\"Adj\\\\.Close\", \"Adj_Close\", colnames(mgm))\n\nif (\"Adj_Close\" %in% colnames(mgm)) {\n    mgm$Adj_Close <- as.numeric(mgm$Adj_Close)\n}\nmgm <- mgm %>%\n    mutate(Date = as.Date(Date)) %>%\n    arrange(Date)\n```\n\n## Calculate Returns\n\nFinancial time series models typically work with **returns** rather than prices. So, we calculate **log returns** (continuously compounded):\n\n$$\nr_t = \\ln(P_t) - \\ln(P_{t-1}) = \\ln\\left(\\frac{P_t}{P_{t-1}}\\right)\n$$\n\n```{r calculate-returns, warning=FALSE, message=FALSE}\n# Calculate log returns for all stocks\ndkng$LogReturn <- c(NA, diff(log(dkng$Adj_Close)))\ndkng$Return_Pct <- dkng$LogReturn * 100\ndkng$Ticker <- \"DKNG\"\ndkng <- dkng %>% filter(!is.na(LogReturn))\n\npenn$LogReturn <- c(NA, diff(log(penn$Adj_Close)))\npenn$Return_Pct <- penn$LogReturn * 100\npenn$Ticker <- \"PENN\"\npenn <- penn %>% filter(!is.na(LogReturn))\n\nczr$LogReturn <- c(NA, diff(log(czr$Adj_Close)))\nczr$Return_Pct <- czr$LogReturn * 100\nczr$Ticker <- \"CZR\"\nczr <- czr %>% filter(!is.na(LogReturn))\n\nmgm$LogReturn <- c(NA, diff(log(mgm$Adj_Close)))\nmgm$Return_Pct <- mgm$LogReturn * 100\nmgm$Ticker <- \"MGM\"\nmgm <- mgm %>% filter(!is.na(LogReturn))\n\n# Summary statistics for all stocks\nstocks_list <- list(\n    DKNG = dkng$Return_Pct,\n    PENN = penn$Return_Pct,\n    CZR = czr$Return_Pct,\n    MGM = mgm$Return_Pct\n)\n\ncat(\"\\n=== RETURNS SUMMARY STATISTICS ===\\n\\n\")\nfor (ticker in names(stocks_list)) {\n    returns <- stocks_list[[ticker]]\n    cat(ticker, \":\\n\")\n    cat(\"  Mean:\", round(mean(returns), 4), \"%\\n\")\n    cat(\"  Std Dev:\", round(sd(returns), 4), \"%\\n\")\n    cat(\"  Min:\", round(min(returns), 4), \"%\\n\")\n    cat(\"  Max:\", round(max(returns), 4), \"%\\n\")\n    cat(\"  Skewness:\", round(moments::skewness(returns), 4), \"\\n\")\n    cat(\"  Kurtosis:\", round(moments::kurtosis(returns), 4), \"\\n\\n\")\n}\n```\n\n---\n\n# Data Visualization & Stationarity\n\n::: {.panel-tabset}\n\n## DraftKings (DKNG)\n\n::: {.panel-tabset}\n\n### Price & Returns Plot\n\n```{r dkng-price-returns, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\np1 <- ggplot(dkng, aes(x = Date, y = Adj_Close)) +\n    geom_line(color = \"#006bb6\", linewidth = 0.8) +\n    labs(\n        title = \"DraftKings (DKNG) Stock Price\",\n        subtitle = \"Daily Adjusted Close Price\",\n        x = \"Date\", y = \"Price ($)\"\n    ) +\n    theme_minimal()\n\np2 <- ggplot(dkng, aes(x = Date, y = Return_Pct)) +\n    geom_line(color = \"darkred\", linewidth = 0.5, alpha = 0.7) +\n    geom_hline(yintercept = 0, linetype = \"dashed\", color = \"black\") +\n    labs(\n        title = \"DraftKings (DKNG) Daily Returns\",\n        subtitle = \"Log returns showing volatility clustering\",\n        x = \"Date\", y = \"Return (%)\"\n    ) +\n    theme_minimal()\n\np1 / p2\n```\n\n**Observations**:\n\n- **Price Series**: Non-stationary with clear trends. DKNG went public via SPAC merger in 2020, experienced a pandemic boom, then declined as competition intensified.\n- **Returns Series**: Appears stationary around zero mean, but exhibits clear **volatility clustering**. Periods of calm (2021-early 2022) alternate with turbulence (late 2022, 2024).\n\n### Volatility Clustering\n\n```{r dkng-volatility-cluster, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\n# Calculate rolling volatility (20-day window)\ndkng <- dkng %>%\n    arrange(Date) %>%\n    mutate(\n        Roll_Vol_20 = zoo::rollapply(Return_Pct, width = 20, FUN = sd, fill = NA, align = \"right\"),\n        Abs_Return = abs(Return_Pct)\n    )\n\np3 <- ggplot(dkng, aes(x = Date, y = Abs_Return)) +\n    geom_line(color = \"purple\", alpha = 0.6) +\n    labs(\n        title = \"Absolute Returns (Proxy for Volatility)\",\n        x = \"Date\", y = \"|Return| (%)\"\n    ) +\n    theme_minimal()\n\np4 <- ggplot(dkng, aes(x = Date, y = Roll_Vol_20)) +\n    geom_line(color = \"darkgreen\", linewidth = 0.8) +\n    labs(\n        title = \"20-Day Rolling Volatility\",\n        x = \"Date\", y = \"Volatility (% std dev)\"\n    ) +\n    theme_minimal()\n\np3 / p4\n```\n\n**Volatility Clustering Evidence**:\n\nThe rolling volatility plot clearly shows time-varying variance. Volatility is not constant it rises sharply during market stress and falls during stable periods. This visual evidence motivates GARCH modeling.\n\n### ACF/PACF Analysis\n\n```{r dkng-acf-returns, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\n# ACF/PACF of returns\npar(mfrow = c(1, 2))\nacf(dkng$Return_Pct, lag.max = 30, main = \"ACF: DKNG Returns\")\npacf(dkng$Return_Pct, lag.max = 30, main = \"PACF: DKNG Returns\")\npar(mfrow = c(1, 1))\n```\n\n```{r dkng-acf-squared, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\n# ACF/PACF of squared returns (test for ARCH effects)\npar(mfrow = c(1, 2))\nacf(dkng$Return_Pct^2, lag.max = 30, main = \"ACF: Squared Returns (DKNG)\")\npacf(dkng$Return_Pct^2, lag.max = 30, main = \"PACF: Squared Returns (DKNG)\")\npar(mfrow = c(1, 1))\n```\n\n**Key Findings**:\n\n- **Returns ACF/PACF**: Minimal autocorrelation at most lags (consistent with weak-form market efficiency). Returns themselves are largely unpredictable.\n- **Squared Returns ACF/PACF**: **Strong autocorrelation** at multiple lags. This is the signature of ARCH effects while returns are unpredictable, volatility is highly predictable and persistent.\n  \n### Stationarity Tests\n\n```{r dkng-stationarity, warning=FALSE, message=FALSE}\n# ADF test on returns\nadf_dkng <- adf.test(dkng$Return_Pct)\n\ncat(\"=== Augmented Dickey-Fuller Test ===\\n\")\ncat(\"Null Hypothesis: Series has a unit root (non-stationary)\\n\\n\")\ncat(\"ADF Statistic:\", round(adf_dkng$statistic, 4), \"\\n\")\ncat(\"p-value:\", round(adf_dkng$p.value, 4), \"\\n\")\ncat(\"Conclusion:\", ifelse(adf_dkng$p.value < 0.05,\n    \"Reject H0 - Returns are STATIONARY\",\n    \"Fail to reject H0 - Returns are NON-STATIONARY\"\n), \"\\n\")\n```\n\n**Stationarity Conclusion**: The ADF test confirms that DKNG returns are stationary (p < 0.01). This validates our use of returns rather than prices and confirms that we don't need differencing in the mean equation.\n\n:::\n\n---\n\n## Penn Entertainment (PENN)\n\n::: {.panel-tabset}\n\n### Price & Returns Plot\n\n```{r penn-price-returns, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\np5 <- ggplot(penn, aes(x = Date, y = Adj_Close)) +\n    geom_line(color = \"#006bb6\", linewidth = 0.8) +\n    labs(\n        title = \"Penn Entertainment (PENN) Stock Price\",\n        subtitle = \"Daily Adjusted Close Price\",\n        x = \"Date\", y = \"Price ($)\"\n    ) +\n    theme_minimal()\n\np6 <- ggplot(penn, aes(x = Date, y = Return_Pct)) +\n    geom_line(color = \"darkred\", linewidth = 0.5, alpha = 0.7) +\n    geom_hline(yintercept = 0, linetype = \"dashed\", color = \"black\") +\n    labs(\n        title = \"Penn Entertainment (PENN) Daily Returns\",\n        subtitle = \"Log returns showing volatility clustering\",\n        x = \"Date\", y = \"Return (%)\"\n    ) +\n    theme_minimal()\n\np5 / p6\n```\n\n**Observations**:\n\n- **Price Series**: Even more volatile than DKNG. PENN's business model shifted from Barstool Sports (2020-2023) to ESPN BET (2023-present), creating structural breaks and extreme volatility.\n- **Returns Series**: Strong volatility clustering with several extreme spikes. This suggests PENN may exhibit even stronger GARCH effects than DKNG.\n\n### Volatility Clustering\n\n```{r penn-volatility-cluster, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\npenn <- penn %>%\n    arrange(Date) %>%\n    mutate(\n        Roll_Vol_20 = zoo::rollapply(Return_Pct, width = 20, FUN = sd, fill = NA, align = \"right\"),\n        Abs_Return = abs(Return_Pct)\n    )\n\np7 <- ggplot(penn, aes(x = Date, y = Abs_Return)) +\n    geom_line(color = \"purple\", alpha = 0.6) +\n    labs(\n        title = \"Absolute Returns (Proxy for Volatility)\",\n        x = \"Date\", y = \"|Return| (%)\"\n    ) +\n    theme_minimal()\n\np8 <- ggplot(penn, aes(x = Date, y = Roll_Vol_20)) +\n    geom_line(color = \"darkgreen\", linewidth = 0.8) +\n    labs(\n        title = \"20-Day Rolling Volatility\",\n        x = \"Date\", y = \"Volatility (% std dev)\"\n    ) +\n    theme_minimal()\n\np7 / p8\n```\n\n### ACF/PACF Analysis\n\n```{r penn-acf-returns, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\npar(mfrow = c(1, 2))\nacf(penn$Return_Pct, lag.max = 30, main = \"ACF: PENN Returns\")\npacf(penn$Return_Pct, lag.max = 30, main = \"PACF: PENN Returns\")\npar(mfrow = c(1, 1))\n```\n\n```{r penn-acf-squared, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\npar(mfrow = c(1, 2))\nacf(penn$Return_Pct^2, lag.max = 30, main = \"ACF: Squared Returns (PENN)\")\npacf(penn$Return_Pct^2, lag.max = 30, main = \"PACF: Squared Returns (PENN)\")\npar(mfrow = c(1, 1))\n```\n\n**Key Findings**:\n\nSimilar to DKNG: returns show weak autocorrelation, but squared returns exhibit strong autocorrelation, indicating ARCH effects. The PACF of squared returns shows significant spikes at early lags, suggesting GARCH(1,1) may be appropriate.\n\n### Stationarity Tests\n\n```{r penn-stationarity, warning=FALSE, message=FALSE}\nadf_penn <- adf.test(penn$Return_Pct)\n\ncat(\"=== Augmented Dickey-Fuller Test ===\\n\")\ncat(\"ADF Statistic:\", round(adf_penn$statistic, 4), \"\\n\")\ncat(\"p-value:\", round(adf_penn$p.value, 4), \"\\n\")\ncat(\"Conclusion:\", ifelse(adf_penn$p.value < 0.05,\n    \"Reject H0 - Returns are STATIONARY\",\n    \"Fail to reject H0 - Returns are NON-STATIONARY\"\n), \"\\n\")\n```\n\n:::\n\n## Caesars Entertainment (CZR)\n\n::: {.panel-tabset}\n\n### Price & Returns\n\n```{r czr-price-returns, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\np_czr1 <- ggplot(czr, aes(x = Date, y = Adj_Close)) +\n    geom_line(color = \"#006bb6\", linewidth = 0.8) +\n    labs(\n        title = \"Caesars Entertainment (CZR) Stock Price\",\n        x = \"Date\", y = \"Price ($)\"\n    ) +\n    theme_minimal()\n\np_czr2 <- ggplot(czr, aes(x = Date, y = Return_Pct)) +\n    geom_line(color = \"darkred\", linewidth = 0.5, alpha = 0.7) +\n    geom_hline(yintercept = 0, linetype = \"dashed\", color = \"black\") +\n    labs(\n        title = \"Caesars Entertainment (CZR) Daily Returns\",\n        x = \"Date\", y = \"Return (%)\"\n    ) +\n    theme_minimal()\n\np_czr1 / p_czr2\n```\n\n### Volatility & ACF\n\n```{r czr-vol-acf, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\nczr <- czr %>%\n    arrange(Date) %>%\n    mutate(Roll_Vol_20 = zoo::rollapply(Return_Pct, width = 20, FUN = sd, fill = NA, align = \"right\"))\n\np_czr_vol <- ggplot(czr, aes(x = Date, y = Roll_Vol_20)) +\n    geom_line(color = \"darkgreen\", linewidth = 0.8) +\n    labs(title = \"CZR: 20-Day Rolling Volatility\", y = \"Volatility (%)\") +\n    theme_minimal()\n\nprint(p_czr_vol)\n\npar(mfrow = c(1, 2))\nacf(czr$Return_Pct^2, lag.max = 30, main = \"ACF: Squared Returns (CZR)\")\npacf(czr$Return_Pct^2, lag.max = 30, main = \"PACF: Squared Returns (CZR)\")\npar(mfrow = c(1, 1))\n```\n\n**Observations**: CZR shows volatility clustering typical of casino/gaming stocks, with moderate ARCH effects visible in squared returns ACF.\n\n:::\n\n## MGM Resorts (MGM)\n\n::: {.panel-tabset}\n\n### Price & Returns\n\n```{r mgm-price-returns, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\np_mgm1 <- ggplot(mgm, aes(x = Date, y = Adj_Close)) +\n    geom_line(color = \"#006bb6\", linewidth = 0.8) +\n    labs(\n        title = \"MGM Resorts (MGM) Stock Price\",\n        x = \"Date\", y = \"Price ($)\"\n    ) +\n    theme_minimal()\n\np_mgm2 <- ggplot(mgm, aes(x = Date, y = Return_Pct)) +\n    geom_line(color = \"darkred\", linewidth = 0.5, alpha = 0.7) +\n    geom_hline(yintercept = 0, linetype = \"dashed\", color = \"black\") +\n    labs(\n        title = \"MGM Resorts (MGM) Daily Returns\",\n        x = \"Date\", y = \"Return (%)\"\n    ) +\n    theme_minimal()\n\np_mgm1 / p_mgm2\n```\n\n### Volatility & ACF\n\n```{r mgm-vol-acf, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\nmgm <- mgm %>%\n    arrange(Date) %>%\n    mutate(Roll_Vol_20 = zoo::rollapply(Return_Pct, width = 20, FUN = sd, fill = NA, align = \"right\"))\n\np_mgm_vol <- ggplot(mgm, aes(x = Date, y = Roll_Vol_20)) +\n    geom_line(color = \"darkgreen\", linewidth = 0.8) +\n    labs(title = \"MGM: 20-Day Rolling Volatility\", y = \"Volatility (%)\") +\n    theme_minimal()\n\nprint(p_mgm_vol)\n\npar(mfrow = c(1, 2))\nacf(mgm$Return_Pct^2, lag.max = 30, main = \"ACF: Squared Returns (MGM)\")\npacf(mgm$Return_Pct^2, lag.max = 30, main = \"PACF: Squared Returns (MGM)\")\npar(mfrow = c(1, 1))\n```\n\n**Observations**: MGM exhibits similar volatility clustering patterns, characteristic of the gaming/hospitality sector with sports betting exposure.\n\n:::\n\n:::\n\n---\n\n# Model Fitting\n\n::: {.panel-tabset}\n\n## DraftKings (DKNG) Model\n\n::: {.panel-tabset}\n\n### Mean Equation Selection\n\n```{r dkng-mean-models, warning=FALSE, message=FALSE}\n# Prepare data\ndkng_returns <- dkng$Return_Pct\n\n# Fit candidate mean models (without GARCH first)\nmean_models <- list(\n    ARMA00 = arima(dkng_returns, order = c(0, 0, 0)),\n    ARMA10 = arima(dkng_returns, order = c(1, 0, 0)),\n    ARMA01 = arima(dkng_returns, order = c(0, 0, 1)),\n    ARMA11 = arima(dkng_returns, order = c(1, 0, 1))\n)\n\n# Compare AIC\nmean_aic <- data.frame(\n    Model = names(mean_models),\n    AIC = sapply(mean_models, AIC),\n    BIC = sapply(mean_models, BIC)\n)\n\ncat(\"=== Mean Equation Comparison ===\\n\\n\")\nkable(mean_aic,\n    format = \"html\",\n    digits = 2,\n    caption = \"Model Comparison: Mean Equation Only\"\n) %>%\n    kable_styling(\n        full_width = FALSE,\n        bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\")\n    ) %>%\n    row_spec(which.min(mean_aic$AIC), bold = TRUE, color = \"white\", background = \"#006bb6\")\n```\n\n### Check for ARCH Effects\n\n```{r dkng-arch-test, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\n# Use best mean model from AIC\nbest_mean_idx <- which.min(mean_aic$AIC)\nbest_mean_model <- mean_models[[best_mean_idx]]\nbest_mean_name <- names(mean_models)[best_mean_idx]\n\ncat(\"\\nSelected Mean Model:\", best_mean_name, \"\\n\\n\")\n\n# Extract residuals\nresid_mean <- residuals(best_mean_model)\n\n# Plot standardized residuals and squared residuals\npar(mfrow = c(2, 2))\nplot(resid_mean, type = \"l\", main = \"Standardized Residuals\", ylab = \"Residuals\")\nabline(h = 0, col = \"red\", lty = 2)\nplot(resid_mean^2, type = \"l\", main = \"Squared Residuals\", ylab = \"Residuals\")\nacf(resid_mean^2, lag.max = 30, main = \"ACF: Squared Residuals\")\npacf(resid_mean^2, lag.max = 30, main = \"PACF: Squared Residuals\")\npar(mfrow = c(1, 1))\n\n# ARCH LM test\narch_test <- FinTS::ArchTest(resid_mean, lags = 12)\ncat(\"\\n=== ARCH LM Test ===\\n\")\ncat(\"Null Hypothesis: No ARCH effects\\n\")\ncat(\"Chi-squared:\", round(arch_test$statistic, 4), \"\\n\")\ncat(\"p-value:\", format(arch_test$p.value, scientific = TRUE, digits = 4), \"\\n\")\ncat(\"Conclusion:\", ifelse(arch_test$p.value < 0.05,\n    \"REJECT H0 - ARCH effects present, GARCH modeling needed\",\n    \"Fail to reject H0 - No ARCH effects\"\n), \"\\n\")\n```\n\n**Interpretation**:\n\n- **Squared Residuals**: Show clear autocorrelation even after fitting the mean equation\n- **ARCH LM Test**: Highly significant (p < 0.05), confirming ARCH effects\n- **Conclusion**: We need to add a GARCH variance equation to properly model volatility\n\n### Fit ARMA+GARCH Models\n\nNow we fit complete models with GARCH(1,1) variance equation:\n\n```{r dkng-garch-models, warning=FALSE, message=FALSE}\n# Model specifications to test\nmodel_specs <- list(\n    list(formula = ~ garch(1, 1), name = \"ARMA(0,0)+GARCH(1,1)\"),\n    list(formula = ~ arma(1, 0) + garch(1, 1), name = \"ARMA(1,0)+GARCH(1,1)\"),\n    list(formula = ~ arma(0, 1) + garch(1, 1), name = \"ARMA(0,1)+GARCH(1,1)\"),\n    list(formula = ~ arma(1, 1) + garch(1, 1), name = \"ARMA(1,1)+GARCH(1,1)\")\n)\n\n# Fit all models\ngarch_models <- list()\ngarch_results <- data.frame()\n\nfor (spec in model_specs) {\n    # Fit model\n    fit <- tryCatch(\n        {\n            garchFit(formula = spec$formula, data = dkng_returns, trace = FALSE)\n        },\n        error = function(e) {\n            cat(\"Warning: Failed to fit\", spec$name, \"\\n\")\n            NULL\n        }\n    )\n\n    if (!is.null(fit)) {\n        garch_models[[spec$name]] <- fit\n\n        # Extract information criteria\n        aic_val <- fit@fit$ics[\"AIC\"]\n        bic_val <- fit@fit$ics[\"BIC\"]\n        loglik_val <- fit@fit$llh\n\n        garch_results <- rbind(garch_results, data.frame(\n            Model = spec$name,\n            AIC = aic_val,\n            BIC = bic_val,\n            Log_Likelihood = loglik_val\n        ))\n    }\n}\n\ncat(\"=== GARCH Model Comparison ===\\n\\n\")\n```\n\n```{r dkng-garch-table, warning=FALSE, message=FALSE, results='asis', echo=FALSE}\nif (nrow(garch_results) > 0) {\n    kable(garch_results,\n        format = \"html\",\n        digits = 4,\n        caption = \"Model Comparison: ARMA+GARCH(1,1) Models for DKNG\",\n        row.names = FALSE\n    ) %>%\n        kable_styling(\n            full_width = FALSE,\n            bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\")\n        ) %>%\n        row_spec(which.min(garch_results$AIC), bold = TRUE, color = \"white\", background = \"#006bb6\")\n}\n```\n\n```{r dkng-best-model, warning=FALSE, message=FALSE}\n# Select best model\nbest_garch_idx <- which.min(garch_results$AIC)\nbest_garch_name <- garch_results$Model[best_garch_idx]\nbest_garch_model <- garch_models[[best_garch_name]]\n\ncat(\"\\n*** BEST MODEL:\", best_garch_name, \"***\\n\\n\")\ncat(\"Model Coefficients:\\n\")\nprint(coef(best_garch_model))\n```\n\n### Model Diagnostics\n\n```{r dkng-diagnostics, warning=FALSE, message=FALSE, fig.width=12, fig.height=10}\n# Extract standardized residuals\nstd_resid <- residuals(best_garch_model, standardize = TRUE)\n\n# Diagnostic plots\npar(mfrow = c(3, 2))\n\n# 1. Standardized residuals\nplot(std_resid, type = \"l\", main = \"Standardized Residuals\", ylab = \"Std. Residuals\")\nabline(h = 0, col = \"red\", lty = 2)\nabline(h = c(-2, 2), col = \"blue\", lty = 2)\n\n# 2. Squared standardized residuals\nplot(std_resid^2, type = \"l\", main = \"Squared Standardized Residuals\", ylab = \"Std. Residuals\")\n\n# 3. ACF of standardized residuals\nacf(std_resid, lag.max = 20, main = \"ACF: Standardized Residuals\")\n\n# 4. ACF of squared standardized residuals\nacf(std_resid^2, lag.max = 20, main = \"ACF: Squared Std. Residuals\")\n\n# 5. QQ plot\nqqnorm(std_resid, main = \"Q-Q Plot: Standardized Residuals\")\nqqline(std_resid, col = \"red\")\n\n# 6. Histogram\nhist(std_resid, breaks = 50, probability = TRUE, main = \"Distribution of Std. Residuals\", xlab = \"Std. Residuals\")\ncurve(dnorm(x), add = TRUE, col = \"red\", lwd = 2)\n\npar(mfrow = c(1, 1))\n```\n\n```{r dkng-ljung-box, warning=FALSE, message=FALSE}\n# Ljung-Box test on standardized residuals\ncat(\"\\n=== Ljung-Box Test (Standardized Residuals) ===\\n\")\ncat(\"Null Hypothesis: Residuals are white noise (no autocorrelation)\\n\\n\")\n\nlb_test_resid <- Box.test(std_resid, lag = 10, type = \"Ljung-Box\", fitdf = 0)\ncat(\"Lag 10:\\n\")\ncat(\"  Q-statistic:\", round(lb_test_resid$statistic, 4), \"\\n\")\ncat(\"  p-value:\", round(lb_test_resid$p.value, 4), \"\\n\")\ncat(\"  Conclusion:\", ifelse(lb_test_resid$p.value > 0.05,\n    \"No autocorrelation detected (good)\",\n    \"Autocorrelation detected (concern)\"\n), \"\\n\\n\")\n\n# Ljung-Box test on squared standardized residuals\ncat(\"=== Ljung-Box Test (Squared Standardized Residuals) ===\\n\")\ncat(\"Null Hypothesis: No remaining ARCH effects\\n\\n\")\n\nlb_test_sq <- Box.test(std_resid^2, lag = 10, type = \"Ljung-Box\", fitdf = 0)\ncat(\"Lag 10:\\n\")\ncat(\"  Q-statistic:\", round(lb_test_sq$statistic, 4), \"\\n\")\ncat(\"  p-value:\", round(lb_test_sq$p.value, 4), \"\\n\")\ncat(\"  Conclusion:\", ifelse(lb_test_sq$p.value > 0.05,\n    \"ARCH effects successfully captured (good)\",\n    \"Remaining ARCH effects (may need higher order)\"\n), \"\\n\")\n```\n\n**Diagnostic Interpretation**:\n\n- **ACF of Std. Residuals**: No significant autocorrelation (validates mean equation)\n- **Ljung-Box Tests**: p-values > 0.05 indicate the model has adequately captured temporal dependencies\n- **Q-Q Plot**: Some deviation in tails suggests fat-tailed distribution (could consider t-distribution)\n\n### Volatility Forecast\n\n```{r dkng-volatility-forecast, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\n# Extract conditional volatility\ncond_vol <- best_garch_model@sigma.t\n\n# Create data frame for plotting\nvol_df <- data.frame(\n    Date = dkng$Date,\n    Return_Pct = dkng$Return_Pct,\n    Cond_Vol = as.numeric(cond_vol)\n)\n\n# Plot returns with conditional volatility bands\nggplot(vol_df, aes(x = Date)) +\n    geom_line(aes(y = Return_Pct), color = \"black\", alpha = 0.6, linewidth = 0.4) +\n    geom_ribbon(aes(ymin = -2 * Cond_Vol, ymax = 2 * Cond_Vol),\n        fill = \"blue\", alpha = 0.2\n    ) +\n    geom_line(aes(y = 2 * Cond_Vol), color = \"blue\", linetype = \"dashed\", linewidth = 0.6) +\n    geom_line(aes(y = -2 * Cond_Vol), color = \"blue\", linetype = \"dashed\", linewidth = 0.6) +\n    geom_hline(yintercept = 0, linetype = \"solid\", color = \"red\", linewidth = 0.5) +\n    labs(\n        title = \"DKNG: Returns with GARCH Conditional Volatility (2 bands)\",\n        subtitle = \"Blue bands show time-varying volatility forecast\",\n        x = \"Date\",\n        y = \"Return (%)\"\n    ) +\n    theme_minimal()\n\n# Plot conditional volatility over time\nggplot(vol_df, aes(x = Date, y = Cond_Vol)) +\n    geom_line(color = \"darkgreen\", linewidth = 0.8) +\n    labs(\n        title = \"DKNG: GARCH Conditional Volatility Over Time\",\n        subtitle = \"Volatility forecast from GARCH(1,1) model\",\n        x = \"Date\",\n        y = \"Conditional Volatility (%)\"\n    ) +\n    theme_minimal()\n\ncat(\"\\nCurrent Volatility (last observation):\", round(tail(cond_vol, 1), 4), \"%\\n\")\ncat(\"Average Volatility:\", round(mean(cond_vol), 4), \"%\\n\")\ncat(\"Max Volatility:\", round(max(cond_vol), 4), \"%\\n\")\n```\n\n:::\n\n---\n\n## Penn Entertainment (PENN) Model\n\n::: {.panel-tabset}\n\n### Mean Equation & ARCH Test\n\n```{r penn-mean-models, warning=FALSE, message=FALSE}\npenn_returns <- penn$Return_Pct\n\n# Fit candidate mean models\nmean_models_penn <- list(\n    ARMA00 = arima(penn_returns, order = c(0, 0, 0)),\n    ARMA10 = arima(penn_returns, order = c(1, 0, 0)),\n    ARMA01 = arima(penn_returns, order = c(0, 0, 1)),\n    ARMA11 = arima(penn_returns, order = c(1, 0, 1))\n)\n\nmean_aic_penn <- data.frame(\n    Model = names(mean_models_penn),\n    AIC = sapply(mean_models_penn, AIC),\n    BIC = sapply(mean_models_penn, BIC)\n)\n\ncat(\"=== PENN Mean Equation Comparison ===\\n\\n\")\nkable(mean_aic_penn,\n    format = \"html\",\n    digits = 2,\n    caption = \"Model Comparison: Mean Equation Only (PENN)\"\n) %>%\n    kable_styling(\n        full_width = FALSE,\n        bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\")\n    ) %>%\n    row_spec(which.min(mean_aic_penn$AIC), bold = TRUE, color = \"white\", background = \"#006bb6\")\n\n# ARCH test\nbest_mean_penn <- mean_models_penn[[which.min(mean_aic_penn$AIC)]]\nresid_penn <- residuals(best_mean_penn)\n\narch_test_penn <- FinTS::ArchTest(resid_penn, lags = 12)\ncat(\"\\n=== ARCH LM Test (PENN) ===\\n\")\ncat(\"p-value:\", format(arch_test_penn$p.value, scientific = TRUE, digits = 4), \"\\n\")\ncat(\"Conclusion:\", ifelse(arch_test_penn$p.value < 0.05,\n    \"ARCH effects present - GARCH needed\",\n    \"No ARCH effects\"\n), \"\\n\")\n```\n\n### GARCH Model Fitting\n\n```{r penn-garch-models, warning=FALSE, message=FALSE}\ngarch_models_penn <- list()\ngarch_results_penn <- data.frame()\n\nfor (spec in model_specs) {\n    # Fit model using fGarch\n    fit <- tryCatch(\n        {\n            garchFit(formula = spec$formula, data = penn_returns, trace = FALSE)\n        },\n        error = function(e) {\n            cat(\"Warning: Failed to fit\", spec$name, \"for PENN\\n\")\n            NULL\n        }\n    )\n\n    if (!is.null(fit)) {\n        garch_models_penn[[spec$name]] <- fit\n\n        # Extract information criteria\n        aic_val <- fit@fit$ics[\"AIC\"]\n        bic_val <- fit@fit$ics[\"BIC\"]\n        loglik_val <- fit@fit$llh\n\n        garch_results_penn <- rbind(garch_results_penn, data.frame(\n            Model = spec$name,\n            AIC = aic_val,\n            BIC = bic_val,\n            Log_Likelihood = loglik_val\n        ))\n    }\n}\n\ncat(\"=== PENN GARCH Model Comparison ===\\n\\n\")\n```\n\n```{r penn-garch-table, warning=FALSE, message=FALSE, results='asis', echo=FALSE}\nif (nrow(garch_results_penn) > 0) {\n    kable(garch_results_penn,\n        format = \"html\",\n        digits = 4,\n        caption = \"Model Comparison: ARMA+GARCH(1,1) Models for PENN\",\n        row.names = FALSE\n    ) %>%\n        kable_styling(\n            full_width = FALSE,\n            bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\")\n        ) %>%\n        row_spec(which.min(garch_results_penn$AIC), bold = TRUE, color = \"white\", background = \"#006bb6\")\n}\n```\n\n```{r penn-best-model, warning=FALSE, message=FALSE}\nbest_garch_penn <- garch_models_penn[[which.min(garch_results_penn$AIC)]]\nbest_name_penn <- garch_results_penn$Model[which.min(garch_results_penn$AIC)]\n\ncat(\"\\n*** BEST MODEL:\", best_name_penn, \"***\\n\\n\")\ncat(\"Model Coefficients:\\n\")\nprint(coef(best_garch_penn))\n```\n\n### Diagnostics\n\n```{r penn-diagnostics, warning=FALSE, message=FALSE, fig.width=12, fig.height=10}\nstd_resid_penn <- residuals(best_garch_penn, standardize = TRUE)\n\npar(mfrow = c(3, 2))\nplot(std_resid_penn, type = \"l\", main = \"Standardized Residuals (PENN)\")\nabline(h = 0, col = \"red\", lty = 2)\nplot(std_resid_penn^2, type = \"l\", main = \"Squared Std. Residuals (PENN)\")\nacf(std_resid_penn, lag.max = 20, main = \"ACF: Std. Residuals\")\nacf(std_resid_penn^2, lag.max = 20, main = \"ACF: Squared Std. Residuals\")\nqqnorm(std_resid_penn, main = \"Q-Q Plot\")\nqqline(std_resid_penn, col = \"red\")\nhist(std_resid_penn, breaks = 50, probability = TRUE, main = \"Distribution\")\ncurve(dnorm(x), add = TRUE, col = \"red\", lwd = 2)\npar(mfrow = c(1, 1))\n\n# Ljung-Box tests\nlb_penn <- Box.test(std_resid_penn, lag = 10, type = \"Ljung-Box\")\nlb_penn_sq <- Box.test(std_resid_penn^2, lag = 10, type = \"Ljung-Box\")\n\ncat(\"\\nLjung-Box (Std. Residuals): p =\", round(lb_penn$p.value, 4), \"\\n\")\ncat(\"Ljung-Box (Squared): p =\", round(lb_penn_sq$p.value, 4), \"\\n\")\n```\n\n### Volatility Forecast\n\n```{r penn-volatility, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\ncond_vol_penn <- best_garch_penn@sigma.t\n\nvol_df_penn <- data.frame(\n    Date = penn$Date,\n    Return_Pct = penn$Return_Pct,\n    Cond_Vol = as.numeric(cond_vol_penn)\n)\n\nggplot(vol_df_penn, aes(x = Date)) +\n    geom_line(aes(y = Return_Pct), color = \"black\", alpha = 0.6, linewidth = 0.4) +\n    geom_ribbon(aes(ymin = -2 * Cond_Vol, ymax = 2 * Cond_Vol),\n        fill = \"red\", alpha = 0.2\n    ) +\n    geom_line(aes(y = 2 * Cond_Vol), color = \"red\", linetype = \"dashed\", linewidth = 0.6) +\n    geom_line(aes(y = -2 * Cond_Vol), color = \"red\", linetype = \"dashed\", linewidth = 0.6) +\n    geom_hline(yintercept = 0, linetype = \"solid\", color = \"black\", linewidth = 0.5) +\n    labs(\n        title = \"PENN: Returns with GARCH Conditional Volatility\",\n        x = \"Date\", y = \"Return (%)\"\n    ) +\n    theme_minimal()\n\nggplot(vol_df_penn, aes(x = Date, y = Cond_Vol)) +\n    geom_line(color = \"darkred\", linewidth = 0.8) +\n    labs(\n        title = \"PENN: GARCH Conditional Volatility\",\n        x = \"Date\", y = \"Conditional Volatility (%)\"\n    ) +\n    theme_minimal()\n```\n\n:::\n\n## Caesars Entertainment (CZR) Model\n\n::: {.panel-tabset}\n\n### Mean Equation & ARCH Test\n\n```{r czr-mean-models, warning=FALSE, message=FALSE}\nczr_returns <- czr$Return_Pct\n\n# Fit candidate mean models\nmean_models_czr <- list(\n    ARMA00 = arima(czr_returns, order = c(0, 0, 0)),\n    ARMA10 = arima(czr_returns, order = c(1, 0, 0)),\n    ARMA01 = arima(czr_returns, order = c(0, 0, 1)),\n    ARMA11 = arima(czr_returns, order = c(1, 0, 1))\n)\n\nmean_aic_czr <- data.frame(\n    Model = names(mean_models_czr),\n    AIC = sapply(mean_models_czr, AIC),\n    BIC = sapply(mean_models_czr, BIC)\n)\n\ncat(\"=== CZR Mean Equation Comparison ===\\n\\n\")\nkable(mean_aic_czr,\n    format = \"html\",\n    digits = 2,\n    caption = \"Model Comparison: Mean Equation Only (CZR)\"\n) %>%\n    kable_styling(\n        full_width = FALSE,\n        bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\")\n    ) %>%\n    row_spec(which.min(mean_aic_czr$AIC), bold = TRUE, color = \"white\", background = \"#006bb6\")\n\n# ARCH test\nbest_mean_czr <- mean_models_czr[[which.min(mean_aic_czr$AIC)]]\nresid_czr <- residuals(best_mean_czr)\n\ncat(\"\\n\")\n\n# Plot squared residuals\npar(mfrow = c(1, 2))\nacf(resid_czr^2, lag.max = 30, main = \"ACF: Squared Residuals (CZR)\")\npacf(resid_czr^2, lag.max = 30, main = \"PACF: Squared Residuals (CZR)\")\npar(mfrow = c(1, 1))\n\narch_test_czr <- FinTS::ArchTest(resid_czr, lags = 12)\ncat(\"\\n=== ARCH LM Test (CZR) ===\\n\")\ncat(\"Chi-squared:\", round(arch_test_czr$statistic, 4), \"\\n\")\ncat(\"p-value:\", format(arch_test_czr$p.value, scientific = TRUE, digits = 4), \"\\n\")\ncat(\"Conclusion:\", ifelse(arch_test_czr$p.value < 0.05,\n    \"ARCH effects present → GARCH needed\",\n    \"No ARCH effects\"\n), \"\\n\")\n```\n\n**Interpretation**: The ACF/PACF of squared residuals show significant autocorrelation at multiple lags, and the ARCH LM test confirms the presence of ARCH effects. This validates the need for GARCH modeling to capture CZR's time-varying volatility.\n\n### GARCH Model Fitting\n\n```{r czr-garch-models, warning=FALSE, message=FALSE}\ngarch_models_czr <- list()\ngarch_results_czr <- data.frame()\n\nfor (spec in model_specs) {\n    # Fit model using fGarch\n    fit <- tryCatch(\n        {\n            garchFit(formula = spec$formula, data = czr_returns, trace = FALSE)\n        },\n        error = function(e) {\n            cat(\"Warning: Failed to fit\", spec$name, \"for CZR\\n\")\n            NULL\n        }\n    )\n\n    if (!is.null(fit)) {\n        garch_models_czr[[spec$name]] <- fit\n\n        # Extract information criteria\n        aic_val <- fit@fit$ics[\"AIC\"]\n        bic_val <- fit@fit$ics[\"BIC\"]\n        loglik_val <- fit@fit$llh\n\n        garch_results_czr <- rbind(garch_results_czr, data.frame(\n            Model = spec$name,\n            AIC = aic_val,\n            BIC = bic_val,\n            Log_Likelihood = loglik_val\n        ))\n    }\n}\n\ncat(\"=== CZR GARCH Model Comparison ===\\n\\n\")\n```\n\n```{r czr-garch-table, warning=FALSE, message=FALSE, results='asis', echo=FALSE}\nif (nrow(garch_results_czr) > 0) {\n    kable(garch_results_czr,\n        format = \"html\",\n        digits = 4,\n        caption = \"Model Comparison: ARMA+GARCH(1,1) Models for CZR\",\n        row.names = FALSE\n    ) %>%\n        kable_styling(\n            full_width = FALSE,\n            bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\")\n        ) %>%\n        row_spec(which.min(garch_results_czr$AIC), bold = TRUE, color = \"white\", background = \"#006bb6\")\n}\n```\n\n```{r czr-best-model, warning=FALSE, message=FALSE}\nbest_garch_czr <- garch_models_czr[[which.min(garch_results_czr$AIC)]]\nbest_name_czr <- garch_results_czr$Model[which.min(garch_results_czr$AIC)]\n\ncat(\"\\n*** BEST MODEL:\", best_name_czr, \"***\\n\\n\")\ncat(\"Model Coefficients:\\n\")\nprint(coef(best_garch_czr))\n```\n\n**Model Selection Rationale**: The AIC-selected model balances fit and parsimony. CZR exhibits volatility patterns driven by both established gaming operations and newer sports betting ventures.\n\n### Diagnostics\n\n```{r czr-diagnostics, warning=FALSE, message=FALSE, fig.width=12, fig.height=10}\nstd_resid_czr <- residuals(best_garch_czr, standardize = TRUE)\n\npar(mfrow = c(3, 2))\nplot(std_resid_czr, type = \"l\", main = \"Standardized Residuals (CZR)\", ylab = \"Std. Residuals\")\nabline(h = 0, col = \"red\", lty = 2)\nabline(h = c(-2, 2), col = \"blue\", lty = 2)\n\nplot(std_resid_czr^2, type = \"l\", main = \"Squared Std. Residuals (CZR)\", ylab = \"Residuals²\")\n\nacf(std_resid_czr, lag.max = 20, main = \"ACF: Std. Residuals\")\nacf(std_resid_czr^2, lag.max = 20, main = \"ACF: Squared Std. Residuals\")\n\nqqnorm(std_resid_czr, main = \"Q-Q Plot (CZR)\")\nqqline(std_resid_czr, col = \"red\")\n\nhist(std_resid_czr, breaks = 50, probability = TRUE, main = \"Distribution (CZR)\", xlab = \"Std. Residuals\")\ncurve(dnorm(x), add = TRUE, col = \"red\", lwd = 2)\npar(mfrow = c(1, 1))\n\n# Ljung-Box tests\nlb_czr <- Box.test(std_resid_czr, lag = 10, type = \"Ljung-Box\")\nlb_czr_sq <- Box.test(std_resid_czr^2, lag = 10, type = \"Ljung-Box\")\n\ncat(\"\\n=== Ljung-Box Tests (CZR) ===\\n\\n\")\ncat(\"Standardized Residuals: p =\", round(lb_czr$p.value, 4), \"\\n\")\ncat(\"  Conclusion:\", ifelse(lb_czr$p.value > 0.05,\n    \"No autocorrelation (good)\",\n    \"Autocorrelation present (concern)\"\n), \"\\n\\n\")\n\ncat(\"Squared Std. Residuals: p =\", round(lb_czr_sq$p.value, 4), \"\\n\")\ncat(\"  Conclusion:\", ifelse(lb_czr_sq$p.value > 0.05,\n    \"ARCH effects captured (good)\",\n    \"Remaining ARCH effects\"\n), \"\\n\")\n```\n\n**Diagnostic Summary**:\n- Standardized residuals should resemble white noise (no pattern in ACF)\n- Squared residuals ACF tests whether GARCH captured all volatility clustering\n- Ljung-Box p > 0.05 indicates successful model specification\n- Q-Q plot reveals any remaining fat-tail characteristics\n\n### Volatility Forecast\n\n```{r czr-volatility, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\ncond_vol_czr <- best_garch_czr@sigma.t\n\nvol_df_czr <- data.frame(\n    Date = czr$Date,\n    Return_Pct = czr$Return_Pct,\n    Cond_Vol = as.numeric(cond_vol_czr)\n)\n\nggplot(vol_df_czr, aes(x = Date)) +\n    geom_line(aes(y = Return_Pct), color = \"black\", alpha = 0.6, linewidth = 0.4) +\n    geom_ribbon(aes(ymin = -2 * Cond_Vol, ymax = 2 * Cond_Vol),\n        fill = \"darkgreen\", alpha = 0.2\n    ) +\n    geom_line(aes(y = 2 * Cond_Vol), color = \"darkgreen\", linetype = \"dashed\", linewidth = 0.6) +\n    geom_line(aes(y = -2 * Cond_Vol), color = \"darkgreen\", linetype = \"dashed\", linewidth = 0.6) +\n    geom_hline(yintercept = 0, linetype = \"solid\", color = \"black\", linewidth = 0.5) +\n    labs(\n        title = \"CZR: Returns with GARCH Conditional Volatility (±2σ bands)\",\n        subtitle = \"Green bands show time-varying volatility forecast\",\n        x = \"Date\",\n        y = \"Return (%)\"\n    ) +\n    theme_minimal()\n\nggplot(vol_df_czr, aes(x = Date, y = Cond_Vol)) +\n    geom_line(color = \"darkgreen\", linewidth = 0.8) +\n    labs(\n        title = \"CZR: GARCH Conditional Volatility Over Time\",\n        subtitle = \"Volatility reflects both casino operations and sports betting integration\",\n        x = \"Date\",\n        y = \"Conditional Volatility (%)\"\n    ) +\n    theme_minimal()\n\ncat(\"\\nCurrent Volatility (last observation):\", round(tail(cond_vol_czr, 1), 4), \"%\\n\")\ncat(\"Average Volatility:\", round(mean(cond_vol_czr), 4), \"%\\n\")\ncat(\"Max Volatility:\", round(max(cond_vol_czr), 4), \"%\\n\")\n```\n\n**Volatility Interpretation**: CZR's conditional volatility shows periods of elevated risk during major corporate events. The GARCH model successfully tracks these time-varying patterns, providing valuable risk forecasts for portfolio managers and options traders.\n\n:::\n\n## MGM Resorts (MGM) Model\n\n::: {.panel-tabset}\n\n### Mean Equation & ARCH Test\n\n```{r mgm-mean-models, warning=FALSE, message=FALSE}\nmgm_returns <- mgm$Return_Pct\n\n# Fit candidate mean models\nmean_models_mgm <- list(\n    ARMA00 = arima(mgm_returns, order = c(0, 0, 0)),\n    ARMA10 = arima(mgm_returns, order = c(1, 0, 0)),\n    ARMA01 = arima(mgm_returns, order = c(0, 0, 1)),\n    ARMA11 = arima(mgm_returns, order = c(1, 0, 1))\n)\n\nmean_aic_mgm <- data.frame(\n    Model = names(mean_models_mgm),\n    AIC = sapply(mean_models_mgm, AIC),\n    BIC = sapply(mean_models_mgm, BIC)\n)\n\ncat(\"=== MGM Mean Equation Comparison ===\\n\\n\")\nkable(mean_aic_mgm,\n    format = \"html\",\n    digits = 2,\n    caption = \"Model Comparison: Mean Equation Only (MGM)\"\n) %>%\n    kable_styling(\n        full_width = FALSE,\n        bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\")\n    ) %>%\n    row_spec(which.min(mean_aic_mgm$AIC), bold = TRUE, color = \"white\", background = \"#006bb6\")\n\n# ARCH test\nbest_mean_mgm <- mean_models_mgm[[which.min(mean_aic_mgm$AIC)]]\nresid_mgm <- residuals(best_mean_mgm)\n\ncat(\"\\n\")\n\n# Plot squared residuals\npar(mfrow = c(1, 2))\nacf(resid_mgm^2, lag.max = 30, main = \"ACF: Squared Residuals (MGM)\")\npacf(resid_mgm^2, lag.max = 30, main = \"PACF: Squared Residuals (MGM)\")\npar(mfrow = c(1, 1))\n\narch_test_mgm <- FinTS::ArchTest(resid_mgm, lags = 12)\ncat(\"\\n=== ARCH LM Test (MGM) ===\\n\")\ncat(\"Chi-squared:\", round(arch_test_mgm$statistic, 4), \"\\n\")\ncat(\"p-value:\", format(arch_test_mgm$p.value, scientific = TRUE, digits = 4), \"\\n\")\ncat(\"Conclusion:\", ifelse(arch_test_mgm$p.value < 0.05,\n    \"ARCH effects present → GARCH needed\",\n    \"No ARCH effects\"\n), \"\\n\")\n```\n\n**Interpretation**: Despite MGM's diversified business model, the stock still exhibits ARCH effects, though potentially milder than pure-play sports betting stocks. The ARCH LM test confirms time-varying volatility requiring GARCH specification.\n\n### GARCH Model Fitting\n\n```{r mgm-garch-models, warning=FALSE, message=FALSE}\ngarch_models_mgm <- list()\ngarch_results_mgm <- data.frame()\n\nfor (spec in model_specs) {\n    # Fit model using fGarch\n    fit <- tryCatch(\n        {\n            garchFit(formula = spec$formula, data = mgm_returns, trace = FALSE)\n        },\n        error = function(e) {\n            cat(\"Warning: Failed to fit\", spec$name, \"for MGM\\n\")\n            NULL\n        }\n    )\n\n    if (!is.null(fit)) {\n        garch_models_mgm[[spec$name]] <- fit\n\n        # Extract information criteria\n        aic_val <- fit@fit$ics[\"AIC\"]\n        bic_val <- fit@fit$ics[\"BIC\"]\n        loglik_val <- fit@fit$llh\n\n        garch_results_mgm <- rbind(garch_results_mgm, data.frame(\n            Model = spec$name,\n            AIC = aic_val,\n            BIC = bic_val,\n            Log_Likelihood = loglik_val\n        ))\n    }\n}\n\ncat(\"=== MGM GARCH Model Comparison ===\\n\\n\")\n```\n\n```{r mgm-garch-table, warning=FALSE, message=FALSE, results='asis', echo=FALSE}\nif (nrow(garch_results_mgm) > 0) {\n    kable(garch_results_mgm,\n        format = \"html\",\n        digits = 4,\n        caption = \"Model Comparison: ARMA+GARCH(1,1) Models for MGM\",\n        row.names = FALSE\n    ) %>%\n        kable_styling(\n            full_width = FALSE,\n            bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\")\n        ) %>%\n        row_spec(which.min(garch_results_mgm$AIC), bold = TRUE, color = \"white\", background = \"#006bb6\")\n}\n```\n\n```{r mgm-best-model, warning=FALSE, message=FALSE}\nbest_garch_mgm <- garch_models_mgm[[which.min(garch_results_mgm$AIC)]]\nbest_name_mgm <- garch_results_mgm$Model[which.min(garch_results_mgm$AIC)]\n\ncat(\"\\n*** BEST MODEL:\", best_name_mgm, \"***\\n\\n\")\ncat(\"Model Coefficients:\\n\")\nprint(coef(best_garch_mgm))\n```\n\n**Model Selection Rationale**: The selected GARCH(1,1) specification for MGM captures volatility persistence while maintaining parsimony. MGM's diversified operations (Las Vegas Strip properties, regional casinos, BetMGM, entertainment venues) create a more stable volatility profile compared to pure-play operators, which should be reflected in the model coefficients.\n\n### Diagnostics\n\n```{r mgm-diagnostics, warning=FALSE, message=FALSE, fig.width=12, fig.height=10}\nstd_resid_mgm <- residuals(best_garch_mgm, standardize = TRUE)\n\npar(mfrow = c(3, 2))\nplot(std_resid_mgm, type = \"l\", main = \"Standardized Residuals (MGM)\", ylab = \"Std. Residuals\")\nabline(h = 0, col = \"red\", lty = 2)\nabline(h = c(-2, 2), col = \"blue\", lty = 2)\n\nplot(std_resid_mgm^2, type = \"l\", main = \"Squared Std. Residuals (MGM)\", ylab = \"Residuals²\")\n\nacf(std_resid_mgm, lag.max = 20, main = \"ACF: Std. Residuals\")\nacf(std_resid_mgm^2, lag.max = 20, main = \"ACF: Squared Std. Residuals\")\n\nqqnorm(std_resid_mgm, main = \"Q-Q Plot (MGM)\")\nqqline(std_resid_mgm, col = \"red\")\n\nhist(std_resid_mgm, breaks = 50, probability = TRUE, main = \"Distribution (MGM)\", xlab = \"Std. Residuals\")\ncurve(dnorm(x), add = TRUE, col = \"red\", lwd = 2)\npar(mfrow = c(1, 1))\n\n# Ljung-Box tests\nlb_mgm <- Box.test(std_resid_mgm, lag = 10, type = \"Ljung-Box\")\nlb_mgm_sq <- Box.test(std_resid_mgm^2, lag = 10, type = \"Ljung-Box\")\n\ncat(\"\\n=== Ljung-Box Tests (MGM) ===\\n\\n\")\ncat(\"Standardized Residuals: p =\", round(lb_mgm$p.value, 4), \"\\n\")\ncat(\"  Conclusion:\", ifelse(lb_mgm$p.value > 0.05,\n    \"No autocorrelation (good)\",\n    \"Autocorrelation present (concern)\"\n), \"\\n\\n\")\n\ncat(\"Squared Std. Residuals: p =\", round(lb_mgm_sq$p.value, 4), \"\\n\")\ncat(\"  Conclusion:\", ifelse(lb_mgm_sq$p.value > 0.05,\n    \"ARCH effects captured (good)\",\n    \"Remaining ARCH effects\"\n), \"\\n\")\n```\n\n**Diagnostic Summary**: MGM's standardized residuals should show cleaner behavior than PENN or DKNG, reflecting the stabilizing effect of diversified revenue streams. Successful diagnostics (Ljung-Box p > 0.05) indicate the GARCH model adequately captures MGM's conditional volatility dynamics.\n\n### Volatility Forecast\n\n```{r mgm-volatility, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\ncond_vol_mgm <- best_garch_mgm@sigma.t\n\nvol_df_mgm <- data.frame(\n    Date = mgm$Date,\n    Return_Pct = mgm$Return_Pct,\n    Cond_Vol = as.numeric(cond_vol_mgm)\n)\n\nggplot(vol_df_mgm, aes(x = Date)) +\n    geom_line(aes(y = Return_Pct), color = \"black\", alpha = 0.6, linewidth = 0.4) +\n    geom_ribbon(aes(ymin = -2 * Cond_Vol, ymax = 2 * Cond_Vol),\n        fill = \"darkorange\", alpha = 0.2\n    ) +\n    geom_line(aes(y = 2 * Cond_Vol), color = \"darkorange\", linetype = \"dashed\", linewidth = 0.6) +\n    geom_line(aes(y = -2 * Cond_Vol), color = \"darkorange\", linetype = \"dashed\", linewidth = 0.6) +\n    geom_hline(yintercept = 0, linetype = \"solid\", color = \"black\", linewidth = 0.5) +\n    labs(\n        title = \"MGM: Returns with GARCH Conditional Volatility (±2σ bands)\",\n        subtitle = \"Orange bands show time-varying volatility forecast\",\n        x = \"Date\",\n        y = \"Return (%)\"\n    ) +\n    theme_minimal()\n\nggplot(vol_df_mgm, aes(x = Date, y = Cond_Vol)) +\n    geom_line(color = \"darkorange\", linewidth = 0.8) +\n    labs(\n        title = \"MGM: GARCH Conditional Volatility Over Time\",\n        subtitle = \"Most stable volatility profile among all sports betting stocks\",\n        x = \"Date\",\n        y = \"Conditional Volatility (%)\"\n    ) +\n    theme_minimal()\n\ncat(\"\\nCurrent Volatility (last observation):\", round(tail(cond_vol_mgm, 1), 4), \"%\\n\")\ncat(\"Average Volatility:\", round(mean(cond_vol_mgm), 4), \"%\\n\")\ncat(\"Max Volatility:\", round(max(cond_vol_mgm), 4), \"%\\n\")\n```\n\n**Volatility Interpretation**: MGM's conditional volatility time series shows the lowest average volatility among all four stocks, confirming that diversification provides natural hedging against sector-specific shocks. The GARCH forecasts are particularly valuable for MGM during major events that create temporary volatility spikes.\n\n:::\n\n:::\n\n---\n\n# Model Equations\n\n::: {.panel-tabset}\n\n## DraftKings (DKNG)\n\n```{r dkng-equation-setup, echo=FALSE}\n# Extract coefficients\ndkng_coef <- coef(best_garch_model)\n\n# Mean equation coefficients\nmu_dkng <- ifelse(\"mu\" %in% names(dkng_coef), dkng_coef[\"mu\"], 0)\nar1_dkng <- ifelse(\"ar1\" %in% names(dkng_coef), dkng_coef[\"ar1\"], 0)\nma1_dkng <- ifelse(\"ma1\" %in% names(dkng_coef), dkng_coef[\"ma1\"], 0)\n\n# Variance equation coefficients\nomega_dkng <- dkng_coef[\"omega\"]\nalpha1_dkng <- dkng_coef[\"alpha1\"]\nbeta1_dkng <- dkng_coef[\"beta1\"]\n\n# Persistence\npersistence_dkng <- alpha1_dkng + beta1_dkng\n```\n\n**Selected Model**: `r best_garch_name`\n\n### Mean Equation\n\n$$\nr_t = `r round(mu_dkng, 6)` + \\epsilon_t\n$$\n\nwhere $\\epsilon_t = \\sigma_t z_t$ and $z_t \\sim N(0, 1)$\n\n### Variance Equation (GARCH(1,1))\n\n$$\n\\sigma_t^2 = `r round(omega_dkng, 6)` + `r round(alpha1_dkng, 6)` \\epsilon_{t-1}^2 + `r round(beta1_dkng, 6)` \\sigma_{t-1}^2\n$$\n\n**Unconditional Variance**:\n\n$$\n\\sigma^2_{\\text{unconditional}} = \\frac{\\omega}{1 - \\alpha_1 - \\beta_1} = \\frac{`r round(omega_dkng, 6)`}{1 - `r round(persistence_dkng, 4)`} = `r round(omega_dkng / (1 - persistence_dkng), 4)`\n$$\n\nUnconditional volatility: `r round(sqrt(omega_dkng / (1 - persistence_dkng)), 4)`%\n\n## Penn Entertainment (PENN)\n\n```{r penn-equation-setup, echo=FALSE}\npenn_coef <- coef(best_garch_penn)\n\nmu_penn <- ifelse(\"mu\" %in% names(penn_coef), penn_coef[\"mu\"], 0)\nar1_penn <- ifelse(\"ar1\" %in% names(penn_coef), penn_coef[\"ar1\"], 0)\nma1_penn <- ifelse(\"ma1\" %in% names(penn_coef), penn_coef[\"ma1\"], 0)\n\nomega_penn <- penn_coef[\"omega\"]\nalpha1_penn <- penn_coef[\"alpha1\"]\nbeta1_penn <- penn_coef[\"beta1\"]\n\npersistence_penn <- alpha1_penn + beta1_penn\n```\n\n**Selected Model**: `r best_name_penn`\n\n### Mean Equation\n\n$$\nr_t = `r round(mu_penn, 6)` + \\epsilon_t\n$$\n\n### Variance Equation (GARCH(1,1))\n\n$$\n\\sigma_t^2 = `r round(omega_penn, 6)` + `r round(alpha1_penn, 6)` \\epsilon_{t-1}^2 + `r round(beta1_penn, 6)` \\sigma_{t-1}^2\n$$\n\n## Caesars Entertainment (CZR)\n\n```{r czr-equation-setup, echo=FALSE}\nczr_coef <- coef(best_garch_czr)\n\nmu_czr <- ifelse(\"mu\" %in% names(czr_coef), czr_coef[\"mu\"], 0)\nar1_czr <- ifelse(\"ar1\" %in% names(czr_coef), czr_coef[\"ar1\"], 0)\nma1_czr <- ifelse(\"ma1\" %in% names(czr_coef), czr_coef[\"ma1\"], 0)\n\nomega_czr <- czr_coef[\"omega\"]\nalpha1_czr <- czr_coef[\"alpha1\"]\nbeta1_czr <- czr_coef[\"beta1\"]\n\npersistence_czr <- alpha1_czr + beta1_czr\n```\n\n**Selected Model**: `r best_name_czr`\n\n### Mean Equation\n\n$$\nr_t = `r round(mu_czr, 6)` + \\epsilon_t\n$$\n\nwhere $\\epsilon_t = \\sigma_t z_t$ and $z_t \\sim N(0, 1)$\n\n### Variance Equation (GARCH(1,1))\n\n$$\n\\sigma_t^2 = `r round(omega_czr, 6)` + `r round(alpha1_czr, 6)` \\epsilon_{t-1}^2 + `r round(beta1_czr, 6)` \\sigma_{t-1}^2\n$$\n\n**Unconditional Variance**:\n\n$$\n\\sigma^2_{\\text{unconditional}} = \\frac{\\omega}{1 - \\alpha_1 - \\beta_1} = \\frac{`r round(omega_czr, 6)`}{1 - `r round(persistence_czr, 4)`} = `r round(omega_czr / (1 - persistence_czr), 4)`\n$$\n\nUnconditional volatility: `r round(sqrt(omega_czr / (1 - persistence_czr)), 4)`%\n\n## MGM Resorts (MGM)\n\n```{r mgm-equation-setup, echo=FALSE}\nmgm_coef <- coef(best_garch_mgm)\n\nmu_mgm <- ifelse(\"mu\" %in% names(mgm_coef), mgm_coef[\"mu\"], 0)\nar1_mgm <- ifelse(\"ar1\" %in% names(mgm_coef), mgm_coef[\"ar1\"], 0)\nma1_mgm <- ifelse(\"ma1\" %in% names(mgm_coef), mgm_coef[\"ma1\"], 0)\n\nomega_mgm <- mgm_coef[\"omega\"]\nalpha1_mgm <- mgm_coef[\"alpha1\"]\nbeta1_mgm <- mgm_coef[\"beta1\"]\n\npersistence_mgm <- alpha1_mgm + beta1_mgm\n```\n\n**Selected Model**: `r best_name_mgm`\n\n### Mean Equation\n\n$$\nr_t = `r round(mu_mgm, 6)` + \\epsilon_t\n$$\n\nwhere $\\epsilon_t = \\sigma_t z_t$ and $z_t \\sim N(0, 1)$\n\n### Variance Equation (GARCH(1,1))\n\n$$\n\\sigma_t^2 = `r round(omega_mgm, 6)` + `r round(alpha1_mgm, 6)` \\epsilon_{t-1}^2 + `r round(beta1_mgm, 6)` \\sigma_{t-1}^2\n$$\n\n**Unconditional Variance**:\n\n$$\n\\sigma^2_{\\text{unconditional}} = \\frac{\\omega}{1 - \\alpha_1 - \\beta_1} = \\frac{`r round(omega_mgm, 6)`}{1 - `r round(persistence_mgm, 4)`} = `r round(omega_mgm / (1 - persistence_mgm), 4)`\n$$\n\nUnconditional volatility: `r round(sqrt(omega_mgm / (1 - persistence_mgm)), 4)`% (lowest among all four stocks)\n\n**Business Model Impact**: MGM's lower volatility parameters directly reflect its diversified operations. The smaller $\\alpha_1$ suggests that MGM's stock is less sensitive to short-term shocks, while moderate $\\beta_1$ indicates reasonable volatility persistence.\n\n:::\n\n---\n\n# Cross-Stock Comparison\n\nNow that we've analyzed individual stocks, let's compare volatility dynamics across all four sports betting companies.\n\n::: {.panel-tabset}\n\n## Volatility Comparison\n\n```{r volatility-comparison, warning=FALSE, message=FALSE, fig.width=14, fig.height=10}\n# Combine all returns data\nall_returns <- bind_rows(\n    dkng %>% dplyr::select(Date, Return_Pct, Ticker),\n    penn %>% dplyr::select(Date, Return_Pct, Ticker),\n    czr %>% dplyr::select(Date, Return_Pct, Ticker),\n    mgm %>% dplyr::select(Date, Return_Pct, Ticker)\n)\n\n# Plot all returns together\np_all_returns <- ggplot(all_returns, aes(x = Date, y = Return_Pct, color = Ticker)) +\n    geom_line(alpha = 0.5, linewidth = 0.3) +\n    facet_wrap(~Ticker, ncol = 1) +\n    geom_hline(yintercept = 0, linetype = \"dashed\", color = \"black\") +\n    labs(\n        title = \"Daily Returns Comparison: All Sports Betting Stocks\",\n        subtitle = \"Volatility clustering visible across all stocks\",\n        x = \"Date\",\n        y = \"Return (%)\"\n    ) +\n    scale_color_manual(values = c(\n        \"DKNG\" = \"#006bb6\", \"PENN\" = \"darkred\",\n        \"CZR\" = \"darkgreen\", \"MGM\" = \"darkorange\"\n    )) +\n    theme_minimal() +\n    theme(legend.position = \"none\")\n\nprint(p_all_returns)\n\n# Rolling volatility comparison\nall_vol <- bind_rows(\n    dkng %>% dplyr::select(Date, Roll_Vol_20, Ticker),\n    penn %>% dplyr::select(Date, Roll_Vol_20, Ticker),\n    czr %>% dplyr::select(Date, Roll_Vol_20, Ticker),\n    mgm %>% dplyr::select(Date, Roll_Vol_20, Ticker)\n) %>% filter(!is.na(Roll_Vol_20))\n\np_vol_comp <- ggplot(all_vol, aes(x = Date, y = Roll_Vol_20, color = Ticker)) +\n    geom_line(linewidth = 0.8, alpha = 0.8) +\n    labs(\n        title = \"20-Day Rolling Volatility Comparison\",\n        subtitle = \"PENN shows highest volatility, MGM most stable\",\n        x = \"Date\",\n        y = \"Volatility (% std dev)\",\n        color = \"Stock\"\n    ) +\n    scale_color_manual(values = c(\n        \"DKNG\" = \"#006bb6\", \"PENN\" = \"darkred\",\n        \"CZR\" = \"darkgreen\", \"MGM\" = \"darkorange\"\n    )) +\n    theme_minimal() +\n    theme(legend.position = \"right\")\n\nprint(p_vol_comp)\n\n# Save for conclusion\nggsave(\"images/betting_stocks_volatility.png\", plot = p_vol_comp, width = 14, height = 8, dpi = 300, bg = \"white\")\n```\n\n**Key Observations**:\n\n- **PENN** exhibits the highest volatility throughout the period, reflecting business model uncertainty\n- **MGM** shows the most stable returns, benefiting from diversified resort operations\n- **DKNG** and **CZR** display moderate volatility, typical of focused sports betting operators\n- All stocks show synchronized volatility spikes during market-wide events (COVID, regulatory news)\n\n## Statistical Summary\n\n```{r stats-summary-table, warning=FALSE, message=FALSE, results='asis', echo=FALSE}\n# Create comprehensive summary table\nsummary_stats <- data.frame(\n    Stock = c(\"DKNG\", \"PENN\", \"CZR\", \"MGM\"),\n    Mean_Return = c(\n        mean(dkng$Return_Pct), mean(penn$Return_Pct),\n        mean(czr$Return_Pct), mean(mgm$Return_Pct)\n    ),\n    Volatility = c(\n        sd(dkng$Return_Pct), sd(penn$Return_Pct),\n        sd(czr$Return_Pct), sd(mgm$Return_Pct)\n    ),\n    Min_Return = c(\n        min(dkng$Return_Pct), min(penn$Return_Pct),\n        min(czr$Return_Pct), min(mgm$Return_Pct)\n    ),\n    Max_Return = c(\n        max(dkng$Return_Pct), max(penn$Return_Pct),\n        max(czr$Return_Pct), max(mgm$Return_Pct)\n    ),\n    Skewness = c(\n        moments::skewness(dkng$Return_Pct), moments::skewness(penn$Return_Pct),\n        moments::skewness(czr$Return_Pct), moments::skewness(mgm$Return_Pct)\n    ),\n    Kurtosis = c(\n        moments::kurtosis(dkng$Return_Pct), moments::kurtosis(penn$Return_Pct),\n        moments::kurtosis(czr$Return_Pct), moments::kurtosis(mgm$Return_Pct)\n    )\n)\n\nkable(summary_stats,\n    format = \"html\",\n    digits = 4,\n    caption = \"Comparative Summary Statistics: Sports Betting Stocks\",\n    col.names = c(\n        \"Stock\", \"Mean Return (%)\", \"Volatility (%)\", \"Min Return (%)\",\n        \"Max Return (%)\", \"Skewness\", \"Kurtosis\"\n    )\n) %>%\n    kable_styling(\n        full_width = FALSE,\n        bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\")\n    ) %>%\n    row_spec(which.max(summary_stats$Volatility), bold = TRUE, color = \"white\", background = \"#8B0000\") %>%\n    row_spec(which.min(summary_stats$Volatility), bold = TRUE, color = \"white\", background = \"#006400\")\n```\n\n## Return Distributions\n\n```{r return-distributions, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\n# Density plots\nggplot(all_returns, aes(x = Return_Pct, fill = Ticker)) +\n    geom_density(alpha = 0.5) +\n    facet_wrap(~Ticker, scales = \"free_y\") +\n    labs(\n        title = \"Return Distribution Comparison\",\n        subtitle = \"All stocks show fat tails (leptokurtic distributions)\",\n        x = \"Return (%)\",\n        y = \"Density\"\n    ) +\n    scale_fill_manual(values = c(\n        \"DKNG\" = \"#006bb6\", \"PENN\" = \"darkred\",\n        \"CZR\" = \"darkgreen\", \"MGM\" = \"darkorange\"\n    )) +\n    geom_vline(xintercept = 0, linetype = \"dashed\", color = \"black\") +\n    theme_minimal() +\n    theme(legend.position = \"none\")\n\n# Box plots\nggplot(all_returns, aes(x = Ticker, y = Return_Pct, fill = Ticker)) +\n    geom_boxplot(alpha = 0.7, outlier.alpha = 0.3) +\n    labs(\n        title = \"Return Distribution Box Plots\",\n        subtitle = \"PENN shows widest range and most extreme outliers\",\n        x = \"Stock\",\n        y = \"Return (%)\"\n    ) +\n    scale_fill_manual(values = c(\n        \"DKNG\" = \"#006bb6\", \"PENN\" = \"darkred\",\n        \"CZR\" = \"darkgreen\", \"MGM\" = \"darkorange\"\n    )) +\n    geom_hline(yintercept = 0, linetype = \"dashed\", color = \"red\") +\n    theme_minimal() +\n    theme(legend.position = \"none\")\n```\n\n## Correlation Analysis\n\n```{r correlation-analysis, warning=FALSE, message=FALSE, fig.width=10, fig.height=8, results='asis'}\n# Create wide format for correlation\nreturns_wide <- all_returns %>%\n    dplyr::select(Date, Ticker, Return_Pct) %>%\n    pivot_wider(names_from = Ticker, values_from = Return_Pct) %>%\n    dplyr::select(-Date) %>%\n    na.omit()\n\n# Correlation matrix\ncor_matrix <- cor(returns_wide)\n\n# Display formatted correlation matrix table\ncat(\"### Correlation Matrix\\n\\n\")\nkable(round(cor_matrix, 3),\n    format = \"html\",\n    digits = 3,\n    caption = \"Return Correlations Among Sports Betting Stocks\"\n) %>%\n    kable_styling(\n        full_width = FALSE,\n        bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\")\n    )\n\n# Heatmap\nlibrary(reshape2)\ncor_melted <- melt(cor_matrix)\n\nggplot(cor_melted, aes(Var1, Var2, fill = value)) +\n    geom_tile(color = \"white\") +\n    geom_text(aes(label = round(value, 2)), color = \"black\", size = 5, fontface = \"bold\") +\n    scale_fill_gradient2(\n        low = \"#d1e5f0\", high = \"#006bb6\", mid = \"white\",\n        midpoint = 0, limit = c(-1, 1), space = \"Lab\",\n        name = \"Correlation\"\n    ) +\n    labs(\n        title = \"Return Correlation Heatmap\",\n        subtitle = \"Sports betting stocks show moderate to high positive correlation\",\n        x = NULL, y = NULL\n    ) +\n    theme_minimal() +\n    theme(\n        axis.text.x = element_text(angle = 45, hjust = 1, size = 11),\n        axis.text.y = element_text(size = 11),\n        plot.title = element_text(face = \"bold\")\n    )\n```\n\n**Correlation Insights**:\n\n- All stocks show **positive correlation** (0.3-0.7), indicating they respond to common industry factors\n- **CZR-MGM** show highest correlation (~0.6-0.7): both traditional casino operators\n- **DKNG-PENN** moderate correlation (~0.4-0.5): pure-play sports betting focus\n- Correlations increase during crisis periods (systematic risk)\n\n## Business Model Comparison\n\n::: {style=\"font-size: 0.9em;\"}\n\n| Stock | Business Model | Volatility Profile | Key Risks |\n|-------|---------------|-------------------|-----------|\n| **DKNG** | Pure-play online sports betting & DFS | Moderate-High | Regulatory, competition, customer acquisition costs |\n| **PENN** | Regional casinos + ESPN BET partnership | **Highest** | Business model transition, brand partnerships |\n| **CZR** | Casino operator + Caesars Sportsbook | Moderate | Debt levels, integration risks, competition |\n| **MGM** | Resort/casino + BetMGM | **Lowest** | Diversified operations reduce volatility |\n\n:::\n\n:::\n\n---\n\n# Bridging to Deep Learning for Time Series\n\nThe financial models above demonstrate that sports betting stocks exhibit classic volatility clustering patterns captured by ARCH/GARCH frameworks. DKNG, PENN, CZR, and MGM show time-varying variance where turbulent periods persist before giving way to calm. These models excel at forecasting **conditional volatility**—predicting the uncertainty around returns rather than the returns themselves—making them essential for risk management and options pricing.\n\nYet ARCH/GARCH models share a fundamental assumption with ARIMA and VAR: they impose **explicit parametric structure**. GARCH(1,1) assumes today's variance depends on yesterday's variance and yesterday's squared return with fixed coefficients. ARIMA(p,d,q) requires us to specify lag orders before fitting. These models demand domain expertise and statistical judgment, making them powerful when assumptions hold but brittle when reality deviates.\n\n**The deep learning alternative** abandons explicit parameterization in favor of learned representations. Recurrent neural networks (RNNs), Long Short-Term Memory (LSTM), and Gated Recurrent Units (GRUs) automatically discover temporal patterns through gradient descent rather than requiring analysts to pre-specify AR and MA terms. This flexibility enables deep learning models to capture complex nonlinearities, long-range dependencies, and regime shifts that defy simple parametric forms.\n\n**The next chapter** tests whether this flexibility improves forecasts or simply overfits limited data. With only 45 years of NBA data, do LSTM's 1,600+ parameters extract genuine signal or memorize noise? The comparison is direct: identical train/test splits, identical evaluation metrics (RMSE, MAE), identical target variable (ORtg). Traditional methods have interpretable coefficients and well-understood statistical properties; deep learning offers representational power but requires careful regularization.\n\n**What you'll see next:**\n\n- **RNN, LSTM, and GRU architectures** applied to NBA offensive efficiency forecasting, with explicit comparison to ARIMA baselines\n- **Regularization techniques** (L2 penalties, dropout, early stopping) that prevent overfitting on small datasets\n- **Input windowing** that transforms annual observations into supervised learning sequences (5-year windows → 1-year ahead)\n- **Performance comparison tables** showing whether deep learning adds value beyond traditional methods for sports analytics\n\nThe transition from financial to deep learning models reflects a methodological tension in modern forecasting: **parametric parsimony versus representational flexibility**. GARCH models have 2-3 parameters; LSTMs have thousands. For volatile betting stocks with rich intraday data, that complexity may capture genuine structure. For annual NBA statistics with 45 observations, it may simply overfit.\n\n**The critical question:** Does basketball's evolution exhibit patterns too complex for ARIMA's linear assumptions but too simple for LSTM's deep architecture? Or do we sit in the sweet spot where both approaches offer complementary insights? The empirical comparison tests whether sports analytics has entered the deep learning era or whether classical time series methods remain the gold standard for data-scarce domains.\n\nWhere GARCH asked \"How does volatility evolve?\", deep learning asks \"What temporal patterns can we learn without assuming functional form?\" Both frameworks forecast the future, but from opposite epistemological starting points: theory-driven specification versus data-driven discovery.\n\n---\n","srcMarkdownNoYaml":"\n\n# Theoretical Framework\n\n## Overview\n\nHaving established the relationship between NBA performance and betting markets, we now shift our focus to the financial behavior of sports betting stocks themselves. In this chapter, these firms are treated as an independent financial ecosystem shaped by sports events, regulatory changes, and broader market forces. Financial returns exhibit volatility clustering, where periods of high or low volatility tend to persist. Because ARIMA models assume constant variance, they are not well suited for data with this property. GARCH models address this limitation by explicitly capturing time-varying volatility. The key insight is that while returns may be unpredictable due to market efficiency, volatility often follows predictable patterns that are essential for risk management, options pricing, and portfolio optimization.\n\n---\n\n```{r setup, warning=FALSE, message=FALSE}\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(forecast)\nlibrary(astsa)\nlibrary(xts)\nlibrary(tseries)\nlibrary(fpp2)\nlibrary(fma)\nlibrary(lubridate)\nlibrary(TSstudio)\nlibrary(quantmod)\nlibrary(tidyquant)\nlibrary(plotly)\nlibrary(imputeTS)\nlibrary(dplyr)\nlibrary(reshape2)\nlibrary(gridExtra)\nlibrary(zoo)\nlibrary(kableExtra)\nlibrary(vars)\nlibrary(patchwork)\nlibrary(moments)\nlibrary(fGarch)\n\ntheme_set(theme_minimal(base_size = 12))\n```\n\n```{r load-data, warning=FALSE, message=FALSE}\n# Load all stock data\ndkng <- read_csv(\"data/financial/DKNG_daily.csv\", show_col_types = FALSE)\ncolnames(dkng) <- gsub(\"Adj Close\", \"Adj_Close\", colnames(dkng))\ndkng <- dkng %>%\n    mutate(Date = as.Date(Date)) %>%\n    arrange(Date)\n\npenn <- read_csv(\"data/financial/PENN_daily.csv\", show_col_types = FALSE)\ncolnames(penn) <- gsub(\"Adj Close\", \"Adj_Close\", colnames(penn))\npenn <- penn %>%\n    mutate(Date = as.Date(Date)) %>%\n    arrange(Date)\n\nczr <- read_csv(\"data/financial/CZR_daily.csv\", show_col_types = FALSE)\ncolnames(czr) <- gsub(\"Adj\\\\.Close\", \"Adj_Close\", colnames(czr))\n\nif (\"Adj_Close\" %in% colnames(czr)) {\n    czr$Adj_Close <- as.numeric(czr$Adj_Close)\n}\nczr <- czr %>%\n    mutate(Date = as.Date(Date)) %>%\n    arrange(Date)\n\nmgm <- read_csv(\"data/financial/MGM_daily.csv\", show_col_types = FALSE)\ncolnames(mgm) <- gsub(\"Adj\\\\.Close\", \"Adj_Close\", colnames(mgm))\n\nif (\"Adj_Close\" %in% colnames(mgm)) {\n    mgm$Adj_Close <- as.numeric(mgm$Adj_Close)\n}\nmgm <- mgm %>%\n    mutate(Date = as.Date(Date)) %>%\n    arrange(Date)\n```\n\n## Calculate Returns\n\nFinancial time series models typically work with **returns** rather than prices. So, we calculate **log returns** (continuously compounded):\n\n$$\nr_t = \\ln(P_t) - \\ln(P_{t-1}) = \\ln\\left(\\frac{P_t}{P_{t-1}}\\right)\n$$\n\n```{r calculate-returns, warning=FALSE, message=FALSE}\n# Calculate log returns for all stocks\ndkng$LogReturn <- c(NA, diff(log(dkng$Adj_Close)))\ndkng$Return_Pct <- dkng$LogReturn * 100\ndkng$Ticker <- \"DKNG\"\ndkng <- dkng %>% filter(!is.na(LogReturn))\n\npenn$LogReturn <- c(NA, diff(log(penn$Adj_Close)))\npenn$Return_Pct <- penn$LogReturn * 100\npenn$Ticker <- \"PENN\"\npenn <- penn %>% filter(!is.na(LogReturn))\n\nczr$LogReturn <- c(NA, diff(log(czr$Adj_Close)))\nczr$Return_Pct <- czr$LogReturn * 100\nczr$Ticker <- \"CZR\"\nczr <- czr %>% filter(!is.na(LogReturn))\n\nmgm$LogReturn <- c(NA, diff(log(mgm$Adj_Close)))\nmgm$Return_Pct <- mgm$LogReturn * 100\nmgm$Ticker <- \"MGM\"\nmgm <- mgm %>% filter(!is.na(LogReturn))\n\n# Summary statistics for all stocks\nstocks_list <- list(\n    DKNG = dkng$Return_Pct,\n    PENN = penn$Return_Pct,\n    CZR = czr$Return_Pct,\n    MGM = mgm$Return_Pct\n)\n\ncat(\"\\n=== RETURNS SUMMARY STATISTICS ===\\n\\n\")\nfor (ticker in names(stocks_list)) {\n    returns <- stocks_list[[ticker]]\n    cat(ticker, \":\\n\")\n    cat(\"  Mean:\", round(mean(returns), 4), \"%\\n\")\n    cat(\"  Std Dev:\", round(sd(returns), 4), \"%\\n\")\n    cat(\"  Min:\", round(min(returns), 4), \"%\\n\")\n    cat(\"  Max:\", round(max(returns), 4), \"%\\n\")\n    cat(\"  Skewness:\", round(moments::skewness(returns), 4), \"\\n\")\n    cat(\"  Kurtosis:\", round(moments::kurtosis(returns), 4), \"\\n\\n\")\n}\n```\n\n---\n\n# Data Visualization & Stationarity\n\n::: {.panel-tabset}\n\n## DraftKings (DKNG)\n\n::: {.panel-tabset}\n\n### Price & Returns Plot\n\n```{r dkng-price-returns, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\np1 <- ggplot(dkng, aes(x = Date, y = Adj_Close)) +\n    geom_line(color = \"#006bb6\", linewidth = 0.8) +\n    labs(\n        title = \"DraftKings (DKNG) Stock Price\",\n        subtitle = \"Daily Adjusted Close Price\",\n        x = \"Date\", y = \"Price ($)\"\n    ) +\n    theme_minimal()\n\np2 <- ggplot(dkng, aes(x = Date, y = Return_Pct)) +\n    geom_line(color = \"darkred\", linewidth = 0.5, alpha = 0.7) +\n    geom_hline(yintercept = 0, linetype = \"dashed\", color = \"black\") +\n    labs(\n        title = \"DraftKings (DKNG) Daily Returns\",\n        subtitle = \"Log returns showing volatility clustering\",\n        x = \"Date\", y = \"Return (%)\"\n    ) +\n    theme_minimal()\n\np1 / p2\n```\n\n**Observations**:\n\n- **Price Series**: Non-stationary with clear trends. DKNG went public via SPAC merger in 2020, experienced a pandemic boom, then declined as competition intensified.\n- **Returns Series**: Appears stationary around zero mean, but exhibits clear **volatility clustering**. Periods of calm (2021-early 2022) alternate with turbulence (late 2022, 2024).\n\n### Volatility Clustering\n\n```{r dkng-volatility-cluster, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\n# Calculate rolling volatility (20-day window)\ndkng <- dkng %>%\n    arrange(Date) %>%\n    mutate(\n        Roll_Vol_20 = zoo::rollapply(Return_Pct, width = 20, FUN = sd, fill = NA, align = \"right\"),\n        Abs_Return = abs(Return_Pct)\n    )\n\np3 <- ggplot(dkng, aes(x = Date, y = Abs_Return)) +\n    geom_line(color = \"purple\", alpha = 0.6) +\n    labs(\n        title = \"Absolute Returns (Proxy for Volatility)\",\n        x = \"Date\", y = \"|Return| (%)\"\n    ) +\n    theme_minimal()\n\np4 <- ggplot(dkng, aes(x = Date, y = Roll_Vol_20)) +\n    geom_line(color = \"darkgreen\", linewidth = 0.8) +\n    labs(\n        title = \"20-Day Rolling Volatility\",\n        x = \"Date\", y = \"Volatility (% std dev)\"\n    ) +\n    theme_minimal()\n\np3 / p4\n```\n\n**Volatility Clustering Evidence**:\n\nThe rolling volatility plot clearly shows time-varying variance. Volatility is not constant it rises sharply during market stress and falls during stable periods. This visual evidence motivates GARCH modeling.\n\n### ACF/PACF Analysis\n\n```{r dkng-acf-returns, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\n# ACF/PACF of returns\npar(mfrow = c(1, 2))\nacf(dkng$Return_Pct, lag.max = 30, main = \"ACF: DKNG Returns\")\npacf(dkng$Return_Pct, lag.max = 30, main = \"PACF: DKNG Returns\")\npar(mfrow = c(1, 1))\n```\n\n```{r dkng-acf-squared, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\n# ACF/PACF of squared returns (test for ARCH effects)\npar(mfrow = c(1, 2))\nacf(dkng$Return_Pct^2, lag.max = 30, main = \"ACF: Squared Returns (DKNG)\")\npacf(dkng$Return_Pct^2, lag.max = 30, main = \"PACF: Squared Returns (DKNG)\")\npar(mfrow = c(1, 1))\n```\n\n**Key Findings**:\n\n- **Returns ACF/PACF**: Minimal autocorrelation at most lags (consistent with weak-form market efficiency). Returns themselves are largely unpredictable.\n- **Squared Returns ACF/PACF**: **Strong autocorrelation** at multiple lags. This is the signature of ARCH effects while returns are unpredictable, volatility is highly predictable and persistent.\n  \n### Stationarity Tests\n\n```{r dkng-stationarity, warning=FALSE, message=FALSE}\n# ADF test on returns\nadf_dkng <- adf.test(dkng$Return_Pct)\n\ncat(\"=== Augmented Dickey-Fuller Test ===\\n\")\ncat(\"Null Hypothesis: Series has a unit root (non-stationary)\\n\\n\")\ncat(\"ADF Statistic:\", round(adf_dkng$statistic, 4), \"\\n\")\ncat(\"p-value:\", round(adf_dkng$p.value, 4), \"\\n\")\ncat(\"Conclusion:\", ifelse(adf_dkng$p.value < 0.05,\n    \"Reject H0 - Returns are STATIONARY\",\n    \"Fail to reject H0 - Returns are NON-STATIONARY\"\n), \"\\n\")\n```\n\n**Stationarity Conclusion**: The ADF test confirms that DKNG returns are stationary (p < 0.01). This validates our use of returns rather than prices and confirms that we don't need differencing in the mean equation.\n\n:::\n\n---\n\n## Penn Entertainment (PENN)\n\n::: {.panel-tabset}\n\n### Price & Returns Plot\n\n```{r penn-price-returns, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\np5 <- ggplot(penn, aes(x = Date, y = Adj_Close)) +\n    geom_line(color = \"#006bb6\", linewidth = 0.8) +\n    labs(\n        title = \"Penn Entertainment (PENN) Stock Price\",\n        subtitle = \"Daily Adjusted Close Price\",\n        x = \"Date\", y = \"Price ($)\"\n    ) +\n    theme_minimal()\n\np6 <- ggplot(penn, aes(x = Date, y = Return_Pct)) +\n    geom_line(color = \"darkred\", linewidth = 0.5, alpha = 0.7) +\n    geom_hline(yintercept = 0, linetype = \"dashed\", color = \"black\") +\n    labs(\n        title = \"Penn Entertainment (PENN) Daily Returns\",\n        subtitle = \"Log returns showing volatility clustering\",\n        x = \"Date\", y = \"Return (%)\"\n    ) +\n    theme_minimal()\n\np5 / p6\n```\n\n**Observations**:\n\n- **Price Series**: Even more volatile than DKNG. PENN's business model shifted from Barstool Sports (2020-2023) to ESPN BET (2023-present), creating structural breaks and extreme volatility.\n- **Returns Series**: Strong volatility clustering with several extreme spikes. This suggests PENN may exhibit even stronger GARCH effects than DKNG.\n\n### Volatility Clustering\n\n```{r penn-volatility-cluster, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\npenn <- penn %>%\n    arrange(Date) %>%\n    mutate(\n        Roll_Vol_20 = zoo::rollapply(Return_Pct, width = 20, FUN = sd, fill = NA, align = \"right\"),\n        Abs_Return = abs(Return_Pct)\n    )\n\np7 <- ggplot(penn, aes(x = Date, y = Abs_Return)) +\n    geom_line(color = \"purple\", alpha = 0.6) +\n    labs(\n        title = \"Absolute Returns (Proxy for Volatility)\",\n        x = \"Date\", y = \"|Return| (%)\"\n    ) +\n    theme_minimal()\n\np8 <- ggplot(penn, aes(x = Date, y = Roll_Vol_20)) +\n    geom_line(color = \"darkgreen\", linewidth = 0.8) +\n    labs(\n        title = \"20-Day Rolling Volatility\",\n        x = \"Date\", y = \"Volatility (% std dev)\"\n    ) +\n    theme_minimal()\n\np7 / p8\n```\n\n### ACF/PACF Analysis\n\n```{r penn-acf-returns, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\npar(mfrow = c(1, 2))\nacf(penn$Return_Pct, lag.max = 30, main = \"ACF: PENN Returns\")\npacf(penn$Return_Pct, lag.max = 30, main = \"PACF: PENN Returns\")\npar(mfrow = c(1, 1))\n```\n\n```{r penn-acf-squared, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\npar(mfrow = c(1, 2))\nacf(penn$Return_Pct^2, lag.max = 30, main = \"ACF: Squared Returns (PENN)\")\npacf(penn$Return_Pct^2, lag.max = 30, main = \"PACF: Squared Returns (PENN)\")\npar(mfrow = c(1, 1))\n```\n\n**Key Findings**:\n\nSimilar to DKNG: returns show weak autocorrelation, but squared returns exhibit strong autocorrelation, indicating ARCH effects. The PACF of squared returns shows significant spikes at early lags, suggesting GARCH(1,1) may be appropriate.\n\n### Stationarity Tests\n\n```{r penn-stationarity, warning=FALSE, message=FALSE}\nadf_penn <- adf.test(penn$Return_Pct)\n\ncat(\"=== Augmented Dickey-Fuller Test ===\\n\")\ncat(\"ADF Statistic:\", round(adf_penn$statistic, 4), \"\\n\")\ncat(\"p-value:\", round(adf_penn$p.value, 4), \"\\n\")\ncat(\"Conclusion:\", ifelse(adf_penn$p.value < 0.05,\n    \"Reject H0 - Returns are STATIONARY\",\n    \"Fail to reject H0 - Returns are NON-STATIONARY\"\n), \"\\n\")\n```\n\n:::\n\n## Caesars Entertainment (CZR)\n\n::: {.panel-tabset}\n\n### Price & Returns\n\n```{r czr-price-returns, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\np_czr1 <- ggplot(czr, aes(x = Date, y = Adj_Close)) +\n    geom_line(color = \"#006bb6\", linewidth = 0.8) +\n    labs(\n        title = \"Caesars Entertainment (CZR) Stock Price\",\n        x = \"Date\", y = \"Price ($)\"\n    ) +\n    theme_minimal()\n\np_czr2 <- ggplot(czr, aes(x = Date, y = Return_Pct)) +\n    geom_line(color = \"darkred\", linewidth = 0.5, alpha = 0.7) +\n    geom_hline(yintercept = 0, linetype = \"dashed\", color = \"black\") +\n    labs(\n        title = \"Caesars Entertainment (CZR) Daily Returns\",\n        x = \"Date\", y = \"Return (%)\"\n    ) +\n    theme_minimal()\n\np_czr1 / p_czr2\n```\n\n### Volatility & ACF\n\n```{r czr-vol-acf, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\nczr <- czr %>%\n    arrange(Date) %>%\n    mutate(Roll_Vol_20 = zoo::rollapply(Return_Pct, width = 20, FUN = sd, fill = NA, align = \"right\"))\n\np_czr_vol <- ggplot(czr, aes(x = Date, y = Roll_Vol_20)) +\n    geom_line(color = \"darkgreen\", linewidth = 0.8) +\n    labs(title = \"CZR: 20-Day Rolling Volatility\", y = \"Volatility (%)\") +\n    theme_minimal()\n\nprint(p_czr_vol)\n\npar(mfrow = c(1, 2))\nacf(czr$Return_Pct^2, lag.max = 30, main = \"ACF: Squared Returns (CZR)\")\npacf(czr$Return_Pct^2, lag.max = 30, main = \"PACF: Squared Returns (CZR)\")\npar(mfrow = c(1, 1))\n```\n\n**Observations**: CZR shows volatility clustering typical of casino/gaming stocks, with moderate ARCH effects visible in squared returns ACF.\n\n:::\n\n## MGM Resorts (MGM)\n\n::: {.panel-tabset}\n\n### Price & Returns\n\n```{r mgm-price-returns, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\np_mgm1 <- ggplot(mgm, aes(x = Date, y = Adj_Close)) +\n    geom_line(color = \"#006bb6\", linewidth = 0.8) +\n    labs(\n        title = \"MGM Resorts (MGM) Stock Price\",\n        x = \"Date\", y = \"Price ($)\"\n    ) +\n    theme_minimal()\n\np_mgm2 <- ggplot(mgm, aes(x = Date, y = Return_Pct)) +\n    geom_line(color = \"darkred\", linewidth = 0.5, alpha = 0.7) +\n    geom_hline(yintercept = 0, linetype = \"dashed\", color = \"black\") +\n    labs(\n        title = \"MGM Resorts (MGM) Daily Returns\",\n        x = \"Date\", y = \"Return (%)\"\n    ) +\n    theme_minimal()\n\np_mgm1 / p_mgm2\n```\n\n### Volatility & ACF\n\n```{r mgm-vol-acf, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\nmgm <- mgm %>%\n    arrange(Date) %>%\n    mutate(Roll_Vol_20 = zoo::rollapply(Return_Pct, width = 20, FUN = sd, fill = NA, align = \"right\"))\n\np_mgm_vol <- ggplot(mgm, aes(x = Date, y = Roll_Vol_20)) +\n    geom_line(color = \"darkgreen\", linewidth = 0.8) +\n    labs(title = \"MGM: 20-Day Rolling Volatility\", y = \"Volatility (%)\") +\n    theme_minimal()\n\nprint(p_mgm_vol)\n\npar(mfrow = c(1, 2))\nacf(mgm$Return_Pct^2, lag.max = 30, main = \"ACF: Squared Returns (MGM)\")\npacf(mgm$Return_Pct^2, lag.max = 30, main = \"PACF: Squared Returns (MGM)\")\npar(mfrow = c(1, 1))\n```\n\n**Observations**: MGM exhibits similar volatility clustering patterns, characteristic of the gaming/hospitality sector with sports betting exposure.\n\n:::\n\n:::\n\n---\n\n# Model Fitting\n\n::: {.panel-tabset}\n\n## DraftKings (DKNG) Model\n\n::: {.panel-tabset}\n\n### Mean Equation Selection\n\n```{r dkng-mean-models, warning=FALSE, message=FALSE}\n# Prepare data\ndkng_returns <- dkng$Return_Pct\n\n# Fit candidate mean models (without GARCH first)\nmean_models <- list(\n    ARMA00 = arima(dkng_returns, order = c(0, 0, 0)),\n    ARMA10 = arima(dkng_returns, order = c(1, 0, 0)),\n    ARMA01 = arima(dkng_returns, order = c(0, 0, 1)),\n    ARMA11 = arima(dkng_returns, order = c(1, 0, 1))\n)\n\n# Compare AIC\nmean_aic <- data.frame(\n    Model = names(mean_models),\n    AIC = sapply(mean_models, AIC),\n    BIC = sapply(mean_models, BIC)\n)\n\ncat(\"=== Mean Equation Comparison ===\\n\\n\")\nkable(mean_aic,\n    format = \"html\",\n    digits = 2,\n    caption = \"Model Comparison: Mean Equation Only\"\n) %>%\n    kable_styling(\n        full_width = FALSE,\n        bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\")\n    ) %>%\n    row_spec(which.min(mean_aic$AIC), bold = TRUE, color = \"white\", background = \"#006bb6\")\n```\n\n### Check for ARCH Effects\n\n```{r dkng-arch-test, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\n# Use best mean model from AIC\nbest_mean_idx <- which.min(mean_aic$AIC)\nbest_mean_model <- mean_models[[best_mean_idx]]\nbest_mean_name <- names(mean_models)[best_mean_idx]\n\ncat(\"\\nSelected Mean Model:\", best_mean_name, \"\\n\\n\")\n\n# Extract residuals\nresid_mean <- residuals(best_mean_model)\n\n# Plot standardized residuals and squared residuals\npar(mfrow = c(2, 2))\nplot(resid_mean, type = \"l\", main = \"Standardized Residuals\", ylab = \"Residuals\")\nabline(h = 0, col = \"red\", lty = 2)\nplot(resid_mean^2, type = \"l\", main = \"Squared Residuals\", ylab = \"Residuals\")\nacf(resid_mean^2, lag.max = 30, main = \"ACF: Squared Residuals\")\npacf(resid_mean^2, lag.max = 30, main = \"PACF: Squared Residuals\")\npar(mfrow = c(1, 1))\n\n# ARCH LM test\narch_test <- FinTS::ArchTest(resid_mean, lags = 12)\ncat(\"\\n=== ARCH LM Test ===\\n\")\ncat(\"Null Hypothesis: No ARCH effects\\n\")\ncat(\"Chi-squared:\", round(arch_test$statistic, 4), \"\\n\")\ncat(\"p-value:\", format(arch_test$p.value, scientific = TRUE, digits = 4), \"\\n\")\ncat(\"Conclusion:\", ifelse(arch_test$p.value < 0.05,\n    \"REJECT H0 - ARCH effects present, GARCH modeling needed\",\n    \"Fail to reject H0 - No ARCH effects\"\n), \"\\n\")\n```\n\n**Interpretation**:\n\n- **Squared Residuals**: Show clear autocorrelation even after fitting the mean equation\n- **ARCH LM Test**: Highly significant (p < 0.05), confirming ARCH effects\n- **Conclusion**: We need to add a GARCH variance equation to properly model volatility\n\n### Fit ARMA+GARCH Models\n\nNow we fit complete models with GARCH(1,1) variance equation:\n\n```{r dkng-garch-models, warning=FALSE, message=FALSE}\n# Model specifications to test\nmodel_specs <- list(\n    list(formula = ~ garch(1, 1), name = \"ARMA(0,0)+GARCH(1,1)\"),\n    list(formula = ~ arma(1, 0) + garch(1, 1), name = \"ARMA(1,0)+GARCH(1,1)\"),\n    list(formula = ~ arma(0, 1) + garch(1, 1), name = \"ARMA(0,1)+GARCH(1,1)\"),\n    list(formula = ~ arma(1, 1) + garch(1, 1), name = \"ARMA(1,1)+GARCH(1,1)\")\n)\n\n# Fit all models\ngarch_models <- list()\ngarch_results <- data.frame()\n\nfor (spec in model_specs) {\n    # Fit model\n    fit <- tryCatch(\n        {\n            garchFit(formula = spec$formula, data = dkng_returns, trace = FALSE)\n        },\n        error = function(e) {\n            cat(\"Warning: Failed to fit\", spec$name, \"\\n\")\n            NULL\n        }\n    )\n\n    if (!is.null(fit)) {\n        garch_models[[spec$name]] <- fit\n\n        # Extract information criteria\n        aic_val <- fit@fit$ics[\"AIC\"]\n        bic_val <- fit@fit$ics[\"BIC\"]\n        loglik_val <- fit@fit$llh\n\n        garch_results <- rbind(garch_results, data.frame(\n            Model = spec$name,\n            AIC = aic_val,\n            BIC = bic_val,\n            Log_Likelihood = loglik_val\n        ))\n    }\n}\n\ncat(\"=== GARCH Model Comparison ===\\n\\n\")\n```\n\n```{r dkng-garch-table, warning=FALSE, message=FALSE, results='asis', echo=FALSE}\nif (nrow(garch_results) > 0) {\n    kable(garch_results,\n        format = \"html\",\n        digits = 4,\n        caption = \"Model Comparison: ARMA+GARCH(1,1) Models for DKNG\",\n        row.names = FALSE\n    ) %>%\n        kable_styling(\n            full_width = FALSE,\n            bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\")\n        ) %>%\n        row_spec(which.min(garch_results$AIC), bold = TRUE, color = \"white\", background = \"#006bb6\")\n}\n```\n\n```{r dkng-best-model, warning=FALSE, message=FALSE}\n# Select best model\nbest_garch_idx <- which.min(garch_results$AIC)\nbest_garch_name <- garch_results$Model[best_garch_idx]\nbest_garch_model <- garch_models[[best_garch_name]]\n\ncat(\"\\n*** BEST MODEL:\", best_garch_name, \"***\\n\\n\")\ncat(\"Model Coefficients:\\n\")\nprint(coef(best_garch_model))\n```\n\n### Model Diagnostics\n\n```{r dkng-diagnostics, warning=FALSE, message=FALSE, fig.width=12, fig.height=10}\n# Extract standardized residuals\nstd_resid <- residuals(best_garch_model, standardize = TRUE)\n\n# Diagnostic plots\npar(mfrow = c(3, 2))\n\n# 1. Standardized residuals\nplot(std_resid, type = \"l\", main = \"Standardized Residuals\", ylab = \"Std. Residuals\")\nabline(h = 0, col = \"red\", lty = 2)\nabline(h = c(-2, 2), col = \"blue\", lty = 2)\n\n# 2. Squared standardized residuals\nplot(std_resid^2, type = \"l\", main = \"Squared Standardized Residuals\", ylab = \"Std. Residuals\")\n\n# 3. ACF of standardized residuals\nacf(std_resid, lag.max = 20, main = \"ACF: Standardized Residuals\")\n\n# 4. ACF of squared standardized residuals\nacf(std_resid^2, lag.max = 20, main = \"ACF: Squared Std. Residuals\")\n\n# 5. QQ plot\nqqnorm(std_resid, main = \"Q-Q Plot: Standardized Residuals\")\nqqline(std_resid, col = \"red\")\n\n# 6. Histogram\nhist(std_resid, breaks = 50, probability = TRUE, main = \"Distribution of Std. Residuals\", xlab = \"Std. Residuals\")\ncurve(dnorm(x), add = TRUE, col = \"red\", lwd = 2)\n\npar(mfrow = c(1, 1))\n```\n\n```{r dkng-ljung-box, warning=FALSE, message=FALSE}\n# Ljung-Box test on standardized residuals\ncat(\"\\n=== Ljung-Box Test (Standardized Residuals) ===\\n\")\ncat(\"Null Hypothesis: Residuals are white noise (no autocorrelation)\\n\\n\")\n\nlb_test_resid <- Box.test(std_resid, lag = 10, type = \"Ljung-Box\", fitdf = 0)\ncat(\"Lag 10:\\n\")\ncat(\"  Q-statistic:\", round(lb_test_resid$statistic, 4), \"\\n\")\ncat(\"  p-value:\", round(lb_test_resid$p.value, 4), \"\\n\")\ncat(\"  Conclusion:\", ifelse(lb_test_resid$p.value > 0.05,\n    \"No autocorrelation detected (good)\",\n    \"Autocorrelation detected (concern)\"\n), \"\\n\\n\")\n\n# Ljung-Box test on squared standardized residuals\ncat(\"=== Ljung-Box Test (Squared Standardized Residuals) ===\\n\")\ncat(\"Null Hypothesis: No remaining ARCH effects\\n\\n\")\n\nlb_test_sq <- Box.test(std_resid^2, lag = 10, type = \"Ljung-Box\", fitdf = 0)\ncat(\"Lag 10:\\n\")\ncat(\"  Q-statistic:\", round(lb_test_sq$statistic, 4), \"\\n\")\ncat(\"  p-value:\", round(lb_test_sq$p.value, 4), \"\\n\")\ncat(\"  Conclusion:\", ifelse(lb_test_sq$p.value > 0.05,\n    \"ARCH effects successfully captured (good)\",\n    \"Remaining ARCH effects (may need higher order)\"\n), \"\\n\")\n```\n\n**Diagnostic Interpretation**:\n\n- **ACF of Std. Residuals**: No significant autocorrelation (validates mean equation)\n- **Ljung-Box Tests**: p-values > 0.05 indicate the model has adequately captured temporal dependencies\n- **Q-Q Plot**: Some deviation in tails suggests fat-tailed distribution (could consider t-distribution)\n\n### Volatility Forecast\n\n```{r dkng-volatility-forecast, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\n# Extract conditional volatility\ncond_vol <- best_garch_model@sigma.t\n\n# Create data frame for plotting\nvol_df <- data.frame(\n    Date = dkng$Date,\n    Return_Pct = dkng$Return_Pct,\n    Cond_Vol = as.numeric(cond_vol)\n)\n\n# Plot returns with conditional volatility bands\nggplot(vol_df, aes(x = Date)) +\n    geom_line(aes(y = Return_Pct), color = \"black\", alpha = 0.6, linewidth = 0.4) +\n    geom_ribbon(aes(ymin = -2 * Cond_Vol, ymax = 2 * Cond_Vol),\n        fill = \"blue\", alpha = 0.2\n    ) +\n    geom_line(aes(y = 2 * Cond_Vol), color = \"blue\", linetype = \"dashed\", linewidth = 0.6) +\n    geom_line(aes(y = -2 * Cond_Vol), color = \"blue\", linetype = \"dashed\", linewidth = 0.6) +\n    geom_hline(yintercept = 0, linetype = \"solid\", color = \"red\", linewidth = 0.5) +\n    labs(\n        title = \"DKNG: Returns with GARCH Conditional Volatility (2 bands)\",\n        subtitle = \"Blue bands show time-varying volatility forecast\",\n        x = \"Date\",\n        y = \"Return (%)\"\n    ) +\n    theme_minimal()\n\n# Plot conditional volatility over time\nggplot(vol_df, aes(x = Date, y = Cond_Vol)) +\n    geom_line(color = \"darkgreen\", linewidth = 0.8) +\n    labs(\n        title = \"DKNG: GARCH Conditional Volatility Over Time\",\n        subtitle = \"Volatility forecast from GARCH(1,1) model\",\n        x = \"Date\",\n        y = \"Conditional Volatility (%)\"\n    ) +\n    theme_minimal()\n\ncat(\"\\nCurrent Volatility (last observation):\", round(tail(cond_vol, 1), 4), \"%\\n\")\ncat(\"Average Volatility:\", round(mean(cond_vol), 4), \"%\\n\")\ncat(\"Max Volatility:\", round(max(cond_vol), 4), \"%\\n\")\n```\n\n:::\n\n---\n\n## Penn Entertainment (PENN) Model\n\n::: {.panel-tabset}\n\n### Mean Equation & ARCH Test\n\n```{r penn-mean-models, warning=FALSE, message=FALSE}\npenn_returns <- penn$Return_Pct\n\n# Fit candidate mean models\nmean_models_penn <- list(\n    ARMA00 = arima(penn_returns, order = c(0, 0, 0)),\n    ARMA10 = arima(penn_returns, order = c(1, 0, 0)),\n    ARMA01 = arima(penn_returns, order = c(0, 0, 1)),\n    ARMA11 = arima(penn_returns, order = c(1, 0, 1))\n)\n\nmean_aic_penn <- data.frame(\n    Model = names(mean_models_penn),\n    AIC = sapply(mean_models_penn, AIC),\n    BIC = sapply(mean_models_penn, BIC)\n)\n\ncat(\"=== PENN Mean Equation Comparison ===\\n\\n\")\nkable(mean_aic_penn,\n    format = \"html\",\n    digits = 2,\n    caption = \"Model Comparison: Mean Equation Only (PENN)\"\n) %>%\n    kable_styling(\n        full_width = FALSE,\n        bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\")\n    ) %>%\n    row_spec(which.min(mean_aic_penn$AIC), bold = TRUE, color = \"white\", background = \"#006bb6\")\n\n# ARCH test\nbest_mean_penn <- mean_models_penn[[which.min(mean_aic_penn$AIC)]]\nresid_penn <- residuals(best_mean_penn)\n\narch_test_penn <- FinTS::ArchTest(resid_penn, lags = 12)\ncat(\"\\n=== ARCH LM Test (PENN) ===\\n\")\ncat(\"p-value:\", format(arch_test_penn$p.value, scientific = TRUE, digits = 4), \"\\n\")\ncat(\"Conclusion:\", ifelse(arch_test_penn$p.value < 0.05,\n    \"ARCH effects present - GARCH needed\",\n    \"No ARCH effects\"\n), \"\\n\")\n```\n\n### GARCH Model Fitting\n\n```{r penn-garch-models, warning=FALSE, message=FALSE}\ngarch_models_penn <- list()\ngarch_results_penn <- data.frame()\n\nfor (spec in model_specs) {\n    # Fit model using fGarch\n    fit <- tryCatch(\n        {\n            garchFit(formula = spec$formula, data = penn_returns, trace = FALSE)\n        },\n        error = function(e) {\n            cat(\"Warning: Failed to fit\", spec$name, \"for PENN\\n\")\n            NULL\n        }\n    )\n\n    if (!is.null(fit)) {\n        garch_models_penn[[spec$name]] <- fit\n\n        # Extract information criteria\n        aic_val <- fit@fit$ics[\"AIC\"]\n        bic_val <- fit@fit$ics[\"BIC\"]\n        loglik_val <- fit@fit$llh\n\n        garch_results_penn <- rbind(garch_results_penn, data.frame(\n            Model = spec$name,\n            AIC = aic_val,\n            BIC = bic_val,\n            Log_Likelihood = loglik_val\n        ))\n    }\n}\n\ncat(\"=== PENN GARCH Model Comparison ===\\n\\n\")\n```\n\n```{r penn-garch-table, warning=FALSE, message=FALSE, results='asis', echo=FALSE}\nif (nrow(garch_results_penn) > 0) {\n    kable(garch_results_penn,\n        format = \"html\",\n        digits = 4,\n        caption = \"Model Comparison: ARMA+GARCH(1,1) Models for PENN\",\n        row.names = FALSE\n    ) %>%\n        kable_styling(\n            full_width = FALSE,\n            bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\")\n        ) %>%\n        row_spec(which.min(garch_results_penn$AIC), bold = TRUE, color = \"white\", background = \"#006bb6\")\n}\n```\n\n```{r penn-best-model, warning=FALSE, message=FALSE}\nbest_garch_penn <- garch_models_penn[[which.min(garch_results_penn$AIC)]]\nbest_name_penn <- garch_results_penn$Model[which.min(garch_results_penn$AIC)]\n\ncat(\"\\n*** BEST MODEL:\", best_name_penn, \"***\\n\\n\")\ncat(\"Model Coefficients:\\n\")\nprint(coef(best_garch_penn))\n```\n\n### Diagnostics\n\n```{r penn-diagnostics, warning=FALSE, message=FALSE, fig.width=12, fig.height=10}\nstd_resid_penn <- residuals(best_garch_penn, standardize = TRUE)\n\npar(mfrow = c(3, 2))\nplot(std_resid_penn, type = \"l\", main = \"Standardized Residuals (PENN)\")\nabline(h = 0, col = \"red\", lty = 2)\nplot(std_resid_penn^2, type = \"l\", main = \"Squared Std. Residuals (PENN)\")\nacf(std_resid_penn, lag.max = 20, main = \"ACF: Std. Residuals\")\nacf(std_resid_penn^2, lag.max = 20, main = \"ACF: Squared Std. Residuals\")\nqqnorm(std_resid_penn, main = \"Q-Q Plot\")\nqqline(std_resid_penn, col = \"red\")\nhist(std_resid_penn, breaks = 50, probability = TRUE, main = \"Distribution\")\ncurve(dnorm(x), add = TRUE, col = \"red\", lwd = 2)\npar(mfrow = c(1, 1))\n\n# Ljung-Box tests\nlb_penn <- Box.test(std_resid_penn, lag = 10, type = \"Ljung-Box\")\nlb_penn_sq <- Box.test(std_resid_penn^2, lag = 10, type = \"Ljung-Box\")\n\ncat(\"\\nLjung-Box (Std. Residuals): p =\", round(lb_penn$p.value, 4), \"\\n\")\ncat(\"Ljung-Box (Squared): p =\", round(lb_penn_sq$p.value, 4), \"\\n\")\n```\n\n### Volatility Forecast\n\n```{r penn-volatility, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\ncond_vol_penn <- best_garch_penn@sigma.t\n\nvol_df_penn <- data.frame(\n    Date = penn$Date,\n    Return_Pct = penn$Return_Pct,\n    Cond_Vol = as.numeric(cond_vol_penn)\n)\n\nggplot(vol_df_penn, aes(x = Date)) +\n    geom_line(aes(y = Return_Pct), color = \"black\", alpha = 0.6, linewidth = 0.4) +\n    geom_ribbon(aes(ymin = -2 * Cond_Vol, ymax = 2 * Cond_Vol),\n        fill = \"red\", alpha = 0.2\n    ) +\n    geom_line(aes(y = 2 * Cond_Vol), color = \"red\", linetype = \"dashed\", linewidth = 0.6) +\n    geom_line(aes(y = -2 * Cond_Vol), color = \"red\", linetype = \"dashed\", linewidth = 0.6) +\n    geom_hline(yintercept = 0, linetype = \"solid\", color = \"black\", linewidth = 0.5) +\n    labs(\n        title = \"PENN: Returns with GARCH Conditional Volatility\",\n        x = \"Date\", y = \"Return (%)\"\n    ) +\n    theme_minimal()\n\nggplot(vol_df_penn, aes(x = Date, y = Cond_Vol)) +\n    geom_line(color = \"darkred\", linewidth = 0.8) +\n    labs(\n        title = \"PENN: GARCH Conditional Volatility\",\n        x = \"Date\", y = \"Conditional Volatility (%)\"\n    ) +\n    theme_minimal()\n```\n\n:::\n\n## Caesars Entertainment (CZR) Model\n\n::: {.panel-tabset}\n\n### Mean Equation & ARCH Test\n\n```{r czr-mean-models, warning=FALSE, message=FALSE}\nczr_returns <- czr$Return_Pct\n\n# Fit candidate mean models\nmean_models_czr <- list(\n    ARMA00 = arima(czr_returns, order = c(0, 0, 0)),\n    ARMA10 = arima(czr_returns, order = c(1, 0, 0)),\n    ARMA01 = arima(czr_returns, order = c(0, 0, 1)),\n    ARMA11 = arima(czr_returns, order = c(1, 0, 1))\n)\n\nmean_aic_czr <- data.frame(\n    Model = names(mean_models_czr),\n    AIC = sapply(mean_models_czr, AIC),\n    BIC = sapply(mean_models_czr, BIC)\n)\n\ncat(\"=== CZR Mean Equation Comparison ===\\n\\n\")\nkable(mean_aic_czr,\n    format = \"html\",\n    digits = 2,\n    caption = \"Model Comparison: Mean Equation Only (CZR)\"\n) %>%\n    kable_styling(\n        full_width = FALSE,\n        bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\")\n    ) %>%\n    row_spec(which.min(mean_aic_czr$AIC), bold = TRUE, color = \"white\", background = \"#006bb6\")\n\n# ARCH test\nbest_mean_czr <- mean_models_czr[[which.min(mean_aic_czr$AIC)]]\nresid_czr <- residuals(best_mean_czr)\n\ncat(\"\\n\")\n\n# Plot squared residuals\npar(mfrow = c(1, 2))\nacf(resid_czr^2, lag.max = 30, main = \"ACF: Squared Residuals (CZR)\")\npacf(resid_czr^2, lag.max = 30, main = \"PACF: Squared Residuals (CZR)\")\npar(mfrow = c(1, 1))\n\narch_test_czr <- FinTS::ArchTest(resid_czr, lags = 12)\ncat(\"\\n=== ARCH LM Test (CZR) ===\\n\")\ncat(\"Chi-squared:\", round(arch_test_czr$statistic, 4), \"\\n\")\ncat(\"p-value:\", format(arch_test_czr$p.value, scientific = TRUE, digits = 4), \"\\n\")\ncat(\"Conclusion:\", ifelse(arch_test_czr$p.value < 0.05,\n    \"ARCH effects present → GARCH needed\",\n    \"No ARCH effects\"\n), \"\\n\")\n```\n\n**Interpretation**: The ACF/PACF of squared residuals show significant autocorrelation at multiple lags, and the ARCH LM test confirms the presence of ARCH effects. This validates the need for GARCH modeling to capture CZR's time-varying volatility.\n\n### GARCH Model Fitting\n\n```{r czr-garch-models, warning=FALSE, message=FALSE}\ngarch_models_czr <- list()\ngarch_results_czr <- data.frame()\n\nfor (spec in model_specs) {\n    # Fit model using fGarch\n    fit <- tryCatch(\n        {\n            garchFit(formula = spec$formula, data = czr_returns, trace = FALSE)\n        },\n        error = function(e) {\n            cat(\"Warning: Failed to fit\", spec$name, \"for CZR\\n\")\n            NULL\n        }\n    )\n\n    if (!is.null(fit)) {\n        garch_models_czr[[spec$name]] <- fit\n\n        # Extract information criteria\n        aic_val <- fit@fit$ics[\"AIC\"]\n        bic_val <- fit@fit$ics[\"BIC\"]\n        loglik_val <- fit@fit$llh\n\n        garch_results_czr <- rbind(garch_results_czr, data.frame(\n            Model = spec$name,\n            AIC = aic_val,\n            BIC = bic_val,\n            Log_Likelihood = loglik_val\n        ))\n    }\n}\n\ncat(\"=== CZR GARCH Model Comparison ===\\n\\n\")\n```\n\n```{r czr-garch-table, warning=FALSE, message=FALSE, results='asis', echo=FALSE}\nif (nrow(garch_results_czr) > 0) {\n    kable(garch_results_czr,\n        format = \"html\",\n        digits = 4,\n        caption = \"Model Comparison: ARMA+GARCH(1,1) Models for CZR\",\n        row.names = FALSE\n    ) %>%\n        kable_styling(\n            full_width = FALSE,\n            bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\")\n        ) %>%\n        row_spec(which.min(garch_results_czr$AIC), bold = TRUE, color = \"white\", background = \"#006bb6\")\n}\n```\n\n```{r czr-best-model, warning=FALSE, message=FALSE}\nbest_garch_czr <- garch_models_czr[[which.min(garch_results_czr$AIC)]]\nbest_name_czr <- garch_results_czr$Model[which.min(garch_results_czr$AIC)]\n\ncat(\"\\n*** BEST MODEL:\", best_name_czr, \"***\\n\\n\")\ncat(\"Model Coefficients:\\n\")\nprint(coef(best_garch_czr))\n```\n\n**Model Selection Rationale**: The AIC-selected model balances fit and parsimony. CZR exhibits volatility patterns driven by both established gaming operations and newer sports betting ventures.\n\n### Diagnostics\n\n```{r czr-diagnostics, warning=FALSE, message=FALSE, fig.width=12, fig.height=10}\nstd_resid_czr <- residuals(best_garch_czr, standardize = TRUE)\n\npar(mfrow = c(3, 2))\nplot(std_resid_czr, type = \"l\", main = \"Standardized Residuals (CZR)\", ylab = \"Std. Residuals\")\nabline(h = 0, col = \"red\", lty = 2)\nabline(h = c(-2, 2), col = \"blue\", lty = 2)\n\nplot(std_resid_czr^2, type = \"l\", main = \"Squared Std. Residuals (CZR)\", ylab = \"Residuals²\")\n\nacf(std_resid_czr, lag.max = 20, main = \"ACF: Std. Residuals\")\nacf(std_resid_czr^2, lag.max = 20, main = \"ACF: Squared Std. Residuals\")\n\nqqnorm(std_resid_czr, main = \"Q-Q Plot (CZR)\")\nqqline(std_resid_czr, col = \"red\")\n\nhist(std_resid_czr, breaks = 50, probability = TRUE, main = \"Distribution (CZR)\", xlab = \"Std. Residuals\")\ncurve(dnorm(x), add = TRUE, col = \"red\", lwd = 2)\npar(mfrow = c(1, 1))\n\n# Ljung-Box tests\nlb_czr <- Box.test(std_resid_czr, lag = 10, type = \"Ljung-Box\")\nlb_czr_sq <- Box.test(std_resid_czr^2, lag = 10, type = \"Ljung-Box\")\n\ncat(\"\\n=== Ljung-Box Tests (CZR) ===\\n\\n\")\ncat(\"Standardized Residuals: p =\", round(lb_czr$p.value, 4), \"\\n\")\ncat(\"  Conclusion:\", ifelse(lb_czr$p.value > 0.05,\n    \"No autocorrelation (good)\",\n    \"Autocorrelation present (concern)\"\n), \"\\n\\n\")\n\ncat(\"Squared Std. Residuals: p =\", round(lb_czr_sq$p.value, 4), \"\\n\")\ncat(\"  Conclusion:\", ifelse(lb_czr_sq$p.value > 0.05,\n    \"ARCH effects captured (good)\",\n    \"Remaining ARCH effects\"\n), \"\\n\")\n```\n\n**Diagnostic Summary**:\n- Standardized residuals should resemble white noise (no pattern in ACF)\n- Squared residuals ACF tests whether GARCH captured all volatility clustering\n- Ljung-Box p > 0.05 indicates successful model specification\n- Q-Q plot reveals any remaining fat-tail characteristics\n\n### Volatility Forecast\n\n```{r czr-volatility, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\ncond_vol_czr <- best_garch_czr@sigma.t\n\nvol_df_czr <- data.frame(\n    Date = czr$Date,\n    Return_Pct = czr$Return_Pct,\n    Cond_Vol = as.numeric(cond_vol_czr)\n)\n\nggplot(vol_df_czr, aes(x = Date)) +\n    geom_line(aes(y = Return_Pct), color = \"black\", alpha = 0.6, linewidth = 0.4) +\n    geom_ribbon(aes(ymin = -2 * Cond_Vol, ymax = 2 * Cond_Vol),\n        fill = \"darkgreen\", alpha = 0.2\n    ) +\n    geom_line(aes(y = 2 * Cond_Vol), color = \"darkgreen\", linetype = \"dashed\", linewidth = 0.6) +\n    geom_line(aes(y = -2 * Cond_Vol), color = \"darkgreen\", linetype = \"dashed\", linewidth = 0.6) +\n    geom_hline(yintercept = 0, linetype = \"solid\", color = \"black\", linewidth = 0.5) +\n    labs(\n        title = \"CZR: Returns with GARCH Conditional Volatility (±2σ bands)\",\n        subtitle = \"Green bands show time-varying volatility forecast\",\n        x = \"Date\",\n        y = \"Return (%)\"\n    ) +\n    theme_minimal()\n\nggplot(vol_df_czr, aes(x = Date, y = Cond_Vol)) +\n    geom_line(color = \"darkgreen\", linewidth = 0.8) +\n    labs(\n        title = \"CZR: GARCH Conditional Volatility Over Time\",\n        subtitle = \"Volatility reflects both casino operations and sports betting integration\",\n        x = \"Date\",\n        y = \"Conditional Volatility (%)\"\n    ) +\n    theme_minimal()\n\ncat(\"\\nCurrent Volatility (last observation):\", round(tail(cond_vol_czr, 1), 4), \"%\\n\")\ncat(\"Average Volatility:\", round(mean(cond_vol_czr), 4), \"%\\n\")\ncat(\"Max Volatility:\", round(max(cond_vol_czr), 4), \"%\\n\")\n```\n\n**Volatility Interpretation**: CZR's conditional volatility shows periods of elevated risk during major corporate events. The GARCH model successfully tracks these time-varying patterns, providing valuable risk forecasts for portfolio managers and options traders.\n\n:::\n\n## MGM Resorts (MGM) Model\n\n::: {.panel-tabset}\n\n### Mean Equation & ARCH Test\n\n```{r mgm-mean-models, warning=FALSE, message=FALSE}\nmgm_returns <- mgm$Return_Pct\n\n# Fit candidate mean models\nmean_models_mgm <- list(\n    ARMA00 = arima(mgm_returns, order = c(0, 0, 0)),\n    ARMA10 = arima(mgm_returns, order = c(1, 0, 0)),\n    ARMA01 = arima(mgm_returns, order = c(0, 0, 1)),\n    ARMA11 = arima(mgm_returns, order = c(1, 0, 1))\n)\n\nmean_aic_mgm <- data.frame(\n    Model = names(mean_models_mgm),\n    AIC = sapply(mean_models_mgm, AIC),\n    BIC = sapply(mean_models_mgm, BIC)\n)\n\ncat(\"=== MGM Mean Equation Comparison ===\\n\\n\")\nkable(mean_aic_mgm,\n    format = \"html\",\n    digits = 2,\n    caption = \"Model Comparison: Mean Equation Only (MGM)\"\n) %>%\n    kable_styling(\n        full_width = FALSE,\n        bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\")\n    ) %>%\n    row_spec(which.min(mean_aic_mgm$AIC), bold = TRUE, color = \"white\", background = \"#006bb6\")\n\n# ARCH test\nbest_mean_mgm <- mean_models_mgm[[which.min(mean_aic_mgm$AIC)]]\nresid_mgm <- residuals(best_mean_mgm)\n\ncat(\"\\n\")\n\n# Plot squared residuals\npar(mfrow = c(1, 2))\nacf(resid_mgm^2, lag.max = 30, main = \"ACF: Squared Residuals (MGM)\")\npacf(resid_mgm^2, lag.max = 30, main = \"PACF: Squared Residuals (MGM)\")\npar(mfrow = c(1, 1))\n\narch_test_mgm <- FinTS::ArchTest(resid_mgm, lags = 12)\ncat(\"\\n=== ARCH LM Test (MGM) ===\\n\")\ncat(\"Chi-squared:\", round(arch_test_mgm$statistic, 4), \"\\n\")\ncat(\"p-value:\", format(arch_test_mgm$p.value, scientific = TRUE, digits = 4), \"\\n\")\ncat(\"Conclusion:\", ifelse(arch_test_mgm$p.value < 0.05,\n    \"ARCH effects present → GARCH needed\",\n    \"No ARCH effects\"\n), \"\\n\")\n```\n\n**Interpretation**: Despite MGM's diversified business model, the stock still exhibits ARCH effects, though potentially milder than pure-play sports betting stocks. The ARCH LM test confirms time-varying volatility requiring GARCH specification.\n\n### GARCH Model Fitting\n\n```{r mgm-garch-models, warning=FALSE, message=FALSE}\ngarch_models_mgm <- list()\ngarch_results_mgm <- data.frame()\n\nfor (spec in model_specs) {\n    # Fit model using fGarch\n    fit <- tryCatch(\n        {\n            garchFit(formula = spec$formula, data = mgm_returns, trace = FALSE)\n        },\n        error = function(e) {\n            cat(\"Warning: Failed to fit\", spec$name, \"for MGM\\n\")\n            NULL\n        }\n    )\n\n    if (!is.null(fit)) {\n        garch_models_mgm[[spec$name]] <- fit\n\n        # Extract information criteria\n        aic_val <- fit@fit$ics[\"AIC\"]\n        bic_val <- fit@fit$ics[\"BIC\"]\n        loglik_val <- fit@fit$llh\n\n        garch_results_mgm <- rbind(garch_results_mgm, data.frame(\n            Model = spec$name,\n            AIC = aic_val,\n            BIC = bic_val,\n            Log_Likelihood = loglik_val\n        ))\n    }\n}\n\ncat(\"=== MGM GARCH Model Comparison ===\\n\\n\")\n```\n\n```{r mgm-garch-table, warning=FALSE, message=FALSE, results='asis', echo=FALSE}\nif (nrow(garch_results_mgm) > 0) {\n    kable(garch_results_mgm,\n        format = \"html\",\n        digits = 4,\n        caption = \"Model Comparison: ARMA+GARCH(1,1) Models for MGM\",\n        row.names = FALSE\n    ) %>%\n        kable_styling(\n            full_width = FALSE,\n            bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\")\n        ) %>%\n        row_spec(which.min(garch_results_mgm$AIC), bold = TRUE, color = \"white\", background = \"#006bb6\")\n}\n```\n\n```{r mgm-best-model, warning=FALSE, message=FALSE}\nbest_garch_mgm <- garch_models_mgm[[which.min(garch_results_mgm$AIC)]]\nbest_name_mgm <- garch_results_mgm$Model[which.min(garch_results_mgm$AIC)]\n\ncat(\"\\n*** BEST MODEL:\", best_name_mgm, \"***\\n\\n\")\ncat(\"Model Coefficients:\\n\")\nprint(coef(best_garch_mgm))\n```\n\n**Model Selection Rationale**: The selected GARCH(1,1) specification for MGM captures volatility persistence while maintaining parsimony. MGM's diversified operations (Las Vegas Strip properties, regional casinos, BetMGM, entertainment venues) create a more stable volatility profile compared to pure-play operators, which should be reflected in the model coefficients.\n\n### Diagnostics\n\n```{r mgm-diagnostics, warning=FALSE, message=FALSE, fig.width=12, fig.height=10}\nstd_resid_mgm <- residuals(best_garch_mgm, standardize = TRUE)\n\npar(mfrow = c(3, 2))\nplot(std_resid_mgm, type = \"l\", main = \"Standardized Residuals (MGM)\", ylab = \"Std. Residuals\")\nabline(h = 0, col = \"red\", lty = 2)\nabline(h = c(-2, 2), col = \"blue\", lty = 2)\n\nplot(std_resid_mgm^2, type = \"l\", main = \"Squared Std. Residuals (MGM)\", ylab = \"Residuals²\")\n\nacf(std_resid_mgm, lag.max = 20, main = \"ACF: Std. Residuals\")\nacf(std_resid_mgm^2, lag.max = 20, main = \"ACF: Squared Std. Residuals\")\n\nqqnorm(std_resid_mgm, main = \"Q-Q Plot (MGM)\")\nqqline(std_resid_mgm, col = \"red\")\n\nhist(std_resid_mgm, breaks = 50, probability = TRUE, main = \"Distribution (MGM)\", xlab = \"Std. Residuals\")\ncurve(dnorm(x), add = TRUE, col = \"red\", lwd = 2)\npar(mfrow = c(1, 1))\n\n# Ljung-Box tests\nlb_mgm <- Box.test(std_resid_mgm, lag = 10, type = \"Ljung-Box\")\nlb_mgm_sq <- Box.test(std_resid_mgm^2, lag = 10, type = \"Ljung-Box\")\n\ncat(\"\\n=== Ljung-Box Tests (MGM) ===\\n\\n\")\ncat(\"Standardized Residuals: p =\", round(lb_mgm$p.value, 4), \"\\n\")\ncat(\"  Conclusion:\", ifelse(lb_mgm$p.value > 0.05,\n    \"No autocorrelation (good)\",\n    \"Autocorrelation present (concern)\"\n), \"\\n\\n\")\n\ncat(\"Squared Std. Residuals: p =\", round(lb_mgm_sq$p.value, 4), \"\\n\")\ncat(\"  Conclusion:\", ifelse(lb_mgm_sq$p.value > 0.05,\n    \"ARCH effects captured (good)\",\n    \"Remaining ARCH effects\"\n), \"\\n\")\n```\n\n**Diagnostic Summary**: MGM's standardized residuals should show cleaner behavior than PENN or DKNG, reflecting the stabilizing effect of diversified revenue streams. Successful diagnostics (Ljung-Box p > 0.05) indicate the GARCH model adequately captures MGM's conditional volatility dynamics.\n\n### Volatility Forecast\n\n```{r mgm-volatility, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\ncond_vol_mgm <- best_garch_mgm@sigma.t\n\nvol_df_mgm <- data.frame(\n    Date = mgm$Date,\n    Return_Pct = mgm$Return_Pct,\n    Cond_Vol = as.numeric(cond_vol_mgm)\n)\n\nggplot(vol_df_mgm, aes(x = Date)) +\n    geom_line(aes(y = Return_Pct), color = \"black\", alpha = 0.6, linewidth = 0.4) +\n    geom_ribbon(aes(ymin = -2 * Cond_Vol, ymax = 2 * Cond_Vol),\n        fill = \"darkorange\", alpha = 0.2\n    ) +\n    geom_line(aes(y = 2 * Cond_Vol), color = \"darkorange\", linetype = \"dashed\", linewidth = 0.6) +\n    geom_line(aes(y = -2 * Cond_Vol), color = \"darkorange\", linetype = \"dashed\", linewidth = 0.6) +\n    geom_hline(yintercept = 0, linetype = \"solid\", color = \"black\", linewidth = 0.5) +\n    labs(\n        title = \"MGM: Returns with GARCH Conditional Volatility (±2σ bands)\",\n        subtitle = \"Orange bands show time-varying volatility forecast\",\n        x = \"Date\",\n        y = \"Return (%)\"\n    ) +\n    theme_minimal()\n\nggplot(vol_df_mgm, aes(x = Date, y = Cond_Vol)) +\n    geom_line(color = \"darkorange\", linewidth = 0.8) +\n    labs(\n        title = \"MGM: GARCH Conditional Volatility Over Time\",\n        subtitle = \"Most stable volatility profile among all sports betting stocks\",\n        x = \"Date\",\n        y = \"Conditional Volatility (%)\"\n    ) +\n    theme_minimal()\n\ncat(\"\\nCurrent Volatility (last observation):\", round(tail(cond_vol_mgm, 1), 4), \"%\\n\")\ncat(\"Average Volatility:\", round(mean(cond_vol_mgm), 4), \"%\\n\")\ncat(\"Max Volatility:\", round(max(cond_vol_mgm), 4), \"%\\n\")\n```\n\n**Volatility Interpretation**: MGM's conditional volatility time series shows the lowest average volatility among all four stocks, confirming that diversification provides natural hedging against sector-specific shocks. The GARCH forecasts are particularly valuable for MGM during major events that create temporary volatility spikes.\n\n:::\n\n:::\n\n---\n\n# Model Equations\n\n::: {.panel-tabset}\n\n## DraftKings (DKNG)\n\n```{r dkng-equation-setup, echo=FALSE}\n# Extract coefficients\ndkng_coef <- coef(best_garch_model)\n\n# Mean equation coefficients\nmu_dkng <- ifelse(\"mu\" %in% names(dkng_coef), dkng_coef[\"mu\"], 0)\nar1_dkng <- ifelse(\"ar1\" %in% names(dkng_coef), dkng_coef[\"ar1\"], 0)\nma1_dkng <- ifelse(\"ma1\" %in% names(dkng_coef), dkng_coef[\"ma1\"], 0)\n\n# Variance equation coefficients\nomega_dkng <- dkng_coef[\"omega\"]\nalpha1_dkng <- dkng_coef[\"alpha1\"]\nbeta1_dkng <- dkng_coef[\"beta1\"]\n\n# Persistence\npersistence_dkng <- alpha1_dkng + beta1_dkng\n```\n\n**Selected Model**: `r best_garch_name`\n\n### Mean Equation\n\n$$\nr_t = `r round(mu_dkng, 6)` + \\epsilon_t\n$$\n\nwhere $\\epsilon_t = \\sigma_t z_t$ and $z_t \\sim N(0, 1)$\n\n### Variance Equation (GARCH(1,1))\n\n$$\n\\sigma_t^2 = `r round(omega_dkng, 6)` + `r round(alpha1_dkng, 6)` \\epsilon_{t-1}^2 + `r round(beta1_dkng, 6)` \\sigma_{t-1}^2\n$$\n\n**Unconditional Variance**:\n\n$$\n\\sigma^2_{\\text{unconditional}} = \\frac{\\omega}{1 - \\alpha_1 - \\beta_1} = \\frac{`r round(omega_dkng, 6)`}{1 - `r round(persistence_dkng, 4)`} = `r round(omega_dkng / (1 - persistence_dkng), 4)`\n$$\n\nUnconditional volatility: `r round(sqrt(omega_dkng / (1 - persistence_dkng)), 4)`%\n\n## Penn Entertainment (PENN)\n\n```{r penn-equation-setup, echo=FALSE}\npenn_coef <- coef(best_garch_penn)\n\nmu_penn <- ifelse(\"mu\" %in% names(penn_coef), penn_coef[\"mu\"], 0)\nar1_penn <- ifelse(\"ar1\" %in% names(penn_coef), penn_coef[\"ar1\"], 0)\nma1_penn <- ifelse(\"ma1\" %in% names(penn_coef), penn_coef[\"ma1\"], 0)\n\nomega_penn <- penn_coef[\"omega\"]\nalpha1_penn <- penn_coef[\"alpha1\"]\nbeta1_penn <- penn_coef[\"beta1\"]\n\npersistence_penn <- alpha1_penn + beta1_penn\n```\n\n**Selected Model**: `r best_name_penn`\n\n### Mean Equation\n\n$$\nr_t = `r round(mu_penn, 6)` + \\epsilon_t\n$$\n\n### Variance Equation (GARCH(1,1))\n\n$$\n\\sigma_t^2 = `r round(omega_penn, 6)` + `r round(alpha1_penn, 6)` \\epsilon_{t-1}^2 + `r round(beta1_penn, 6)` \\sigma_{t-1}^2\n$$\n\n## Caesars Entertainment (CZR)\n\n```{r czr-equation-setup, echo=FALSE}\nczr_coef <- coef(best_garch_czr)\n\nmu_czr <- ifelse(\"mu\" %in% names(czr_coef), czr_coef[\"mu\"], 0)\nar1_czr <- ifelse(\"ar1\" %in% names(czr_coef), czr_coef[\"ar1\"], 0)\nma1_czr <- ifelse(\"ma1\" %in% names(czr_coef), czr_coef[\"ma1\"], 0)\n\nomega_czr <- czr_coef[\"omega\"]\nalpha1_czr <- czr_coef[\"alpha1\"]\nbeta1_czr <- czr_coef[\"beta1\"]\n\npersistence_czr <- alpha1_czr + beta1_czr\n```\n\n**Selected Model**: `r best_name_czr`\n\n### Mean Equation\n\n$$\nr_t = `r round(mu_czr, 6)` + \\epsilon_t\n$$\n\nwhere $\\epsilon_t = \\sigma_t z_t$ and $z_t \\sim N(0, 1)$\n\n### Variance Equation (GARCH(1,1))\n\n$$\n\\sigma_t^2 = `r round(omega_czr, 6)` + `r round(alpha1_czr, 6)` \\epsilon_{t-1}^2 + `r round(beta1_czr, 6)` \\sigma_{t-1}^2\n$$\n\n**Unconditional Variance**:\n\n$$\n\\sigma^2_{\\text{unconditional}} = \\frac{\\omega}{1 - \\alpha_1 - \\beta_1} = \\frac{`r round(omega_czr, 6)`}{1 - `r round(persistence_czr, 4)`} = `r round(omega_czr / (1 - persistence_czr), 4)`\n$$\n\nUnconditional volatility: `r round(sqrt(omega_czr / (1 - persistence_czr)), 4)`%\n\n## MGM Resorts (MGM)\n\n```{r mgm-equation-setup, echo=FALSE}\nmgm_coef <- coef(best_garch_mgm)\n\nmu_mgm <- ifelse(\"mu\" %in% names(mgm_coef), mgm_coef[\"mu\"], 0)\nar1_mgm <- ifelse(\"ar1\" %in% names(mgm_coef), mgm_coef[\"ar1\"], 0)\nma1_mgm <- ifelse(\"ma1\" %in% names(mgm_coef), mgm_coef[\"ma1\"], 0)\n\nomega_mgm <- mgm_coef[\"omega\"]\nalpha1_mgm <- mgm_coef[\"alpha1\"]\nbeta1_mgm <- mgm_coef[\"beta1\"]\n\npersistence_mgm <- alpha1_mgm + beta1_mgm\n```\n\n**Selected Model**: `r best_name_mgm`\n\n### Mean Equation\n\n$$\nr_t = `r round(mu_mgm, 6)` + \\epsilon_t\n$$\n\nwhere $\\epsilon_t = \\sigma_t z_t$ and $z_t \\sim N(0, 1)$\n\n### Variance Equation (GARCH(1,1))\n\n$$\n\\sigma_t^2 = `r round(omega_mgm, 6)` + `r round(alpha1_mgm, 6)` \\epsilon_{t-1}^2 + `r round(beta1_mgm, 6)` \\sigma_{t-1}^2\n$$\n\n**Unconditional Variance**:\n\n$$\n\\sigma^2_{\\text{unconditional}} = \\frac{\\omega}{1 - \\alpha_1 - \\beta_1} = \\frac{`r round(omega_mgm, 6)`}{1 - `r round(persistence_mgm, 4)`} = `r round(omega_mgm / (1 - persistence_mgm), 4)`\n$$\n\nUnconditional volatility: `r round(sqrt(omega_mgm / (1 - persistence_mgm)), 4)`% (lowest among all four stocks)\n\n**Business Model Impact**: MGM's lower volatility parameters directly reflect its diversified operations. The smaller $\\alpha_1$ suggests that MGM's stock is less sensitive to short-term shocks, while moderate $\\beta_1$ indicates reasonable volatility persistence.\n\n:::\n\n---\n\n# Cross-Stock Comparison\n\nNow that we've analyzed individual stocks, let's compare volatility dynamics across all four sports betting companies.\n\n::: {.panel-tabset}\n\n## Volatility Comparison\n\n```{r volatility-comparison, warning=FALSE, message=FALSE, fig.width=14, fig.height=10}\n# Combine all returns data\nall_returns <- bind_rows(\n    dkng %>% dplyr::select(Date, Return_Pct, Ticker),\n    penn %>% dplyr::select(Date, Return_Pct, Ticker),\n    czr %>% dplyr::select(Date, Return_Pct, Ticker),\n    mgm %>% dplyr::select(Date, Return_Pct, Ticker)\n)\n\n# Plot all returns together\np_all_returns <- ggplot(all_returns, aes(x = Date, y = Return_Pct, color = Ticker)) +\n    geom_line(alpha = 0.5, linewidth = 0.3) +\n    facet_wrap(~Ticker, ncol = 1) +\n    geom_hline(yintercept = 0, linetype = \"dashed\", color = \"black\") +\n    labs(\n        title = \"Daily Returns Comparison: All Sports Betting Stocks\",\n        subtitle = \"Volatility clustering visible across all stocks\",\n        x = \"Date\",\n        y = \"Return (%)\"\n    ) +\n    scale_color_manual(values = c(\n        \"DKNG\" = \"#006bb6\", \"PENN\" = \"darkred\",\n        \"CZR\" = \"darkgreen\", \"MGM\" = \"darkorange\"\n    )) +\n    theme_minimal() +\n    theme(legend.position = \"none\")\n\nprint(p_all_returns)\n\n# Rolling volatility comparison\nall_vol <- bind_rows(\n    dkng %>% dplyr::select(Date, Roll_Vol_20, Ticker),\n    penn %>% dplyr::select(Date, Roll_Vol_20, Ticker),\n    czr %>% dplyr::select(Date, Roll_Vol_20, Ticker),\n    mgm %>% dplyr::select(Date, Roll_Vol_20, Ticker)\n) %>% filter(!is.na(Roll_Vol_20))\n\np_vol_comp <- ggplot(all_vol, aes(x = Date, y = Roll_Vol_20, color = Ticker)) +\n    geom_line(linewidth = 0.8, alpha = 0.8) +\n    labs(\n        title = \"20-Day Rolling Volatility Comparison\",\n        subtitle = \"PENN shows highest volatility, MGM most stable\",\n        x = \"Date\",\n        y = \"Volatility (% std dev)\",\n        color = \"Stock\"\n    ) +\n    scale_color_manual(values = c(\n        \"DKNG\" = \"#006bb6\", \"PENN\" = \"darkred\",\n        \"CZR\" = \"darkgreen\", \"MGM\" = \"darkorange\"\n    )) +\n    theme_minimal() +\n    theme(legend.position = \"right\")\n\nprint(p_vol_comp)\n\n# Save for conclusion\nggsave(\"images/betting_stocks_volatility.png\", plot = p_vol_comp, width = 14, height = 8, dpi = 300, bg = \"white\")\n```\n\n**Key Observations**:\n\n- **PENN** exhibits the highest volatility throughout the period, reflecting business model uncertainty\n- **MGM** shows the most stable returns, benefiting from diversified resort operations\n- **DKNG** and **CZR** display moderate volatility, typical of focused sports betting operators\n- All stocks show synchronized volatility spikes during market-wide events (COVID, regulatory news)\n\n## Statistical Summary\n\n```{r stats-summary-table, warning=FALSE, message=FALSE, results='asis', echo=FALSE}\n# Create comprehensive summary table\nsummary_stats <- data.frame(\n    Stock = c(\"DKNG\", \"PENN\", \"CZR\", \"MGM\"),\n    Mean_Return = c(\n        mean(dkng$Return_Pct), mean(penn$Return_Pct),\n        mean(czr$Return_Pct), mean(mgm$Return_Pct)\n    ),\n    Volatility = c(\n        sd(dkng$Return_Pct), sd(penn$Return_Pct),\n        sd(czr$Return_Pct), sd(mgm$Return_Pct)\n    ),\n    Min_Return = c(\n        min(dkng$Return_Pct), min(penn$Return_Pct),\n        min(czr$Return_Pct), min(mgm$Return_Pct)\n    ),\n    Max_Return = c(\n        max(dkng$Return_Pct), max(penn$Return_Pct),\n        max(czr$Return_Pct), max(mgm$Return_Pct)\n    ),\n    Skewness = c(\n        moments::skewness(dkng$Return_Pct), moments::skewness(penn$Return_Pct),\n        moments::skewness(czr$Return_Pct), moments::skewness(mgm$Return_Pct)\n    ),\n    Kurtosis = c(\n        moments::kurtosis(dkng$Return_Pct), moments::kurtosis(penn$Return_Pct),\n        moments::kurtosis(czr$Return_Pct), moments::kurtosis(mgm$Return_Pct)\n    )\n)\n\nkable(summary_stats,\n    format = \"html\",\n    digits = 4,\n    caption = \"Comparative Summary Statistics: Sports Betting Stocks\",\n    col.names = c(\n        \"Stock\", \"Mean Return (%)\", \"Volatility (%)\", \"Min Return (%)\",\n        \"Max Return (%)\", \"Skewness\", \"Kurtosis\"\n    )\n) %>%\n    kable_styling(\n        full_width = FALSE,\n        bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\")\n    ) %>%\n    row_spec(which.max(summary_stats$Volatility), bold = TRUE, color = \"white\", background = \"#8B0000\") %>%\n    row_spec(which.min(summary_stats$Volatility), bold = TRUE, color = \"white\", background = \"#006400\")\n```\n\n## Return Distributions\n\n```{r return-distributions, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\n# Density plots\nggplot(all_returns, aes(x = Return_Pct, fill = Ticker)) +\n    geom_density(alpha = 0.5) +\n    facet_wrap(~Ticker, scales = \"free_y\") +\n    labs(\n        title = \"Return Distribution Comparison\",\n        subtitle = \"All stocks show fat tails (leptokurtic distributions)\",\n        x = \"Return (%)\",\n        y = \"Density\"\n    ) +\n    scale_fill_manual(values = c(\n        \"DKNG\" = \"#006bb6\", \"PENN\" = \"darkred\",\n        \"CZR\" = \"darkgreen\", \"MGM\" = \"darkorange\"\n    )) +\n    geom_vline(xintercept = 0, linetype = \"dashed\", color = \"black\") +\n    theme_minimal() +\n    theme(legend.position = \"none\")\n\n# Box plots\nggplot(all_returns, aes(x = Ticker, y = Return_Pct, fill = Ticker)) +\n    geom_boxplot(alpha = 0.7, outlier.alpha = 0.3) +\n    labs(\n        title = \"Return Distribution Box Plots\",\n        subtitle = \"PENN shows widest range and most extreme outliers\",\n        x = \"Stock\",\n        y = \"Return (%)\"\n    ) +\n    scale_fill_manual(values = c(\n        \"DKNG\" = \"#006bb6\", \"PENN\" = \"darkred\",\n        \"CZR\" = \"darkgreen\", \"MGM\" = \"darkorange\"\n    )) +\n    geom_hline(yintercept = 0, linetype = \"dashed\", color = \"red\") +\n    theme_minimal() +\n    theme(legend.position = \"none\")\n```\n\n## Correlation Analysis\n\n```{r correlation-analysis, warning=FALSE, message=FALSE, fig.width=10, fig.height=8, results='asis'}\n# Create wide format for correlation\nreturns_wide <- all_returns %>%\n    dplyr::select(Date, Ticker, Return_Pct) %>%\n    pivot_wider(names_from = Ticker, values_from = Return_Pct) %>%\n    dplyr::select(-Date) %>%\n    na.omit()\n\n# Correlation matrix\ncor_matrix <- cor(returns_wide)\n\n# Display formatted correlation matrix table\ncat(\"### Correlation Matrix\\n\\n\")\nkable(round(cor_matrix, 3),\n    format = \"html\",\n    digits = 3,\n    caption = \"Return Correlations Among Sports Betting Stocks\"\n) %>%\n    kable_styling(\n        full_width = FALSE,\n        bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\")\n    )\n\n# Heatmap\nlibrary(reshape2)\ncor_melted <- melt(cor_matrix)\n\nggplot(cor_melted, aes(Var1, Var2, fill = value)) +\n    geom_tile(color = \"white\") +\n    geom_text(aes(label = round(value, 2)), color = \"black\", size = 5, fontface = \"bold\") +\n    scale_fill_gradient2(\n        low = \"#d1e5f0\", high = \"#006bb6\", mid = \"white\",\n        midpoint = 0, limit = c(-1, 1), space = \"Lab\",\n        name = \"Correlation\"\n    ) +\n    labs(\n        title = \"Return Correlation Heatmap\",\n        subtitle = \"Sports betting stocks show moderate to high positive correlation\",\n        x = NULL, y = NULL\n    ) +\n    theme_minimal() +\n    theme(\n        axis.text.x = element_text(angle = 45, hjust = 1, size = 11),\n        axis.text.y = element_text(size = 11),\n        plot.title = element_text(face = \"bold\")\n    )\n```\n\n**Correlation Insights**:\n\n- All stocks show **positive correlation** (0.3-0.7), indicating they respond to common industry factors\n- **CZR-MGM** show highest correlation (~0.6-0.7): both traditional casino operators\n- **DKNG-PENN** moderate correlation (~0.4-0.5): pure-play sports betting focus\n- Correlations increase during crisis periods (systematic risk)\n\n## Business Model Comparison\n\n::: {style=\"font-size: 0.9em;\"}\n\n| Stock | Business Model | Volatility Profile | Key Risks |\n|-------|---------------|-------------------|-----------|\n| **DKNG** | Pure-play online sports betting & DFS | Moderate-High | Regulatory, competition, customer acquisition costs |\n| **PENN** | Regional casinos + ESPN BET partnership | **Highest** | Business model transition, brand partnerships |\n| **CZR** | Casino operator + Caesars Sportsbook | Moderate | Debt levels, integration risks, competition |\n| **MGM** | Resort/casino + BetMGM | **Lowest** | Diversified operations reduce volatility |\n\n:::\n\n:::\n\n---\n\n# Bridging to Deep Learning for Time Series\n\nThe financial models above demonstrate that sports betting stocks exhibit classic volatility clustering patterns captured by ARCH/GARCH frameworks. DKNG, PENN, CZR, and MGM show time-varying variance where turbulent periods persist before giving way to calm. These models excel at forecasting **conditional volatility**—predicting the uncertainty around returns rather than the returns themselves—making them essential for risk management and options pricing.\n\nYet ARCH/GARCH models share a fundamental assumption with ARIMA and VAR: they impose **explicit parametric structure**. GARCH(1,1) assumes today's variance depends on yesterday's variance and yesterday's squared return with fixed coefficients. ARIMA(p,d,q) requires us to specify lag orders before fitting. These models demand domain expertise and statistical judgment, making them powerful when assumptions hold but brittle when reality deviates.\n\n**The deep learning alternative** abandons explicit parameterization in favor of learned representations. Recurrent neural networks (RNNs), Long Short-Term Memory (LSTM), and Gated Recurrent Units (GRUs) automatically discover temporal patterns through gradient descent rather than requiring analysts to pre-specify AR and MA terms. This flexibility enables deep learning models to capture complex nonlinearities, long-range dependencies, and regime shifts that defy simple parametric forms.\n\n**The next chapter** tests whether this flexibility improves forecasts or simply overfits limited data. With only 45 years of NBA data, do LSTM's 1,600+ parameters extract genuine signal or memorize noise? The comparison is direct: identical train/test splits, identical evaluation metrics (RMSE, MAE), identical target variable (ORtg). Traditional methods have interpretable coefficients and well-understood statistical properties; deep learning offers representational power but requires careful regularization.\n\n**What you'll see next:**\n\n- **RNN, LSTM, and GRU architectures** applied to NBA offensive efficiency forecasting, with explicit comparison to ARIMA baselines\n- **Regularization techniques** (L2 penalties, dropout, early stopping) that prevent overfitting on small datasets\n- **Input windowing** that transforms annual observations into supervised learning sequences (5-year windows → 1-year ahead)\n- **Performance comparison tables** showing whether deep learning adds value beyond traditional methods for sports analytics\n\nThe transition from financial to deep learning models reflects a methodological tension in modern forecasting: **parametric parsimony versus representational flexibility**. GARCH models have 2-3 parameters; LSTMs have thousands. For volatile betting stocks with rich intraday data, that complexity may capture genuine structure. For annual NBA statistics with 45 observations, it may simply overfit.\n\n**The critical question:** Does basketball's evolution exhibit patterns too complex for ARIMA's linear assumptions but too simple for LSTM's deep architecture? Or do we sit in the sweet spot where both approaches offer complementary insights? The empirical comparison tests whether sports analytics has entered the deep learning era or whether classical time series methods remain the gold standard for data-scarce domains.\n\nWhere GARCH asked \"How does volatility evolve?\", deep learning asks \"What temporal patterns can we learn without assuming functional form?\" Both frameworks forecast the future, but from opposite epistemological starting points: theory-driven specification versus data-driven discovery.\n\n---\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"toc-depth":3,"embed-resources":true,"output-file":"financialTS_model.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.55","jupyter":{"kernel":"dsan6600-tfk-v2"},"bibliography":["references.bib"],"csl":"nature.csl","theme":{"light":"sketchy","dark":"slate"},"toggle-theme":true,"page-navigation":true,"title":"Financial Time Series Models"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}