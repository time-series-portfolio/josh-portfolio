{"title":"Exploratory Data Analysis: Offensive Efficiency in the Modern NBA","markdown":{"yaml":{"title":"Exploratory Data Analysis: Offensive Efficiency in the Modern NBA","format":{"html":{"embed-resources":true,"toc":true,"code-fold":true}}},"headingText":"1. Offensive Rating (ORtg)","containsRefs":false,"markdown":"\n\nThe modern NBA has steadily evolved toward higher offensive efficiency, with a clear acceleration in the last decade. Using league-average annual data from 1980–2025, I track Offensive Rating (ORtg), Pace, and 3-Point Attempt Rate (3PAr), then layer in attendance to capture COVID’s shock, and finally use weekly sports-betting stocks as a compact example of seasonal decomposition.\n\n```{r setup, warning=FALSE, message=FALSE}\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(forecast)\nlibrary(astsa)\nlibrary(xts)\nlibrary(tseries)\nlibrary(fpp2)\nlibrary(fma)\nlibrary(lubridate)\nlibrary(TSstudio)\nlibrary(readr)\nlibrary(dplyr)\nlibrary(patchwork)\nlibrary(seasonal)\nlibrary(GGally)\n\ntheme_set(theme_minimal(base_size = 12))\n\nall_adv_files <- list.files(\"data/adv_stats\", pattern = \"*.csv\", full.names = TRUE)\n\nall_adv_data <- map_df(all_adv_files, function(file) {\n    season_str <- str_extract(basename(file), \"\\\\d{4}-\\\\d{2}\")\n    season_year <- as.numeric(str_sub(season_str, 1, 4)) + 1\n\n    df <- read_csv(file, show_col_types = FALSE)\n    df$Season <- season_year\n    return(df)\n})\n\nleague_avg <- all_adv_data %>%\n    group_by(Season) %>%\n    summarise(\n        ORtg = mean(`Unnamed: 10_level_0_ORtg`, na.rm = TRUE),\n        DRtg = mean(`Unnamed: 11_level_0_DRtg`, na.rm = TRUE),\n        Pace = mean(`Unnamed: 13_level_0_Pace`, na.rm = TRUE),\n        `3PAr` = mean(`Unnamed: 15_level_0_3PAr`, na.rm = TRUE),\n        `TS%` = mean(`Unnamed: 16_level_0_TS%`, na.rm = TRUE),\n        `eFG%` = mean(`Offense Four Factors_eFG%`, na.rm = TRUE),\n        .groups = \"drop\"\n    )\n```\n\n\n## 1.1 Time Series Visualization\n\n```{r ortg-plot, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\n# Convert to time series object\nts_ortg <- ts(league_avg$ORtg, start = 1980, frequency = 1)\n\n# Create visualization\ndf_ortg <- data.frame(\n    Year = league_avg$Season,\n    Value = league_avg$ORtg,\n    Era = case_when(\n        league_avg$Season < 2012 ~ \"Pre-Analytics Era\",\n        league_avg$Season >= 2012 & league_avg$Season < 2020 ~ \"Analytics Era\",\n        league_avg$Season >= 2020 ~ \"Post-COVID Era\"\n    )\n)\n\nggplot(df_ortg, aes(x = Year, y = Value, color = Era)) +\n    geom_line(size = 1.2) +\n    geom_point(size = 3) +\n    geom_vline(xintercept = 2012, linetype = \"dashed\", color = \"#f58426\", size = 1) +\n    geom_vline(xintercept = 2020, linetype = \"dashed\", color = \"#bec0c2\", size = 1) +\n    annotate(\"text\",\n        x = 2012, y = 112, label = \"Analytics Era\\nBegins (2012)\",\n        hjust = -0.1, color = \"#f58426\", fontface = \"bold\", size = 3.5\n    ) +\n    annotate(\"text\",\n        x = 2020, y = 112, label = \"COVID-19\\n(2020)\",\n        hjust = 1.1, color = \"#bec0c2\", fontface = \"bold\", size = 3.5\n    ) +\n    scale_color_manual(values = c(\n        \"Pre-Analytics Era\" = \"#006bb6\",\n        \"Analytics Era\" = \"#f58426\",\n        \"Post-COVID Era\" = \"#bec0c2\"\n    )) +\n    labs(\n        title = \"NBA Offensive Rating (1980-2025): Evolution of Scoring Efficiency\",\n        x = \"Season\",\n        y = \"Offensive Rating (ORtg)\",\n        color = \"Era\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(\n        plot.title = element_text(face = \"bold\", size = 14),\n        plot.subtitle = element_text(size = 11, color = \"gray40\"),\n        legend.position = \"bottom\"\n    )\n```\n\n## 1.2 Lag Plots\n\n```{r ortg-lag, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\ngglagplot(ts_ortg, do.lines = FALSE, lags = 9) +\n    ggtitle(\"Lag Plot of Offensive Rating (ORtg)\") +\n    theme_minimal()\n```\n\n## 1.3 ACF and PACF Analysis\n\n```{r ortg-acf, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\nacf_ortg <- ggAcf(ts_ortg, lag.max = 20) +\n    labs(title = \"ACF of Offensive Rating (ORtg)\") +\n    theme_minimal()\n\npacf_ortg <- ggPacf(ts_ortg, lag.max = 20) +\n    labs(title = \"PACF of Offensive Rating (ORtg)\") +\n    theme_minimal()\n\nacf_ortg / pacf_ortg\n```\n\n## 1.4 Augmented Dickey-Fuller Test\n\n```{r ortg-adf, warning=FALSE, message=FALSE}\nadf_ortg <- adf.test(ts_ortg)\nprint(adf_ortg)\n```\n\n## 1.5 Trend Decomposition - Additive Model\n\n```{r ortg-decomp, warning=FALSE, message=FALSE, fig.width=12, fig.height=10}\n# Create data frame for decomposition\ndf_ortg_decomp <- data.frame(\n    Year = time(ts_ortg),\n    Value = as.numeric(ts_ortg)\n)\n\n# Fit LOESS smooth to extract trend (additive decomposition)\ndf_ortg_decomp$Trend <- predict(loess(Value ~ Year, data = df_ortg_decomp, span = 0.3))\ndf_ortg_decomp$Irregular <- df_ortg_decomp$Value - df_ortg_decomp$Trend # Additive: residual = observed - trend\n\n# Visualize components\np1 <- ggplot(df_ortg_decomp, aes(x = Year)) +\n    geom_line(aes(y = Value, color = \"Original\"), size = 1) +\n    geom_line(aes(y = Trend, color = \"Trend\"), size = 1.2) +\n    scale_color_manual(values = c(\"Original\" = \"#006bb6\", \"Trend\" = \"#f58426\")) +\n    labs(title = \"ORtg: Original Series vs. Trend (Additive Decomposition)\", y = \"Offensive Rating\") +\n    theme_minimal() +\n    theme(legend.title = element_blank())\n\np2 <- ggplot(df_ortg_decomp, aes(x = Year, y = Irregular)) +\n    geom_hline(yintercept = 0, linetype = \"dashed\", color = \"gray50\") +\n    geom_line(color = \"#000000\", size = 0.8) +\n    geom_point(color = \"#000000\", size = 2) +\n    labs(title = \"ORtg: Irregular Component (Additive Residuals)\", y = \"Residual (points)\") +\n    theme_minimal()\n\np1 / p2\n```\n\n## 1.6 Differencing for Stationarity\n\n```{r ortg-diff, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\n# First difference\ndiff_ortg <- diff(ts_ortg, differences = 1)\n\npar(mfrow = c(2, 1))\nplot(ts_ortg, main = \"Original ORtg Series\", ylab = \"ORtg\", xlab = \"Year\")\nplot(diff_ortg, main = \"First Differenced ORtg Series\", ylab = \"Change in ORtg\", xlab = \"Year\")\n```\n\n```{r ortg-diff-acf, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\nacf_diff_ortg <- ggAcf(diff_ortg, lag.max = 20) +\n    labs(title = \"ACF of First Differenced ORtg\") +\n    theme_minimal()\n\npacf_diff_ortg <- ggPacf(diff_ortg, lag.max = 20) +\n    labs(title = \"PACF of First Differenced ORtg\") +\n    theme_minimal()\n\nacf_diff_ortg / pacf_diff_ortg\n```\n\n```{r ortg-diff-adf, warning=FALSE, message=FALSE}\nadf_diff_ortg <- adf.test(diff_ortg)\nprint(adf_diff_ortg)\n```\n\nORtg, points per 100 possessions, is the primary outcome. The long-run trend is unambiguously upward but non-linear. A slow climb through the 1980s–2000s, then a pronounced step-up beginning around 2012, and continued gains into the post-COVID years. Autocorrelation patterns (slow ACF decay and PACF spike at lag 1) and an ADF test confirm ORtg is non-stationary in levels but becomes stationary after first-differencing; variance is roughly constant, so an additive structure fits. A simple LOESS trend explains nearly all variation, with small residuals. This implies that the story is primarily about a structural trend rather than short-cycle oscillations.\n\n# 2. Mediating Variable: Pace\n\n## 2.1 Time Series Visualization\n\n```{r pace-plot, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\nts_pace <- ts(league_avg$Pace, start = 1980, frequency = 1)\n\ndf_pace <- data.frame(\n    Year = league_avg$Season,\n    Value = league_avg$Pace,\n    Era = df_ortg$Era\n)\n\nggplot(df_pace, aes(x = Year, y = Value, color = Era)) +\n    geom_line(size = 1.2) +\n    geom_point(size = 3) +\n    geom_vline(xintercept = 2012, linetype = \"dashed\", color = \"#f58426\", size = 1) +\n    scale_color_manual(values = c(\n        \"Pre-Analytics Era\" = \"#006bb6\",\n        \"Analytics Era\" = \"#f58426\",\n        \"Post-COVID Era\" = \"#bec0c2\"\n    )) +\n    labs(\n        title = \"NBA Pace (1980-2025): Possessions Per 48 Minutes\",\n        x = \"Season\",\n        y = \"Pace (Possessions per 48 min)\",\n        color = \"Era\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(\n        plot.title = element_text(face = \"bold\", size = 14),\n        plot.subtitle = element_text(size = 11, color = \"gray40\"),\n        legend.position = \"bottom\"\n    )\n```\n\n## 2.2 Lag Plots\n\n```{r pace-lag, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\ngglagplot(ts_pace, do.lines = FALSE, lags = 9) +\n    ggtitle(\"Lag Plot of Pace\") +\n    theme_minimal()\n```\n\n## 2.3 ACF and PACF Analysis\n\n```{r pace-acf, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\nacf_pace <- ggAcf(ts_pace, lag.max = 20) +\n    labs(title = \"ACF of Pace\") +\n    theme_minimal()\n\npacf_pace <- ggPacf(ts_pace, lag.max = 20) +\n    labs(title = \"PACF of Pace\") +\n    theme_minimal()\n\nacf_pace / pacf_pace\n```\n\n## 2.3 Stationarity Testing\n\n```{r pace-adf, warning=FALSE, message=FALSE}\nadf_pace <- adf.test(ts_pace)\nprint(adf_pace)\n```\n\n```{r pace-diff, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\ndiff_pace <- diff(ts_pace, differences = 1)\n\npar(mfrow = c(2, 1))\nplot(ts_pace, main = \"Original Pace Series\", ylab = \"Pace\", xlab = \"Year\")\nplot(diff_pace, main = \"First Differenced Pace Series\", ylab = \"Change in Pace\", xlab = \"Year\")\n```\n\n```{r pace-diff-acf, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\nacf_diff_pace <- ggAcf(diff_pace, lag.max = 20) +\n    labs(title = \"ACF of First Differenced Pace\") +\n    theme_minimal()\n\npacf_diff_pace <- ggPacf(diff_pace, lag.max = 20) +\n    labs(title = \"PACF of First Differenced Pace\") +\n    theme_minimal()\n\nacf_diff_pace / pacf_diff_pace\n```\n\n```{r pace-diff-adf, warning=FALSE, message=FALSE}\nadf_diff_pace <- adf.test(diff_pace)\nprint(adf_diff_pace)\n```\n\n## 2.4 Moving Average Smoothing\n\n```{r pace-ma-smoothing, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\nma_pace_3 <- ma(ts_pace, order = 3) # 3-year window (short-term)\nma_pace_5 <- ma(ts_pace, order = 5) # 5-year window (medium-term)\nma_pace_10 <- ma(ts_pace, order = 10) # 10-year window (long-term)\n\nautoplot(ts_pace, series = \"Original\") +\n    autolayer(ma_pace_3, series = \"MA(3)\") +\n    autolayer(ma_pace_5, series = \"MA(5)\") +\n    autolayer(ma_pace_10, series = \"MA(10)\") +\n    scale_color_manual(\n        values = c(\n            \"Original\" = \"gray60\",\n            \"MA(3)\" = \"#006bb6\",\n            \"MA(5)\" = \"#f58426\",\n            \"MA(10)\" = \"#000000\"\n        ),\n        breaks = c(\"Original\", \"MA(3)\", \"MA(5)\", \"MA(10)\")\n    ) +\n    labs(\n        title = \"Pace: Moving Average Smoothing Comparison\",\n        subtitle = \"U-shaped trajectory becomes clearer with increased smoothing\",\n        y = \"Pace (possessions per 48 min)\",\n        x = \"Season\",\n        color = \"Series\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(\n        plot.title = element_text(face = \"bold\", size = 14),\n        plot.subtitle = element_text(size = 11, color = \"gray40\"),\n        legend.position = \"bottom\"\n    )\n```\n\nPace, the mediator in this story, follows a different trajectory: a classic U-shape. Possessions per 48 minutes decline from fast 1980s basketball to a trough in the mid-2000s, then recover through the 2010s and 2020s. Importantly, the Pace recovery begins before the analytics inflection, suggesting it is not simply a byproduct of analytics. Like ORtg, Pace is non-stationary in levels and stationary in first differences; moving-average smoothers with 5–10 year windows make the U-shape especially clear. This is rather significant as this means efficiency gains do not reduce to “more possessions\".\n\n# 3. Key Independent Variable: 3-Point Attempt Rate (3PAr)\n\n## 3.1 Time Series Visualization\n\n```{r 3par-plot, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\nts_3par <- ts(league_avg$`3PAr`, start = 1980, frequency = 1)\n\ndf_3par <- data.frame(\n    Year = league_avg$Season,\n    Value = league_avg$`3PAr`,\n    Era = df_ortg$Era\n)\n\nggplot(df_3par, aes(x = Year, y = Value, color = Era)) +\n    geom_line(size = 1.2) +\n    geom_point(size = 3) +\n    geom_vline(xintercept = 2012, linetype = \"dashed\", color = \"#f58426\", size = 1) +\n    annotate(\"text\",\n        x = 2012, y = 0.44, label = \"Analytics Era Begins\",\n        hjust = -0.05, color = \"#f58426\", fontface = \"bold\", size = 3.5\n    ) +\n    scale_color_manual(values = c(\n        \"Pre-Analytics Era\" = \"#006bb6\",\n        \"Analytics Era\" = \"#f58426\",\n        \"Post-COVID Era\" = \"#bec0c2\"\n    )) +\n    scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +\n    labs(\n        title = \"NBA 3-Point Attempt Rate (1980-2025)\",\n        subtitle = \"Percentage of field goal attempts that are three-pointers\",\n        x = \"Season\",\n        y = \"3-Point Attempt Rate (3PAr)\",\n        color = \"Era\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(\n        plot.title = element_text(face = \"bold\", size = 14),\n        plot.subtitle = element_text(size = 11, color = \"gray40\"),\n        legend.position = \"bottom\"\n    )\n```\n\n## 3.2 Lag Plots\n\n```{r 3par-lag, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\ngglagplot(ts_3par, do.lines = FALSE, lags = 9) +\n    ggtitle(\"Lag Plot of 3-Point Attempt Rate (3PAr)\") +\n    theme_minimal()\n```\n\n## 3.3 Stationarity Analysis\n\n```{r 3par-acf, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\nacf_3par <- ggAcf(ts_3par, lag.max = 20) +\n    labs(title = \"ACF of 3PAr\") +\n    theme_minimal()\n\npacf_3par <- ggPacf(ts_3par, lag.max = 20) +\n    labs(title = \"PACF of 3PAr\") +\n    theme_minimal()\n\nacf_3par / pacf_3par\n```\n\n```{r 3par-adf, warning=FALSE, message=FALSE}\nadf_3par <- adf.test(ts_3par)\nprint(adf_3par)\n```\n\n```{r 3par-diff, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\ndiff_3par <- diff(ts_3par, differences = 1)\n\npar(mfrow = c(2, 1))\nplot(ts_3par, main = \"Original 3PAr Series\", ylab = \"3PAr\", xlab = \"Year\")\nplot(diff_3par, main = \"First Differenced 3PAr Series\", ylab = \"Change in 3PAr\", xlab = \"Year\")\n```\n\n```{r 3par-diff-acf, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\nacf_diff_3par <- ggAcf(diff_3par, lag.max = 20) +\n    labs(title = \"ACF of First Differenced 3PAr\") +\n    theme_minimal()\n\npacf_diff_3par <- ggPacf(diff_3par, lag.max = 20) +\n    labs(title = \"PACF of First Differenced 3PAr\") +\n    theme_minimal()\n\nacf_diff_3par / pacf_diff_3par\n```\n\n```{r 3par-diff-adf, warning=FALSE, message=FALSE}\nadf_diff_3par <- adf.test(diff_3par)\nprint(adf_diff_3par)\n```\n\n## 3.4 Moving Average Smoothing for 3PAr\n\n```{r 3par-ma-smoothing, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\n# Calculate moving averages with different windows\nma_3par_3 <- ma(ts_3par, order = 3) # 3-year window (short-term)\nma_3par_5 <- ma(ts_3par, order = 5) # 5-year window (medium-term)\nma_3par_10 <- ma(ts_3par, order = 10) # 10-year window (long-term)\n\n# Create comparison plot\nautoplot(ts_3par, series = \"Original\") +\n    autolayer(ma_3par_3, series = \"MA(3)\") +\n    autolayer(ma_3par_5, series = \"MA(5)\") +\n    autolayer(ma_3par_10, series = \"MA(10)\") +\n    scale_color_manual(\n        values = c(\n            \"Original\" = \"gray60\",\n            \"MA(3)\" = \"#006bb6\",\n            \"MA(5)\" = \"#f58426\",\n            \"MA(10)\" = \"#000000\"\n        ),\n        breaks = c(\"Original\", \"MA(3)\", \"MA(5)\", \"MA(10)\")\n    ) +\n    scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +\n    labs(\n        title = \"3-Point Attempt Rate: Moving Average Smoothing Comparison\",\n        subtitle = \"Analytics revolution's exponential growth pattern clearly visible\",\n        y = \"3-Point Attempt Rate (3PAr)\",\n        x = \"Season\",\n        color = \"Series\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(\n        plot.title = element_text(face = \"bold\", size = 14),\n        plot.subtitle = element_text(size = 11, color = \"gray40\"),\n        legend.position = \"bottom\"\n    )\n```\n\nThe strongest structural break appears in 3PAr, which measures the share of shots taken from three. 3PAr rises modestly for decades and then accelerates sharply around 2012, around the same period where ORtg takes off. Lag plots show strong positive relationships across lags, and ACF/PACF behavior again indicates a trending series (non-stationary levels; stationary first differences). Smoothing highlights two regimes: a gradual era up to around 2012 and a rapid, near-exponential climb thereafter. This timing alignment supports the hypothesis that shot selection modernization (spacing, threes above the break, rim attempts enabled by space) is tightly coupled to league-wide efficiency gains\n\n# 4. Attendance: COVID-19 Impact Analysis\n\n## 4.1 Time Series Visualization\n\n```{r attendance-prep, warning=FALSE, message=FALSE}\n# Calculate league-wide attendance by season\nattendance_data <- all_adv_data %>%\n    group_by(Season) %>%\n    summarise(\n        Total_Attendance = sum(`Unnamed: 29_level_0_Attend.`, na.rm = TRUE),\n        Avg_Attendance = mean(`Unnamed: 30_level_0_Attend./G`, na.rm = TRUE),\n        .groups = \"drop\"\n    )\n\n# Create time series (focusing on modern era 1990-2025)\nattendance_data <- attendance_data %>% filter(Season >= 1990)\nts_attendance <- ts(attendance_data$Total_Attendance, start = 1990, frequency = 1)\n```\n\n```{r attendance-plot, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\ndf_attendance <- data.frame(\n    Year = attendance_data$Season,\n    Value = attendance_data$Total_Attendance / 1e6, # Convert to millions\n    Era = case_when(\n        attendance_data$Season < 2020 ~ \"Pre-COVID\",\n        attendance_data$Season >= 2020 & attendance_data$Season < 2022 ~ \"COVID Era\",\n        attendance_data$Season >= 2022 ~ \"Post-COVID Recovery\"\n    )\n)\n\nggplot(df_attendance, aes(x = Year, y = Value, color = Era)) +\n    geom_line(size = 1.2) +\n    geom_point(size = 3) +\n    geom_vline(xintercept = 2020, linetype = \"dashed\", color = \"red\", size = 1) +\n    annotate(\"text\",\n        x = 2020, y = 24, label = \"COVID-19\\nPandemic (2020)\",\n        hjust = -0.05, color = \"red\", fontface = \"bold\", size = 3.5\n    ) +\n    annotate(\"rect\",\n        xmin = 2020, xmax = 2021, ymin = 0, ymax = 25,\n        alpha = 0.1, fill = \"red\"\n    ) +\n    scale_color_manual(values = c(\n        \"Pre-COVID\" = \"#006bb6\",\n        \"COVID Era\" = \"#d62728\",\n        \"Post-COVID Recovery\" = \"#2ca02c\"\n    )) +\n    labs(\n        title = \"NBA Total Attendance (1990-2025): COVID-19 Disruption and Recovery\",\n        subtitle = \"90% collapse in 2020-21 followed by gradual recovery\",\n        x = \"Season\",\n        y = \"Total Attendance (Millions)\",\n        color = \"Era\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(\n        plot.title = element_text(face = \"bold\", size = 14),\n        plot.subtitle = element_text(size = 11, color = \"gray40\"),\n        legend.position = \"bottom\"\n    )\n```\n\n## 4.2 Lag Plots\n\n```{r attendance-lag, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\ngglagplot(ts_attendance, do.lines = FALSE, lags = 9) +\n    ggtitle(\"Lag Plot of Total Attendance\") +\n    theme_minimal()\n```\n\n## 4.3 ACF and PACF Analysis\n\n```{r attendance-acf, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\nacf_attendance <- ggAcf(ts_attendance, lag.max = 15) +\n    labs(title = \"ACF of Total Attendance\") +\n    theme_minimal()\n\npacf_attendance <- ggPacf(ts_attendance, lag.max = 15) +\n    labs(title = \"PACF of Total Attendance\") +\n    theme_minimal()\n\nacf_attendance / pacf_attendance\n```\n\n## 4.4 Moving Average Smoothing for Attendance\n\n```{r attendance-ma-smoothing, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\n# Calculate moving averages\nma_attendance_3 <- ma(ts_attendance, order = 3)\nma_attendance_5 <- ma(ts_attendance, order = 5)\n\n# Plot comparison\nautoplot(ts_attendance, series = \"Original\") +\n    autolayer(ma_attendance_3, series = \"MA(3)\") +\n    autolayer(ma_attendance_5, series = \"MA(5)\") +\n    scale_color_manual(\n        values = c(\n            \"Original\" = \"gray60\",\n            \"MA(3)\" = \"#006bb6\",\n            \"MA(5)\" = \"#f58426\"\n        ),\n        breaks = c(\"Original\", \"MA(3)\", \"MA(5)\")\n    ) +\n    labs(\n        title = \"Attendance: Moving Average Smoothing (COVID Shock Visible)\",\n        subtitle = \"Smoothing cannot remove the dramatic 2020-21 disruption\",\n        y = \"Total Attendance (millions)\",\n        x = \"Season\",\n        color = \"Series\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(\n        plot.title = element_text(face = \"bold\", size = 14),\n        plot.subtitle = element_text(size = 11, color = \"gray40\"),\n        legend.position = \"bottom\"\n    )\n```\n\nAttendance provides the counterpoint: a stable pre-COVID plateau around ~21–22 million through 2019, a 2020–21 collapse during the bubble/limited-capacity seasons, and a partial recovery that remains below the pre-pandemic ceiling. The sharp, short-window discontinuity is a uncounted for shock rather than a new equilibrium. Even with 3–5 year moving averages, the COVID impact is too large to smooth away\n\n# 5. Financial Data: Sports Betting Stocks - Time Series with Seasonality\n\n## 5.1 Data Preparation and Time Series Creation\n\n```{r betting-stocks-load, warning=FALSE, message=FALSE}\n# Load all sports betting stocks\ndkng <- read_csv(\"data/financial/DKNG_daily.csv\", show_col_types = FALSE) %>% mutate(Date = as.Date(Date))\npenn <- read_csv(\"data/financial/PENN_daily.csv\", show_col_types = FALSE) %>% mutate(Date = as.Date(Date))\nmgm <- read_csv(\"data/financial/MGM_daily.csv\", show_col_types = FALSE) %>% mutate(Date = as.Date(Date))\nczr <- read_csv(\"data/financial/CZR_daily.csv\", show_col_types = FALSE) %>% mutate(Date = as.Date(Date))\n\ncat(\"DKNG:\", nrow(dkng), \"days |\", min(dkng$Date), \"to\", max(dkng$Date), \"\\n\")\ncat(\"PENN:\", nrow(penn), \"days |\", min(penn$Date), \"to\", max(penn$Date), \"\\n\")\ncat(\"MGM:\", nrow(mgm), \"days |\", min(mgm$Date), \"to\", max(mgm$Date), \"\\n\")\ncat(\"CZR:\", nrow(czr), \"days |\", min(czr$Date), \"to\", max(czr$Date), \"\\n\")\n\n# Create weekly time series for all stocks\ncreate_weekly_ts <- function(df, ticker) {\n    weekly <- df %>%\n        mutate(Year = year(Date), Week = week(Date)) %>%\n        group_by(Year, Week) %>%\n        summarise(Avg_Close = mean(`Adj Close`, na.rm = TRUE), .groups = \"drop\") %>%\n        arrange(Year, Week)\n\n    start_year <- min(weekly$Year)\n    start_week <- weekly %>%\n        filter(Year == start_year) %>%\n        pull(Week) %>%\n        min()\n    ts(weekly$Avg_Close, start = c(start_year, start_week), frequency = 52)\n}\n\nts_dkng <- create_weekly_ts(dkng, \"DKNG\")\nts_penn <- create_weekly_ts(penn, \"PENN\")\nts_mgm <- create_weekly_ts(mgm, \"MGM\")\nts_czr <- create_weekly_ts(czr, \"CZR\")\n```\n\n## 5.2 Comparative Visualization: All Four Betting Stocks\n\n```{r betting-stocks-compare, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\n# Combine all stocks for comparison (normalize to starting price = 100)\nautoplot(ts_dkng / as.numeric(ts_dkng)[1] * 100, series = \"DKNG\") +\n    autolayer(ts_penn / as.numeric(ts_penn)[1] * 100, series = \"PENN\") +\n    autolayer(ts_mgm / as.numeric(ts_mgm)[1] * 100, series = \"MGM\") +\n    autolayer(ts_czr / as.numeric(ts_czr)[1] * 100, series = \"CZR\") +\n    scale_color_manual(values = c(\"DKNG\" = \"#006bb6\", \"PENN\" = \"#f58426\", \"MGM\" = \"#00a94f\", \"CZR\" = \"#c8102e\")) +\n    labs(\n        title = \"Sports Betting Stocks: Normalized Performance (2020-2024)\",\n        subtitle = \"Indexed to 100 at each stock's start date | Boom-bust-stabilization pattern\",\n        y = \"Normalized Price (Start = 100)\", x = \"Year\", color = \"Stock\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(plot.title = element_text(face = \"bold\"), legend.position = \"bottom\")\n```\n\n## 5.3 DKNG Detailed Analysis\n\n```{r dkng-detail-plot, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\nautoplot(ts_dkng) +\n    annotate(\"rect\", xmin = 2021, xmax = 2021.5, ymin = 0, ymax = 70, alpha = 0.1, fill = \"orange\") +\n    annotate(\"text\", x = 2021.25, y = 65, label = \"Peak Boom\", color = \"orange\", fontface = \"bold\", size = 3) +\n    labs(\n        title = \"DraftKings (DKNG) Weekly Stock Price (2020-2024)\",\n        subtitle = \"IPO boom during COVID → correction → stabilization\",\n        x = \"Year\", y = \"Avg Weekly Adj Close ($)\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(plot.title = element_text(face = \"bold\", size = 14))\n```\n\n## 5.4 Seasonal Decomposition (DKNG)\n\n```{r dkng-decompose, warning=FALSE, message=FALSE, fig.width=12, fig.height=10}\n# Multiplicative decomposition (appropriate for stock prices)\ndecomp_dkng <- decompose(ts_dkng, type = \"multiplicative\")\n\n# Plot decomposition\nautoplot(decomp_dkng) +\n    labs(title = \"DKNG Stock: Seasonal Decomposition (Multiplicative Model)\") +\n    theme_minimal() +\n    theme(plot.title = element_text(face = \"bold\", size = 14))\n```\n\n## 5.5 Moving Average Smoothing (DKNG)\n\n```{r dkng-ma-smoothing, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\n# Calculate moving averages (using weeks)\nma_dkng_4 <- ma(ts_dkng, order = 4) # Monthly smoothing (~4 weeks)\nma_dkng_13 <- ma(ts_dkng, order = 13) # Quarterly smoothing (~13 weeks)\nma_dkng_52 <- ma(ts_dkng, order = 52) # Annual smoothing (52 weeks)\n\nautoplot(ts_dkng, series = \"Original\") +\n    autolayer(ma_dkng_4, series = \"MA(4 weeks)\") +\n    autolayer(ma_dkng_13, series = \"MA(13 weeks)\") +\n    autolayer(ma_dkng_52, series = \"MA(52 weeks)\") +\n    scale_color_manual(\n        values = c(\n            \"Original\" = \"gray60\",\n            \"MA(4 weeks)\" = \"#006bb6\",\n            \"MA(13 weeks)\" = \"#f58426\",\n            \"MA(52 weeks)\" = \"#000000\"\n        ),\n        breaks = c(\"Original\", \"MA(4 weeks)\", \"MA(13 weeks)\", \"MA(52 weeks)\")\n    ) +\n    labs(\n        title = \"DKNG Stock: Moving Average Smoothing Comparison\",\n        subtitle = \"Different windows reveal trading cycles vs long-term trends\",\n        y = \"Stock Price ($)\",\n        x = \"Year\",\n        color = \"Series\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(\n        plot.title = element_text(face = \"bold\", size = 14),\n        plot.subtitle = element_text(size = 11, color = \"gray40\"),\n        legend.position = \"bottom\"\n    )\n```\n\n## 5.6 ACF and Lag Plots (DKNG)\n\n```{r dkng-acf, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\nacf_dkng <- ggAcf(ts_dkng, lag.max = 52) +\n    labs(title = \"ACF of DKNG Weekly Stock Price\") +\n    theme_minimal()\n\npacf_dkng <- ggPacf(ts_dkng, lag.max = 52) +\n    labs(title = \"PACF of DKNG Weekly Stock Price\") +\n    theme_minimal()\n\nacf_dkng / pacf_dkng\n```\n\n## 5.7 PENN Analysis\n\n### 5.7.1 PENN Time Series Visualization\n\n```{r penn-detail-plot, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\nautoplot(ts_penn) +\n    annotate(\"rect\", xmin = 2020, xmax = 2021.5, ymin = 0, ymax = 140, alpha = 0.1, fill = \"red\") +\n    annotate(\"text\", x = 2020, y = 130, label = \"Covid-19\", color = \"red\", fontface = \"bold\", size = 3) +\n    labs(\n        title = \"Penn Entertainment (PENN) Weekly Stock Price (2020-2024)\",\n        x = \"Year\", y = \"Avg Weekly Adj Close ($)\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(plot.title = element_text(face = \"bold\", size = 14))\n```\n\n### 5.7.2 Seasonal Decomposition (PENN)\n\n```{r penn-decompose, warning=FALSE, message=FALSE, fig.width=12, fig.height=10}\n# Multiplicative decomposition\ndecomp_penn <- decompose(ts_penn, type = \"multiplicative\")\n\nautoplot(decomp_penn) +\n    labs(title = \"PENN Stock: Seasonal Decomposition (Multiplicative Model)\") +\n    theme_minimal() +\n    theme(plot.title = element_text(face = \"bold\", size = 14))\n```\n\n### 5.7.3 Moving Average Smoothing (PENN)\n\n```{r penn-ma-smoothing, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\nma_penn_4 <- ma(ts_penn, order = 4)\nma_penn_13 <- ma(ts_penn, order = 13)\nma_penn_52 <- ma(ts_penn, order = 52)\n\nautoplot(ts_penn, series = \"Original\") +\n    autolayer(ma_penn_4, series = \"MA(4 weeks)\") +\n    autolayer(ma_penn_13, series = \"MA(13 weeks)\") +\n    autolayer(ma_penn_52, series = \"MA(52 weeks)\") +\n    scale_color_manual(\n        values = c(\n            \"Original\" = \"gray60\",\n            \"MA(4 weeks)\" = \"#006bb6\",\n            \"MA(13 weeks)\" = \"#f58426\",\n            \"MA(52 weeks)\" = \"#000000\"\n        ),\n        breaks = c(\"Original\", \"MA(4 weeks)\", \"MA(13 weeks)\", \"MA(52 weeks)\")\n    ) +\n    labs(\n        title = \"PENN Stock: Moving Average Smoothing Comparison\",\n        subtitle = \"Even annual smoothing cannot hide the structural collapse\",\n        y = \"Stock Price ($)\", x = \"Year\", color = \"Series\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(\n        plot.title = element_text(face = \"bold\", size = 14),\n        plot.subtitle = element_text(size = 11, color = \"gray40\"),\n        legend.position = \"bottom\"\n    )\n```\n\n### 5.7.4 ACF and Lag Plots (PENN)\n\n```{r penn-acf, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\nacf_penn <- ggAcf(ts_penn, lag.max = 52) +\n    labs(title = \"ACF of PENN Weekly Stock Price\") +\n    theme_minimal()\n\npacf_penn <- ggPacf(ts_penn, lag.max = 52) +\n    labs(title = \"PACF of PENN Weekly Stock Price\") +\n    theme_minimal()\n\nacf_penn / pacf_penn\n```\n\nBecause annual NBA series are effectively non-seasonal, I include weekly sports-betting equities to demonstrate seasonality and multiplicative decomposition. DraftKings (DKNG), Penn (PENN), MGM, and Caesars (CZR) all show pandemic-era boom-bust dynamics on weekly data. Prices are non-stationary in levels, stationary in differences, and has volatility that scales with price; implying a multiplicative model is necessary for decomposition. DKNG exhibits a large run-up, correction, and stabilization while PENN shows a sharper hype-driven spike and deeper collapse. \n\nPulling the findings together: ORtg, Pace, 3PAr, and Attendance are all non-stationary in levels and become stationary after first differences (d = 1). Therefore, additive decomposition is appropriate for the NBA metrics , while multiplicative decomposition fits the weekly equities. Short and medium moving-average windows clarify regime shifts: the 2012 analytics inflection in ORtg/3PAr, the mid-2000s trough and rebound in Pace, and the COVID intervention in Attendance.","srcMarkdownNoYaml":"\n\nThe modern NBA has steadily evolved toward higher offensive efficiency, with a clear acceleration in the last decade. Using league-average annual data from 1980–2025, I track Offensive Rating (ORtg), Pace, and 3-Point Attempt Rate (3PAr), then layer in attendance to capture COVID’s shock, and finally use weekly sports-betting stocks as a compact example of seasonal decomposition.\n\n```{r setup, warning=FALSE, message=FALSE}\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(forecast)\nlibrary(astsa)\nlibrary(xts)\nlibrary(tseries)\nlibrary(fpp2)\nlibrary(fma)\nlibrary(lubridate)\nlibrary(TSstudio)\nlibrary(readr)\nlibrary(dplyr)\nlibrary(patchwork)\nlibrary(seasonal)\nlibrary(GGally)\n\ntheme_set(theme_minimal(base_size = 12))\n\nall_adv_files <- list.files(\"data/adv_stats\", pattern = \"*.csv\", full.names = TRUE)\n\nall_adv_data <- map_df(all_adv_files, function(file) {\n    season_str <- str_extract(basename(file), \"\\\\d{4}-\\\\d{2}\")\n    season_year <- as.numeric(str_sub(season_str, 1, 4)) + 1\n\n    df <- read_csv(file, show_col_types = FALSE)\n    df$Season <- season_year\n    return(df)\n})\n\nleague_avg <- all_adv_data %>%\n    group_by(Season) %>%\n    summarise(\n        ORtg = mean(`Unnamed: 10_level_0_ORtg`, na.rm = TRUE),\n        DRtg = mean(`Unnamed: 11_level_0_DRtg`, na.rm = TRUE),\n        Pace = mean(`Unnamed: 13_level_0_Pace`, na.rm = TRUE),\n        `3PAr` = mean(`Unnamed: 15_level_0_3PAr`, na.rm = TRUE),\n        `TS%` = mean(`Unnamed: 16_level_0_TS%`, na.rm = TRUE),\n        `eFG%` = mean(`Offense Four Factors_eFG%`, na.rm = TRUE),\n        .groups = \"drop\"\n    )\n```\n\n# 1. Offensive Rating (ORtg)\n\n## 1.1 Time Series Visualization\n\n```{r ortg-plot, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\n# Convert to time series object\nts_ortg <- ts(league_avg$ORtg, start = 1980, frequency = 1)\n\n# Create visualization\ndf_ortg <- data.frame(\n    Year = league_avg$Season,\n    Value = league_avg$ORtg,\n    Era = case_when(\n        league_avg$Season < 2012 ~ \"Pre-Analytics Era\",\n        league_avg$Season >= 2012 & league_avg$Season < 2020 ~ \"Analytics Era\",\n        league_avg$Season >= 2020 ~ \"Post-COVID Era\"\n    )\n)\n\nggplot(df_ortg, aes(x = Year, y = Value, color = Era)) +\n    geom_line(size = 1.2) +\n    geom_point(size = 3) +\n    geom_vline(xintercept = 2012, linetype = \"dashed\", color = \"#f58426\", size = 1) +\n    geom_vline(xintercept = 2020, linetype = \"dashed\", color = \"#bec0c2\", size = 1) +\n    annotate(\"text\",\n        x = 2012, y = 112, label = \"Analytics Era\\nBegins (2012)\",\n        hjust = -0.1, color = \"#f58426\", fontface = \"bold\", size = 3.5\n    ) +\n    annotate(\"text\",\n        x = 2020, y = 112, label = \"COVID-19\\n(2020)\",\n        hjust = 1.1, color = \"#bec0c2\", fontface = \"bold\", size = 3.5\n    ) +\n    scale_color_manual(values = c(\n        \"Pre-Analytics Era\" = \"#006bb6\",\n        \"Analytics Era\" = \"#f58426\",\n        \"Post-COVID Era\" = \"#bec0c2\"\n    )) +\n    labs(\n        title = \"NBA Offensive Rating (1980-2025): Evolution of Scoring Efficiency\",\n        x = \"Season\",\n        y = \"Offensive Rating (ORtg)\",\n        color = \"Era\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(\n        plot.title = element_text(face = \"bold\", size = 14),\n        plot.subtitle = element_text(size = 11, color = \"gray40\"),\n        legend.position = \"bottom\"\n    )\n```\n\n## 1.2 Lag Plots\n\n```{r ortg-lag, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\ngglagplot(ts_ortg, do.lines = FALSE, lags = 9) +\n    ggtitle(\"Lag Plot of Offensive Rating (ORtg)\") +\n    theme_minimal()\n```\n\n## 1.3 ACF and PACF Analysis\n\n```{r ortg-acf, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\nacf_ortg <- ggAcf(ts_ortg, lag.max = 20) +\n    labs(title = \"ACF of Offensive Rating (ORtg)\") +\n    theme_minimal()\n\npacf_ortg <- ggPacf(ts_ortg, lag.max = 20) +\n    labs(title = \"PACF of Offensive Rating (ORtg)\") +\n    theme_minimal()\n\nacf_ortg / pacf_ortg\n```\n\n## 1.4 Augmented Dickey-Fuller Test\n\n```{r ortg-adf, warning=FALSE, message=FALSE}\nadf_ortg <- adf.test(ts_ortg)\nprint(adf_ortg)\n```\n\n## 1.5 Trend Decomposition - Additive Model\n\n```{r ortg-decomp, warning=FALSE, message=FALSE, fig.width=12, fig.height=10}\n# Create data frame for decomposition\ndf_ortg_decomp <- data.frame(\n    Year = time(ts_ortg),\n    Value = as.numeric(ts_ortg)\n)\n\n# Fit LOESS smooth to extract trend (additive decomposition)\ndf_ortg_decomp$Trend <- predict(loess(Value ~ Year, data = df_ortg_decomp, span = 0.3))\ndf_ortg_decomp$Irregular <- df_ortg_decomp$Value - df_ortg_decomp$Trend # Additive: residual = observed - trend\n\n# Visualize components\np1 <- ggplot(df_ortg_decomp, aes(x = Year)) +\n    geom_line(aes(y = Value, color = \"Original\"), size = 1) +\n    geom_line(aes(y = Trend, color = \"Trend\"), size = 1.2) +\n    scale_color_manual(values = c(\"Original\" = \"#006bb6\", \"Trend\" = \"#f58426\")) +\n    labs(title = \"ORtg: Original Series vs. Trend (Additive Decomposition)\", y = \"Offensive Rating\") +\n    theme_minimal() +\n    theme(legend.title = element_blank())\n\np2 <- ggplot(df_ortg_decomp, aes(x = Year, y = Irregular)) +\n    geom_hline(yintercept = 0, linetype = \"dashed\", color = \"gray50\") +\n    geom_line(color = \"#000000\", size = 0.8) +\n    geom_point(color = \"#000000\", size = 2) +\n    labs(title = \"ORtg: Irregular Component (Additive Residuals)\", y = \"Residual (points)\") +\n    theme_minimal()\n\np1 / p2\n```\n\n## 1.6 Differencing for Stationarity\n\n```{r ortg-diff, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\n# First difference\ndiff_ortg <- diff(ts_ortg, differences = 1)\n\npar(mfrow = c(2, 1))\nplot(ts_ortg, main = \"Original ORtg Series\", ylab = \"ORtg\", xlab = \"Year\")\nplot(diff_ortg, main = \"First Differenced ORtg Series\", ylab = \"Change in ORtg\", xlab = \"Year\")\n```\n\n```{r ortg-diff-acf, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\nacf_diff_ortg <- ggAcf(diff_ortg, lag.max = 20) +\n    labs(title = \"ACF of First Differenced ORtg\") +\n    theme_minimal()\n\npacf_diff_ortg <- ggPacf(diff_ortg, lag.max = 20) +\n    labs(title = \"PACF of First Differenced ORtg\") +\n    theme_minimal()\n\nacf_diff_ortg / pacf_diff_ortg\n```\n\n```{r ortg-diff-adf, warning=FALSE, message=FALSE}\nadf_diff_ortg <- adf.test(diff_ortg)\nprint(adf_diff_ortg)\n```\n\nORtg, points per 100 possessions, is the primary outcome. The long-run trend is unambiguously upward but non-linear. A slow climb through the 1980s–2000s, then a pronounced step-up beginning around 2012, and continued gains into the post-COVID years. Autocorrelation patterns (slow ACF decay and PACF spike at lag 1) and an ADF test confirm ORtg is non-stationary in levels but becomes stationary after first-differencing; variance is roughly constant, so an additive structure fits. A simple LOESS trend explains nearly all variation, with small residuals. This implies that the story is primarily about a structural trend rather than short-cycle oscillations.\n\n# 2. Mediating Variable: Pace\n\n## 2.1 Time Series Visualization\n\n```{r pace-plot, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\nts_pace <- ts(league_avg$Pace, start = 1980, frequency = 1)\n\ndf_pace <- data.frame(\n    Year = league_avg$Season,\n    Value = league_avg$Pace,\n    Era = df_ortg$Era\n)\n\nggplot(df_pace, aes(x = Year, y = Value, color = Era)) +\n    geom_line(size = 1.2) +\n    geom_point(size = 3) +\n    geom_vline(xintercept = 2012, linetype = \"dashed\", color = \"#f58426\", size = 1) +\n    scale_color_manual(values = c(\n        \"Pre-Analytics Era\" = \"#006bb6\",\n        \"Analytics Era\" = \"#f58426\",\n        \"Post-COVID Era\" = \"#bec0c2\"\n    )) +\n    labs(\n        title = \"NBA Pace (1980-2025): Possessions Per 48 Minutes\",\n        x = \"Season\",\n        y = \"Pace (Possessions per 48 min)\",\n        color = \"Era\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(\n        plot.title = element_text(face = \"bold\", size = 14),\n        plot.subtitle = element_text(size = 11, color = \"gray40\"),\n        legend.position = \"bottom\"\n    )\n```\n\n## 2.2 Lag Plots\n\n```{r pace-lag, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\ngglagplot(ts_pace, do.lines = FALSE, lags = 9) +\n    ggtitle(\"Lag Plot of Pace\") +\n    theme_minimal()\n```\n\n## 2.3 ACF and PACF Analysis\n\n```{r pace-acf, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\nacf_pace <- ggAcf(ts_pace, lag.max = 20) +\n    labs(title = \"ACF of Pace\") +\n    theme_minimal()\n\npacf_pace <- ggPacf(ts_pace, lag.max = 20) +\n    labs(title = \"PACF of Pace\") +\n    theme_minimal()\n\nacf_pace / pacf_pace\n```\n\n## 2.3 Stationarity Testing\n\n```{r pace-adf, warning=FALSE, message=FALSE}\nadf_pace <- adf.test(ts_pace)\nprint(adf_pace)\n```\n\n```{r pace-diff, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\ndiff_pace <- diff(ts_pace, differences = 1)\n\npar(mfrow = c(2, 1))\nplot(ts_pace, main = \"Original Pace Series\", ylab = \"Pace\", xlab = \"Year\")\nplot(diff_pace, main = \"First Differenced Pace Series\", ylab = \"Change in Pace\", xlab = \"Year\")\n```\n\n```{r pace-diff-acf, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\nacf_diff_pace <- ggAcf(diff_pace, lag.max = 20) +\n    labs(title = \"ACF of First Differenced Pace\") +\n    theme_minimal()\n\npacf_diff_pace <- ggPacf(diff_pace, lag.max = 20) +\n    labs(title = \"PACF of First Differenced Pace\") +\n    theme_minimal()\n\nacf_diff_pace / pacf_diff_pace\n```\n\n```{r pace-diff-adf, warning=FALSE, message=FALSE}\nadf_diff_pace <- adf.test(diff_pace)\nprint(adf_diff_pace)\n```\n\n## 2.4 Moving Average Smoothing\n\n```{r pace-ma-smoothing, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\nma_pace_3 <- ma(ts_pace, order = 3) # 3-year window (short-term)\nma_pace_5 <- ma(ts_pace, order = 5) # 5-year window (medium-term)\nma_pace_10 <- ma(ts_pace, order = 10) # 10-year window (long-term)\n\nautoplot(ts_pace, series = \"Original\") +\n    autolayer(ma_pace_3, series = \"MA(3)\") +\n    autolayer(ma_pace_5, series = \"MA(5)\") +\n    autolayer(ma_pace_10, series = \"MA(10)\") +\n    scale_color_manual(\n        values = c(\n            \"Original\" = \"gray60\",\n            \"MA(3)\" = \"#006bb6\",\n            \"MA(5)\" = \"#f58426\",\n            \"MA(10)\" = \"#000000\"\n        ),\n        breaks = c(\"Original\", \"MA(3)\", \"MA(5)\", \"MA(10)\")\n    ) +\n    labs(\n        title = \"Pace: Moving Average Smoothing Comparison\",\n        subtitle = \"U-shaped trajectory becomes clearer with increased smoothing\",\n        y = \"Pace (possessions per 48 min)\",\n        x = \"Season\",\n        color = \"Series\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(\n        plot.title = element_text(face = \"bold\", size = 14),\n        plot.subtitle = element_text(size = 11, color = \"gray40\"),\n        legend.position = \"bottom\"\n    )\n```\n\nPace, the mediator in this story, follows a different trajectory: a classic U-shape. Possessions per 48 minutes decline from fast 1980s basketball to a trough in the mid-2000s, then recover through the 2010s and 2020s. Importantly, the Pace recovery begins before the analytics inflection, suggesting it is not simply a byproduct of analytics. Like ORtg, Pace is non-stationary in levels and stationary in first differences; moving-average smoothers with 5–10 year windows make the U-shape especially clear. This is rather significant as this means efficiency gains do not reduce to “more possessions\".\n\n# 3. Key Independent Variable: 3-Point Attempt Rate (3PAr)\n\n## 3.1 Time Series Visualization\n\n```{r 3par-plot, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\nts_3par <- ts(league_avg$`3PAr`, start = 1980, frequency = 1)\n\ndf_3par <- data.frame(\n    Year = league_avg$Season,\n    Value = league_avg$`3PAr`,\n    Era = df_ortg$Era\n)\n\nggplot(df_3par, aes(x = Year, y = Value, color = Era)) +\n    geom_line(size = 1.2) +\n    geom_point(size = 3) +\n    geom_vline(xintercept = 2012, linetype = \"dashed\", color = \"#f58426\", size = 1) +\n    annotate(\"text\",\n        x = 2012, y = 0.44, label = \"Analytics Era Begins\",\n        hjust = -0.05, color = \"#f58426\", fontface = \"bold\", size = 3.5\n    ) +\n    scale_color_manual(values = c(\n        \"Pre-Analytics Era\" = \"#006bb6\",\n        \"Analytics Era\" = \"#f58426\",\n        \"Post-COVID Era\" = \"#bec0c2\"\n    )) +\n    scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +\n    labs(\n        title = \"NBA 3-Point Attempt Rate (1980-2025)\",\n        subtitle = \"Percentage of field goal attempts that are three-pointers\",\n        x = \"Season\",\n        y = \"3-Point Attempt Rate (3PAr)\",\n        color = \"Era\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(\n        plot.title = element_text(face = \"bold\", size = 14),\n        plot.subtitle = element_text(size = 11, color = \"gray40\"),\n        legend.position = \"bottom\"\n    )\n```\n\n## 3.2 Lag Plots\n\n```{r 3par-lag, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\ngglagplot(ts_3par, do.lines = FALSE, lags = 9) +\n    ggtitle(\"Lag Plot of 3-Point Attempt Rate (3PAr)\") +\n    theme_minimal()\n```\n\n## 3.3 Stationarity Analysis\n\n```{r 3par-acf, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\nacf_3par <- ggAcf(ts_3par, lag.max = 20) +\n    labs(title = \"ACF of 3PAr\") +\n    theme_minimal()\n\npacf_3par <- ggPacf(ts_3par, lag.max = 20) +\n    labs(title = \"PACF of 3PAr\") +\n    theme_minimal()\n\nacf_3par / pacf_3par\n```\n\n```{r 3par-adf, warning=FALSE, message=FALSE}\nadf_3par <- adf.test(ts_3par)\nprint(adf_3par)\n```\n\n```{r 3par-diff, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\ndiff_3par <- diff(ts_3par, differences = 1)\n\npar(mfrow = c(2, 1))\nplot(ts_3par, main = \"Original 3PAr Series\", ylab = \"3PAr\", xlab = \"Year\")\nplot(diff_3par, main = \"First Differenced 3PAr Series\", ylab = \"Change in 3PAr\", xlab = \"Year\")\n```\n\n```{r 3par-diff-acf, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\nacf_diff_3par <- ggAcf(diff_3par, lag.max = 20) +\n    labs(title = \"ACF of First Differenced 3PAr\") +\n    theme_minimal()\n\npacf_diff_3par <- ggPacf(diff_3par, lag.max = 20) +\n    labs(title = \"PACF of First Differenced 3PAr\") +\n    theme_minimal()\n\nacf_diff_3par / pacf_diff_3par\n```\n\n```{r 3par-diff-adf, warning=FALSE, message=FALSE}\nadf_diff_3par <- adf.test(diff_3par)\nprint(adf_diff_3par)\n```\n\n## 3.4 Moving Average Smoothing for 3PAr\n\n```{r 3par-ma-smoothing, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\n# Calculate moving averages with different windows\nma_3par_3 <- ma(ts_3par, order = 3) # 3-year window (short-term)\nma_3par_5 <- ma(ts_3par, order = 5) # 5-year window (medium-term)\nma_3par_10 <- ma(ts_3par, order = 10) # 10-year window (long-term)\n\n# Create comparison plot\nautoplot(ts_3par, series = \"Original\") +\n    autolayer(ma_3par_3, series = \"MA(3)\") +\n    autolayer(ma_3par_5, series = \"MA(5)\") +\n    autolayer(ma_3par_10, series = \"MA(10)\") +\n    scale_color_manual(\n        values = c(\n            \"Original\" = \"gray60\",\n            \"MA(3)\" = \"#006bb6\",\n            \"MA(5)\" = \"#f58426\",\n            \"MA(10)\" = \"#000000\"\n        ),\n        breaks = c(\"Original\", \"MA(3)\", \"MA(5)\", \"MA(10)\")\n    ) +\n    scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +\n    labs(\n        title = \"3-Point Attempt Rate: Moving Average Smoothing Comparison\",\n        subtitle = \"Analytics revolution's exponential growth pattern clearly visible\",\n        y = \"3-Point Attempt Rate (3PAr)\",\n        x = \"Season\",\n        color = \"Series\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(\n        plot.title = element_text(face = \"bold\", size = 14),\n        plot.subtitle = element_text(size = 11, color = \"gray40\"),\n        legend.position = \"bottom\"\n    )\n```\n\nThe strongest structural break appears in 3PAr, which measures the share of shots taken from three. 3PAr rises modestly for decades and then accelerates sharply around 2012, around the same period where ORtg takes off. Lag plots show strong positive relationships across lags, and ACF/PACF behavior again indicates a trending series (non-stationary levels; stationary first differences). Smoothing highlights two regimes: a gradual era up to around 2012 and a rapid, near-exponential climb thereafter. This timing alignment supports the hypothesis that shot selection modernization (spacing, threes above the break, rim attempts enabled by space) is tightly coupled to league-wide efficiency gains\n\n# 4. Attendance: COVID-19 Impact Analysis\n\n## 4.1 Time Series Visualization\n\n```{r attendance-prep, warning=FALSE, message=FALSE}\n# Calculate league-wide attendance by season\nattendance_data <- all_adv_data %>%\n    group_by(Season) %>%\n    summarise(\n        Total_Attendance = sum(`Unnamed: 29_level_0_Attend.`, na.rm = TRUE),\n        Avg_Attendance = mean(`Unnamed: 30_level_0_Attend./G`, na.rm = TRUE),\n        .groups = \"drop\"\n    )\n\n# Create time series (focusing on modern era 1990-2025)\nattendance_data <- attendance_data %>% filter(Season >= 1990)\nts_attendance <- ts(attendance_data$Total_Attendance, start = 1990, frequency = 1)\n```\n\n```{r attendance-plot, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\ndf_attendance <- data.frame(\n    Year = attendance_data$Season,\n    Value = attendance_data$Total_Attendance / 1e6, # Convert to millions\n    Era = case_when(\n        attendance_data$Season < 2020 ~ \"Pre-COVID\",\n        attendance_data$Season >= 2020 & attendance_data$Season < 2022 ~ \"COVID Era\",\n        attendance_data$Season >= 2022 ~ \"Post-COVID Recovery\"\n    )\n)\n\nggplot(df_attendance, aes(x = Year, y = Value, color = Era)) +\n    geom_line(size = 1.2) +\n    geom_point(size = 3) +\n    geom_vline(xintercept = 2020, linetype = \"dashed\", color = \"red\", size = 1) +\n    annotate(\"text\",\n        x = 2020, y = 24, label = \"COVID-19\\nPandemic (2020)\",\n        hjust = -0.05, color = \"red\", fontface = \"bold\", size = 3.5\n    ) +\n    annotate(\"rect\",\n        xmin = 2020, xmax = 2021, ymin = 0, ymax = 25,\n        alpha = 0.1, fill = \"red\"\n    ) +\n    scale_color_manual(values = c(\n        \"Pre-COVID\" = \"#006bb6\",\n        \"COVID Era\" = \"#d62728\",\n        \"Post-COVID Recovery\" = \"#2ca02c\"\n    )) +\n    labs(\n        title = \"NBA Total Attendance (1990-2025): COVID-19 Disruption and Recovery\",\n        subtitle = \"90% collapse in 2020-21 followed by gradual recovery\",\n        x = \"Season\",\n        y = \"Total Attendance (Millions)\",\n        color = \"Era\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(\n        plot.title = element_text(face = \"bold\", size = 14),\n        plot.subtitle = element_text(size = 11, color = \"gray40\"),\n        legend.position = \"bottom\"\n    )\n```\n\n## 4.2 Lag Plots\n\n```{r attendance-lag, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\ngglagplot(ts_attendance, do.lines = FALSE, lags = 9) +\n    ggtitle(\"Lag Plot of Total Attendance\") +\n    theme_minimal()\n```\n\n## 4.3 ACF and PACF Analysis\n\n```{r attendance-acf, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\nacf_attendance <- ggAcf(ts_attendance, lag.max = 15) +\n    labs(title = \"ACF of Total Attendance\") +\n    theme_minimal()\n\npacf_attendance <- ggPacf(ts_attendance, lag.max = 15) +\n    labs(title = \"PACF of Total Attendance\") +\n    theme_minimal()\n\nacf_attendance / pacf_attendance\n```\n\n## 4.4 Moving Average Smoothing for Attendance\n\n```{r attendance-ma-smoothing, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\n# Calculate moving averages\nma_attendance_3 <- ma(ts_attendance, order = 3)\nma_attendance_5 <- ma(ts_attendance, order = 5)\n\n# Plot comparison\nautoplot(ts_attendance, series = \"Original\") +\n    autolayer(ma_attendance_3, series = \"MA(3)\") +\n    autolayer(ma_attendance_5, series = \"MA(5)\") +\n    scale_color_manual(\n        values = c(\n            \"Original\" = \"gray60\",\n            \"MA(3)\" = \"#006bb6\",\n            \"MA(5)\" = \"#f58426\"\n        ),\n        breaks = c(\"Original\", \"MA(3)\", \"MA(5)\")\n    ) +\n    labs(\n        title = \"Attendance: Moving Average Smoothing (COVID Shock Visible)\",\n        subtitle = \"Smoothing cannot remove the dramatic 2020-21 disruption\",\n        y = \"Total Attendance (millions)\",\n        x = \"Season\",\n        color = \"Series\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(\n        plot.title = element_text(face = \"bold\", size = 14),\n        plot.subtitle = element_text(size = 11, color = \"gray40\"),\n        legend.position = \"bottom\"\n    )\n```\n\nAttendance provides the counterpoint: a stable pre-COVID plateau around ~21–22 million through 2019, a 2020–21 collapse during the bubble/limited-capacity seasons, and a partial recovery that remains below the pre-pandemic ceiling. The sharp, short-window discontinuity is a uncounted for shock rather than a new equilibrium. Even with 3–5 year moving averages, the COVID impact is too large to smooth away\n\n# 5. Financial Data: Sports Betting Stocks - Time Series with Seasonality\n\n## 5.1 Data Preparation and Time Series Creation\n\n```{r betting-stocks-load, warning=FALSE, message=FALSE}\n# Load all sports betting stocks\ndkng <- read_csv(\"data/financial/DKNG_daily.csv\", show_col_types = FALSE) %>% mutate(Date = as.Date(Date))\npenn <- read_csv(\"data/financial/PENN_daily.csv\", show_col_types = FALSE) %>% mutate(Date = as.Date(Date))\nmgm <- read_csv(\"data/financial/MGM_daily.csv\", show_col_types = FALSE) %>% mutate(Date = as.Date(Date))\nczr <- read_csv(\"data/financial/CZR_daily.csv\", show_col_types = FALSE) %>% mutate(Date = as.Date(Date))\n\ncat(\"DKNG:\", nrow(dkng), \"days |\", min(dkng$Date), \"to\", max(dkng$Date), \"\\n\")\ncat(\"PENN:\", nrow(penn), \"days |\", min(penn$Date), \"to\", max(penn$Date), \"\\n\")\ncat(\"MGM:\", nrow(mgm), \"days |\", min(mgm$Date), \"to\", max(mgm$Date), \"\\n\")\ncat(\"CZR:\", nrow(czr), \"days |\", min(czr$Date), \"to\", max(czr$Date), \"\\n\")\n\n# Create weekly time series for all stocks\ncreate_weekly_ts <- function(df, ticker) {\n    weekly <- df %>%\n        mutate(Year = year(Date), Week = week(Date)) %>%\n        group_by(Year, Week) %>%\n        summarise(Avg_Close = mean(`Adj Close`, na.rm = TRUE), .groups = \"drop\") %>%\n        arrange(Year, Week)\n\n    start_year <- min(weekly$Year)\n    start_week <- weekly %>%\n        filter(Year == start_year) %>%\n        pull(Week) %>%\n        min()\n    ts(weekly$Avg_Close, start = c(start_year, start_week), frequency = 52)\n}\n\nts_dkng <- create_weekly_ts(dkng, \"DKNG\")\nts_penn <- create_weekly_ts(penn, \"PENN\")\nts_mgm <- create_weekly_ts(mgm, \"MGM\")\nts_czr <- create_weekly_ts(czr, \"CZR\")\n```\n\n## 5.2 Comparative Visualization: All Four Betting Stocks\n\n```{r betting-stocks-compare, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\n# Combine all stocks for comparison (normalize to starting price = 100)\nautoplot(ts_dkng / as.numeric(ts_dkng)[1] * 100, series = \"DKNG\") +\n    autolayer(ts_penn / as.numeric(ts_penn)[1] * 100, series = \"PENN\") +\n    autolayer(ts_mgm / as.numeric(ts_mgm)[1] * 100, series = \"MGM\") +\n    autolayer(ts_czr / as.numeric(ts_czr)[1] * 100, series = \"CZR\") +\n    scale_color_manual(values = c(\"DKNG\" = \"#006bb6\", \"PENN\" = \"#f58426\", \"MGM\" = \"#00a94f\", \"CZR\" = \"#c8102e\")) +\n    labs(\n        title = \"Sports Betting Stocks: Normalized Performance (2020-2024)\",\n        subtitle = \"Indexed to 100 at each stock's start date | Boom-bust-stabilization pattern\",\n        y = \"Normalized Price (Start = 100)\", x = \"Year\", color = \"Stock\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(plot.title = element_text(face = \"bold\"), legend.position = \"bottom\")\n```\n\n## 5.3 DKNG Detailed Analysis\n\n```{r dkng-detail-plot, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\nautoplot(ts_dkng) +\n    annotate(\"rect\", xmin = 2021, xmax = 2021.5, ymin = 0, ymax = 70, alpha = 0.1, fill = \"orange\") +\n    annotate(\"text\", x = 2021.25, y = 65, label = \"Peak Boom\", color = \"orange\", fontface = \"bold\", size = 3) +\n    labs(\n        title = \"DraftKings (DKNG) Weekly Stock Price (2020-2024)\",\n        subtitle = \"IPO boom during COVID → correction → stabilization\",\n        x = \"Year\", y = \"Avg Weekly Adj Close ($)\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(plot.title = element_text(face = \"bold\", size = 14))\n```\n\n## 5.4 Seasonal Decomposition (DKNG)\n\n```{r dkng-decompose, warning=FALSE, message=FALSE, fig.width=12, fig.height=10}\n# Multiplicative decomposition (appropriate for stock prices)\ndecomp_dkng <- decompose(ts_dkng, type = \"multiplicative\")\n\n# Plot decomposition\nautoplot(decomp_dkng) +\n    labs(title = \"DKNG Stock: Seasonal Decomposition (Multiplicative Model)\") +\n    theme_minimal() +\n    theme(plot.title = element_text(face = \"bold\", size = 14))\n```\n\n## 5.5 Moving Average Smoothing (DKNG)\n\n```{r dkng-ma-smoothing, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\n# Calculate moving averages (using weeks)\nma_dkng_4 <- ma(ts_dkng, order = 4) # Monthly smoothing (~4 weeks)\nma_dkng_13 <- ma(ts_dkng, order = 13) # Quarterly smoothing (~13 weeks)\nma_dkng_52 <- ma(ts_dkng, order = 52) # Annual smoothing (52 weeks)\n\nautoplot(ts_dkng, series = \"Original\") +\n    autolayer(ma_dkng_4, series = \"MA(4 weeks)\") +\n    autolayer(ma_dkng_13, series = \"MA(13 weeks)\") +\n    autolayer(ma_dkng_52, series = \"MA(52 weeks)\") +\n    scale_color_manual(\n        values = c(\n            \"Original\" = \"gray60\",\n            \"MA(4 weeks)\" = \"#006bb6\",\n            \"MA(13 weeks)\" = \"#f58426\",\n            \"MA(52 weeks)\" = \"#000000\"\n        ),\n        breaks = c(\"Original\", \"MA(4 weeks)\", \"MA(13 weeks)\", \"MA(52 weeks)\")\n    ) +\n    labs(\n        title = \"DKNG Stock: Moving Average Smoothing Comparison\",\n        subtitle = \"Different windows reveal trading cycles vs long-term trends\",\n        y = \"Stock Price ($)\",\n        x = \"Year\",\n        color = \"Series\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(\n        plot.title = element_text(face = \"bold\", size = 14),\n        plot.subtitle = element_text(size = 11, color = \"gray40\"),\n        legend.position = \"bottom\"\n    )\n```\n\n## 5.6 ACF and Lag Plots (DKNG)\n\n```{r dkng-acf, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\nacf_dkng <- ggAcf(ts_dkng, lag.max = 52) +\n    labs(title = \"ACF of DKNG Weekly Stock Price\") +\n    theme_minimal()\n\npacf_dkng <- ggPacf(ts_dkng, lag.max = 52) +\n    labs(title = \"PACF of DKNG Weekly Stock Price\") +\n    theme_minimal()\n\nacf_dkng / pacf_dkng\n```\n\n## 5.7 PENN Analysis\n\n### 5.7.1 PENN Time Series Visualization\n\n```{r penn-detail-plot, warning=FALSE, message=FALSE, fig.width=12, fig.height=6}\nautoplot(ts_penn) +\n    annotate(\"rect\", xmin = 2020, xmax = 2021.5, ymin = 0, ymax = 140, alpha = 0.1, fill = \"red\") +\n    annotate(\"text\", x = 2020, y = 130, label = \"Covid-19\", color = \"red\", fontface = \"bold\", size = 3) +\n    labs(\n        title = \"Penn Entertainment (PENN) Weekly Stock Price (2020-2024)\",\n        x = \"Year\", y = \"Avg Weekly Adj Close ($)\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(plot.title = element_text(face = \"bold\", size = 14))\n```\n\n### 5.7.2 Seasonal Decomposition (PENN)\n\n```{r penn-decompose, warning=FALSE, message=FALSE, fig.width=12, fig.height=10}\n# Multiplicative decomposition\ndecomp_penn <- decompose(ts_penn, type = \"multiplicative\")\n\nautoplot(decomp_penn) +\n    labs(title = \"PENN Stock: Seasonal Decomposition (Multiplicative Model)\") +\n    theme_minimal() +\n    theme(plot.title = element_text(face = \"bold\", size = 14))\n```\n\n### 5.7.3 Moving Average Smoothing (PENN)\n\n```{r penn-ma-smoothing, warning=FALSE, message=FALSE, fig.width=12, fig.height=8}\nma_penn_4 <- ma(ts_penn, order = 4)\nma_penn_13 <- ma(ts_penn, order = 13)\nma_penn_52 <- ma(ts_penn, order = 52)\n\nautoplot(ts_penn, series = \"Original\") +\n    autolayer(ma_penn_4, series = \"MA(4 weeks)\") +\n    autolayer(ma_penn_13, series = \"MA(13 weeks)\") +\n    autolayer(ma_penn_52, series = \"MA(52 weeks)\") +\n    scale_color_manual(\n        values = c(\n            \"Original\" = \"gray60\",\n            \"MA(4 weeks)\" = \"#006bb6\",\n            \"MA(13 weeks)\" = \"#f58426\",\n            \"MA(52 weeks)\" = \"#000000\"\n        ),\n        breaks = c(\"Original\", \"MA(4 weeks)\", \"MA(13 weeks)\", \"MA(52 weeks)\")\n    ) +\n    labs(\n        title = \"PENN Stock: Moving Average Smoothing Comparison\",\n        subtitle = \"Even annual smoothing cannot hide the structural collapse\",\n        y = \"Stock Price ($)\", x = \"Year\", color = \"Series\"\n    ) +\n    theme_minimal(base_size = 12) +\n    theme(\n        plot.title = element_text(face = \"bold\", size = 14),\n        plot.subtitle = element_text(size = 11, color = \"gray40\"),\n        legend.position = \"bottom\"\n    )\n```\n\n### 5.7.4 ACF and Lag Plots (PENN)\n\n```{r penn-acf, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}\nacf_penn <- ggAcf(ts_penn, lag.max = 52) +\n    labs(title = \"ACF of PENN Weekly Stock Price\") +\n    theme_minimal()\n\npacf_penn <- ggPacf(ts_penn, lag.max = 52) +\n    labs(title = \"PACF of PENN Weekly Stock Price\") +\n    theme_minimal()\n\nacf_penn / pacf_penn\n```\n\nBecause annual NBA series are effectively non-seasonal, I include weekly sports-betting equities to demonstrate seasonality and multiplicative decomposition. DraftKings (DKNG), Penn (PENN), MGM, and Caesars (CZR) all show pandemic-era boom-bust dynamics on weekly data. Prices are non-stationary in levels, stationary in differences, and has volatility that scales with price; implying a multiplicative model is necessary for decomposition. DKNG exhibits a large run-up, correction, and stabilization while PENN shows a sharper hype-driven spike and deeper collapse. \n\nPulling the findings together: ORtg, Pace, 3PAr, and Attendance are all non-stationary in levels and become stationary after first differences (d = 1). Therefore, additive decomposition is appropriate for the NBA metrics , while multiplicative decomposition fits the weekly equities. Short and medium moving-average windows clarify regime shifts: the 2012 analytics inflection in ORtg/3PAr, the mid-2000s trough and rebound in Pace, and the COVID intervention in Attendance."},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"toc-depth":3,"embed-resources":true,"output-file":"eda.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.55","bibliography":["references.bib"],"csl":"nature.csl","theme":{"light":"sketchy","dark":"slate"},"toggle-theme":true,"page-navigation":true,"title":"Exploratory Data Analysis: Offensive Efficiency in the Modern NBA"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}